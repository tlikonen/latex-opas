% Tekijä:   Teemu Likonen <tlikonen@iki.fi>
% Lisenssi: Creative Commons Nimeä-JaaSamoin 4.0 Kansainvälinen
%           (CC BY-SA 4.0)

\chapter{Dokumentin rakenne}

...

\section{Kappaleet}
\label{luku:kappale}

..

\subsection{Tasaus}
%\sloppy, \fussy, \newline \\ \\*

...

\subsection{Sisennykset}

...

\subsection{Välit}

% \bigskip
% \medskip
% \smallskip
% \bigbreak
% \medbreak
% \smallbreak

...

\subsection{Lesket ja orvot}

% nowidow-paketti, \clubpenalty, \widowpenalty
% https://tex.stackexchange.com/questions/4152/how-do-i-prevent-widow-orphan-lines

...

\subsection{Marginaalihuomautukset}
\label{luku:marginaalihuomautukset}

...

\section{Korostus}

...

\section{Sivun vaihto}
% newpage, clearpage, minipage, nopagebreak

...

\section{Otsikot ja jäsennys}
\label{luku:otsikot}

% \sectionbreak ym. ovat titlesec-paketin ominaisuuksia. titlesec
% kannattaa täällä käsitellä.

...

\subsection{Kansilehti ja dokumentin perustiedot}
\label{luku:kansilehti}

...

\subsection{Esittely, pääluvut ja liitteet}
\label{luku:frontmainbackmatter}
% \frontmatter, \mainmatter, \backmatter, \appendix

% Alussa käytetään komentoa \koodi{\keno frontmatter}, joka asettaa
% sivunumeroiden tyyliksi roomalaiset numerot (i, ii, iii jne.). Tässä
% osassa ovat ainakin sisällysluettelo ja tietokirjan tai tutkimuksen
% tiivistelmä. Varsinainen sisältö aloitetaan komennolla \koodi{\keno
%   mainmatter}

...

\section{Luetelmat}
\label{luku:luetelmat}

...

\section{Taulukot}
\label{luku:taulukot}

...

\section{Leijuvat osat}
\label{luku:leijuosat}

...

\section{Ristiviitteet}
\label{luku:ristiviitteet}

...

\section{Alaviitteet}
\label{luku:alaviitteet}

...

\section{Palstat}
\label{luku:palstat}

...

\section{Lähdeluettelo ja lähdeviitteet}
\label{luku:lähteet}

Samoin kuin ristiviitteissäkin (luku \ref{luku:ristiviitteet}) Latex
sisältää komennot, joilla lähdeluettelossa mainittuihin teoksiin voidaan
viitata muualta tekstistä. Ajatus on se, että lähdeluettelo laaditaan
tiettyjen komentojen avulla niin, että jokainen lähdeteos saa jonkin
yksilöllisen tunnisteen. Muualta tekstistä viitataan lähdeteoksiin
käyttämällä samoja tunnisteita, ja Latex osaa automaattisesti poimia
lähdeluettelosta esimerkiksi teoksen tekijöiden nimet ja vuosiluvun.

Lähdeviittauksiin ja lähdemerkintöihin on useita käytäntöjä, jotka
vaihtelevat eri ammatti- ja tieteen\-aloilla, oppilaitoksilla tai
julkaisijoilla. Tässä yhteydessä käsitellään melko vakiintuneita
suomalaisia käytäntöjä, jotka kuvataan \emph{Kielitoimiston
  oikein\-kir\-joi\-tus\-oppaas\-sa} \parencite{kt_oik}. Samalla
käsitellään joitakin asetuksia, joilla kukin voi muokata viittausten
ulkoasua omiin tarpeisiin sopivaksi.

Latex sisältää lähdeluetteloiden ja \=/viittausten perustoiminnot, mutta
niiden avulla ei saa yleisen suomalaisen käytännön mukaisia
lähdeviittauksia. Siksi käytämme apuna makropakettia, jolla viittausten
ja lähdeluettelon ulkoasuun voi vaikuttaa. Ensin käsiteltävä paketti
\paketti{natbib} (luku \ref{luku:natbib}) soveltuu perustarpeisiin ja
lienee sopivin valinta useimmille kirjoittajille. Laajoja tieteellisiä
teoksia kirjoittavan kannattanee opetella käyttämään monipuolista
\paketti{biblatex}\-/pakettia (luku \ref{luku:biblatex}) ja ylläpitää
yhteistä lähdeteosten tietokantaa, josta tarvittavat teokset poimitaan
kunkin dokumentin lähdeluetteloon automaattisesti.

\subsection{Peruskuviot (natbib)}
\label{luku:natbib}

Makropaketti \paketti{natbib}\avctan{natbib} laajentaa Latexin
lähdeviittausten perustoimintoja sen verran, että lähteisiin voidaan
viitata teoksen tekijöiden nimen ja vuosiluvun avulla. Seuraava
esimerkki havainnollistaa paketin käyttöönottoa ja asetuksia.

\begin{koodilohkosis}
  \usepackage{natbib}
  \setcitestyle{authoryear,aysep={},notesep={: }}
\end{koodilohkosis}

Edellisessä esimerkissä viittaustyyli valitaan \koodi{\keno
  set\-cite\-style}\-/komennon argumentissa valitsimella
\koodi{author\-year} (tekijä\--vuosi). Valitsimella \koodi{aysep}
määritetään, mikä välimerkki ladotaan tekijän nimen ja vuosiluvun
väliin. Tässä se jätetään tyhjäksi \koodi{\{\}}.
\koodi{note\-sep}\-/valitsimella asetetaan merkit, jotka ladotaan
vuosiluvun ja sitä seuraavan huomautuksen kuten sivunumeroiden väliin;
tässä tapauksessa määritettiin kaksoispiste ja väli \koodi{\{:~\}}.
\koodi{\keno set\-cite\-style}\-/komennon valitsimet erotetaan
toisistaan pilkulla, eikä erotinpilkkujen ympärillä saa olla
välilyöntejä. Lopputuloksena lähdemerkinnät näyttävät esimerkiksi
seuraavanlaisilta.

\pagebreak[3]

\begin{koodilohkosis}
  \citet*[27--29]{johdatus} % Viittaus teokseen ”johdatus”.
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen \& Teikäläinen (2020: 27--29)
\end{tulossis}

Lähdeluettelo kirjoitetaan \koodi{thebibliography}\-/ympäristön ja
\koodi{\keno bib\-item}\-/komentojen avulla esimerkin
\ref{esim:thebibliography} tavoin. Ympäristön aloittavan komennon
(rivi~1) yhteydessä on argumentti \koodi{00}, jolla ei ole tässä
yhteydessä merkitystä. Jos lähdeviittauksen tyylinä olisi
\koodi{numbers} (eikä \koodi{author\-year}), lähdeluettelon teokset
numeroitaisiin, ja silloin \koodi{thebibliography}\-/ympäristön
argumentti ilmaisee, kuinka leveän sisennyksen numeroidut teokset
tarvitsevat. Argumentiksi voi kirjoittaa mitä tahansa merkkejä, ja Latex
mittaa niiden leveyden. Kannattaa kirjoittaa leveitä numeroita kuten
nollia (\koodi{0}) niin monta kappaletta kuin on numeroita suurimmassa
lähdemerkinnän luvussa. Yksi nolla riittää, jos lähteitä on 1--9
kappaletta, kaksi jos lähteitä on kaksinumeroinen määrä eli 10--99
kappaletta jne.

\begin{esimerkki*}
\begin{koodilohko}
  \begin{thebibliography}{00}

  \bibitem[Meikäläinen ym.(2020)Meikäläinen \& Teikäläinen]{johdatus}
    Meikäläinen, Matti \& Teikäläinen, Teija (2020): Johdatus alkeiden
    perusteisiin. Toinen painos. Kustantaja Oy.

  \bibitem[Itkonen(2019)]{typografia} Itkonen, Markus (2019):
    Typografian käsikirja. Viides, tarkistettu painos. Typoteekki.
    Graafinen suunnittelu Markus Itkonen Oy.

  \end{thebibliography}
\end{koodilohko}
\caption{Lähdeluettelon kirjoittaminen
  \koodi{thebibliography}\-/ympäristön ja \koodi{\keno
    bib\-item}\-/komentojen avulla.}
\label{esim:thebibliography}
\end{esimerkki*}

Komennolla \koodi{\keno bib\-item} tehdään varsinaiset teosmerkinnät.
Samalla määritetään teoksen yksilöllinen tunniste ja mitä tietoja
lähdeviittauksissa näytetään. Yleinen muoto on seuraavanlainen.

\begin{koodilohkosis}
  \bibitem[lyhyt(vuosi)pitkä]{tunniste} Lähdeluettelon tekstit.
\end{koodilohkosis}

Valinnaisen argumentin aluksi kirjoitetaan lähdeviittauksen lyhyt
merkintä, joka tulisi näkymään lähdeviittauksissa esimerkiksi muodossa
''Meikäläinen ym.''. Heti sen perään kirjoitetaan sulkeissa teoksen
vuosiluku ja sen perään vapaavalintainen lähdeviittauksen pitkä
merkintä, joka näkyisi esimerkiksi tekstinä ''Meikäläinen \&
Teikäläinen''. Vuosiluvun sulkeiden ympärillä ei saa olla välilyöntejä.

Komennon pakollinen argumentti on kyseisen lähdeteoksen yksilöllinen
tunniste, jonka avulla kyseiseen teokseen viitataan. Komennon
argumenttien jälkeen kirjoitetaan samaan tekstikappaleeseen teksti, joka
tulee näkymään lähdeluettelossa.

Lähdeteoksiin viittaamiseen on useita eri komentoja, jotka eroavat
toisistaan siinä, mitä tietoa lähdeviittauksessa näytetään ja onko
lähdeviittaus tai sen osa sulkeissa vai ei. Taulukossa
\ref{tlk:natbib-cite} on joitakin \paketti{natbib}\-/paketin
viittauskomentoja sekä esimerkki viittauksen ulkoasusta. Kuviteltu
esimerkkiteos on peräisin esimerkistä \ref{esim:thebibliography}.

\providecommand{\rivi}{}
\renewcommand{\rivi}[2]{\koodi{\keno #1\{\ldots\}} & #2 \\}

\leijutlk{
  \begin{tabular}{ll}
    \toprule
    \ots{Komento} & \ots{Esimerkki} \\
    \midrule
    \rivi{citet}{Meikäläinen ym. (2020)}
    \rivi{citet*}{Meikäläinen \& Teikäläinen (2020)}
    \rivi{citep}{(Meikäläinen ym. 2020)}
    \rivi{citep*}{(Meikäläinen \& Teikäläinen 2020)}
    \rivi{citealt}{Meikäläinen ym. 2020}
    \rivi{citealt*}{Meikäläinen \& Teikäläinen 2020}
    \rivi{citeauthor}{Meikäläinen ym.}
    \rivi{citeauthor*}{Meikäläinen \& Teikäläinen}
    \rivi{citeyear}{2020}
    \rivi{citeyearpar}{(2020)}
    \bottomrule
  \end{tabular}
}{
  \caption{\paketti{natbib}\-/paketin lähdeviittauskomentoja}
  \label{tlk:natbib-cite}
}

Lähdeluettelon ulkoasuun voi vaikuttaa mittojen \koodi{\keno bibhang} ja
\koodi{\keno bibsep} avulla. Ensin mainittu on lähdemerkinnän
vaakasuuntaisen riippuvan sisennyksen suuruus, ja jälkimmäinen on
lähdemerkintöjen välinen pystysuuntainen tila. Mitat asetetaan
tavalliseen tapaan \koodi{\keno set\-length}\-/komennolla (luku
\ref{luku:mitat}).

\begin{koodilohkosis}
  \setlength{\parindent}{1.1em} % tekstikappaleiden 1. rivin sisennys
  \setlength{\bibhang}{\parindent}
  \setlength{\bibsep}{.5ex plus .1ex minus .1ex}
\end{koodilohkosis}

Lähdemerkintöjen fonttiin voi vaikuttaa määrittelemällä uudelleen
komennon \koodi{\keno bibfont} ja sijoittamalla halutut fontti- tai muut
komennot kyseisen komennon määritelmään.

\begin{koodilohkosis}
  \renewcommand{\bibfont}{\sffamily\small}
\end{koodilohkosis}

Oletuksena \koodi{thebibliography}\-/ympäristö latoo lähdeluettelolle
otsikon, ja otsikon teksti määräytyy kieli\-ase\-tus\-ten (luku
\ref{luku:kieliasetukset}) ja dokumenttiluokan perusteella (luku
\ref{luku:dokumenttiluokat}). Suomenkielisen lähdeluettelon otsikon voi
määrittää dokumentin esittelyosassa seuraavan esimerkin tavoin.
Esimerkissä hyödynnetään \koodi{\keno add\-to}\-/komentoa, joka sisältyy
\paketti{polyglossia}\-/{} ja \paketti{babel}\-/paketteihin.

\begin{koodilohkosis}
  \addto{\captionsfinnish}{%
    \renewcommand{\refname}{Lähteet} % article-dokumenttiluokka
    \renewcommand{\bibname}{Lähteet} % report- ja book-luokat
  }
\end{koodilohkosis}

On myös mahdollista määritellä koko komentosarja, joka suoritetaan
lähdeluettelon otsikoinnin yhteydessä. Se tehdään määrittelemällä
uudelleen komento \koodi{\keno bibsection}.

\begin{koodilohkosis}
  \renewcommand{\bibsection}{%
    \setcounter{secnumdepth}{-1}
    \section{Lähteet}
  }
\end{koodilohkosis}

Edellisessä esimerkissä komennolla \koodi{\keno set\-counter}
määritetään, mille otsikkotasolle dokumentin otsikoiden eli lukujen
numerointi yltää. Pieni arvo \mbox{(\koodi{-1})} käytännössä tarkoittaa,
että seuraaviin otsikoihin ei tule numerointia; lähdeluettelon otsikkoon
ei numerointia välttämättä haluta. Komento \koodi{\keno section} tekee
itse otsikon.

Jos ei halua, että \koodi{thebibliography}\-/ympäristö tekee otsikon
automaattisesti, voi \koodi{\keno bibsection}\-/komennon määrittää
tyhjäksi.

\begin{koodilohkosis}
  \renewcommand{\bibsection}{}
\end{koodilohkosis}

Tässä alaluvussa on käsitelty lähdeluettelon ja lähdeviitteiden
tekemistä \paketti{natbib}\-/paketin toimintojen avulla. Paketti
sisältää muitakin ominaisuuksia, joihin kannattaa tutustua paketin
ohjekirjan avulla. On muun muassa mahdollista tehdä lähdeteoksista
tietokanta Bibtex\-/järjestelmän avulla. Jos kuitenkin siihen suuntaan
haluaa edetä, ei kannata käyttää \paketti{natbib}\-/pakettia eikä
Bibtexiä vaan monipuolisempaa pakettia \paketti{biblatex}, jota
käsitellään seuraavassa alaluvussa.

\subsection{Koko työkalupakki (biblatex)}
\label{luku:biblatex}

Suurten lähde- ja kirjallisuusluetteloiden ylläpito voi olla aika
työlästä: pitää jatkuvasti varmistaa, että kaikki viitatut teokset ovat
luettelossa ja että luettelo on pilkulleen yhdenmukainen. Makropaketti
\paketti{biblatex}\avctan{biblatex} on vastaus sellaisiin tarpeisiin.

Ajatuksena on, että kaikki tiedonlähteet ja kirjallisuus kirjoitetaan
tietokantaan, josta \paketti{biblatex}\-/paketin komennot hakevat tiedot
automaattisesti. Kirjoittaja tai työryhmä voi ylläpitää yhtä
kirjallisuustietokantaa, joka voi olla saatavilla verkkosivullakin.
Dokumentin tekstissä viitataan teoksiin yksilöllisen tunnisteen avulla,
ja pelkän viittauksen perusteella oikeat teokset ilmestyvät
lähdeluetteloon automaattisesti esimerkiksi aakkosjärjestyksessä ja
yhdenmukaisessa muodossa. Yhtään tiedonlähdettä ei tarvitse kirjoittaa
lopulliseen lähdeluetteloon käsin.

\paketti{biblatex}\-/paketin käyttö vaatii hieman opettelua -- varsinkin
jos on tarve muokata lähdeluettelon ja lähdeviittausten ulkoasua.
Muutaman tiedonlähteen ylläpito on todennäköisesti paljon helpompaa ja
nopeampaa niillä keinoilla, jotka kuvattiin luvussa \ref{luku:natbib}
(\paketti{natbib}). Sen sijaan laajoja tieteellisiä artikkeleita
kirjoittaville \paketti{biblatex} voi olla suuri apu, koska
artikkeleissa on yleensä paljon lähteitä ja useissakin artikkeleissa
viitataan yleensä samoihin lähteisiin.

\subsubsection{Teostietokanta}

Lähdeteosten tietokanta on erillinen tekstitiedosto, joka tavallisesti
nimetään \koodi{bib}\-/päätteiseksi, esimerkiksi \koodi{teokset.bib}.
Tiedosto koostuu \koodi{@}\=/merkillä ja teostyypin nimellä alkavista
tietueista, joiden yleinen muoto on seuraavanlainen.

\begin{koodilohkosis}
  @teostyyppi{tunniste,
    author = {...},
    title = "..."
  }
\end{koodilohkosis}

Teostyypin nimen jälkeen aaltosulkeiden sisään kirjoitetaan teoksen
kaikki tiedot. Ne alkavat teoksen yksilöllisellä tunnisteella, jota
käytetään lähdeviittauksissa. Tunnisteen jälkeen tulevat muut kentät.
Eri kentät kuten \koodi{author} ja \koodi{title} erotetaan toisistaan
pilkulla. Kentän nimi ja sen sisältö erotetaan toisistaan
yhtäsuuruusmerkillä (\koodi{=}), ja kentän sisältö kirjoitetaan
aaltosulkeiden tai lainausmerkkien sisään, kuten edellinen esimerkki
näyttää.

\begin{esimerkki*}
\begin{koodilohko}
  @book{itkonen_typogr,
    author = {Itkonen, Markus},
    title = {Typografian käsikirja},
    date = {2019},
    edition = {5},
    publisher = {Typoteekki. Graafinen suunnittelu Markus Itkonen Oy}
  }

  @incollection{likonen_teams,
    author = {Likonen, Teemu and Riskilä, Kaisa},
    title = {Verkkoyhteistyö Teams-ympäristössä},
    editor = {Tammi, Tuomo and Horila, Mikko},
    booktitle = {Oppimis- ja toimintaympäristöjen kehittäminen
      harjoittelukouluissa II},
    booksubtitle = {Tilat ja tekniikka pedagogisen kehittämisen tukena},
    publisher = {E-norssi. Opettajankouluttajien yhteistyöverkosto},
    date = {2020},
    pages = {85-92},
    url = {http://www.enorssi.fi/oppimisymparistojulkaisu2020/}
  }

  @article{likonen_tietokanta,
    author = {Likonen, Teemu},
    title = {Tietoa kantaan ja takaisin},
    journaltitle = {Skrolli},
    journalsubtitle = {Tietokonekulttuurin erikoislehti},
    date = {2015},
    volume = {2015},
    number = {4},
    pages = {52-55},
    url = {https://skrolli.fi/numerot/2015-4/}
  }

  @online{ctan,
    title = {Comprehensive TeX Archive Network},
    shorttitle = {CTAN},
    date = {1992/},
    url = {https://www.ctan.org/}
  }
\end{koodilohko}
\caption{Lähdeteosten tietokantatiedosto}
\label{esim:bib-tiedosto}
\end{esimerkki*}

Todellista käyttöä vastaava tietokanta tai sen osa on esimerkissä
\ref{esim:bib-tiedosto}, jossa on neljä erityyppistä teostietuetta:
\koodi{book}, \koodi{incollection}, \koodi{article} ja \koodi{online}.
Ensin mainittu%
\koodimargin{book} teostyyppi \koodi{book} sopii tavallisille kirjoille,
joissa tietyt tekijät (\koodi{author}) vastaavat suunnilleen koko
teoksen sisällöstä ja teoksella on jokin julkaisijataho
(\koodi{publisher}).

Teostyyppi%
\koodimargin{incollection} \koodi{incollection} tarkoittaa esimerkiksi
artikkelikokoelmaa, jonka yksittäiseen artikkeliin (\koodi{title}) ja
sen kirjoittajaan (\koodi{author}) on tarkoitus viitata. Voidaan mainita
myös artikkelin alku- ja lop\-pu\-si\-vut (\koodi{pages}). Kokoelmalla
on toimittaja (\koodi{editor}) ja yhteinen nimi (\koodi{book\-title}).

Tyyppi%
\koodimargin{article} \koodi{article} sopii säännöllisesti julkaistavan
aikakaus- tai muun lehden artikkeleihin. Viittauskohteena on yksittäinen
artikkeli ja sen kirjoittaja. Julkaisutiedoissa mainitaan lehden nimi
(\koodi{jour\-nal\-title}), julkaisukausi (\koodi{vol\-ume}), kauteen
kuuluvan julkaisun järjestysnumero (\koodi{num\-ber}) sekä mahdollisesti
artikkelin sivut (\koodi{pages}).

Verkkolähteiden%
\koodimargin{online} merkitsemiseen sopii \koodi{on\-line}\-/teostyyppi,
joissa on ta\-van\-omais\-ten kenttien lisäksi ainakin verkko\-/osoite
eli \koodi{url}\-/kenttä ja mahdollisesti viittauspäivä
(\koodi{url\-date}) osoittamassa, milloin viitatut tiedot ainakin olivat
saatavilla.

Teostyyppejä ja teoksiin liittyviä tietokenttiä on olemassa paljon
muitakin. Niiden merkitystä ja käyttöä neuvotaan tarkemmin
\paketti{biblatex}\-/paketin ohjeissa. Seuraavassa on kuitenkin pari
huomiota tietokannan ja kenttien kieli\-opillisista asioista.

Tietueissa joidenkin kenttien sisältö voi koostua useasta osasta kuten
saman teoksen eri tekijöistä. Eri tekijöiden nimet erotetaan
\koodi{author}- ja \koodi{editor}\-/kentissä toisistaan
\koodi{and}\-/sanalla. Oletuksena \paketti{biblatex} katsoo, että
tekijät ovat henkilöitä, ja käsittelee esimerkiksi etu- ja sukunimet
tietyllä tavalla: jos mukana on pilkku, sitä ennen on sukunimi, ja
etunimet tulevat pilkun jälkeen; jos ei ole pilkkua, etunimet ovat
ensin, ja sukunimi on lopussa.

Jos kuitenkin teoksen tekijänä on yritys tai yhteisö, täytyy sen nimi
kirjoittaa kokonaan aaltosulkeisiin, jottei sitä tulkittaisi
henkilönnimeksi. Tällaisten aaltosulkeiden sisällä voi käyttää
\koodi{and}\-/sanaa normaalisti, eikä sitä tulkita eri tekijöiden
erottimeksi. Seuraavassa on näistä esimerkit.

\begin{koodilohkosis}
  author = {Meikäläinen, Matti and Teikäläinen, Teija}
  author = {{Latex and Typography oy} and Meikäläinen, Matti}
\end{koodilohkosis}

Muunkinlaisia useasta osasta koostuvia kenttiä on olemassa.
Asiasanakentän (\koodi{keywords}) eri sanat erotetaan toisistaan
pilkulla, ja sivunumeroissa (\koodi{pages}) voi olla myös luku\-alueita,
jotka ilmaistaan yhdysmerkillä \mbox{(\koodi{-})}.

\begin{koodilohkosis}
  keywords = {eri, sanoja, peräkkäin}
  pages = {15-19}
\end{koodilohkosis}

Teostietokantaan voi määrittää vakiosisältöisiä muuttujia käyttämällä
\koodi{@string}\-/rakennetta. Vakioihin voi sitten viitata
teostietueiden kentistä esimerkin \ref{esim:bib-muuttujat} tavoin.
Vakiot ovat hyödyllisiä silloin, kun sama kentän sisältö toistuu useissa
teoksissa, kuten tässä esimerkissä sama tekijä (\koodi{author}) ja
aikakauslehden nimi (\koodi{jour\-nal\-title}). Vakioita voi yhdistää
saman kentän muuhun sisältöön käyttämällä \koodi{\#}\=/merkkiä, kuten
esimerkin rivillä 13 on tehty.

\begin{esimerkki*}
\begin{koodilohko}
  @string{
    oma = {Meikäläinen, Matti},
    lehti = {Hienon hieno aikakauslehti}
  }

  @article{hieno_artikkeli,
    author = oma,
    journaltitle = lehti,
    ...
  }

  @article{toinen_artikkeli,
    author = oma # { and Teikäläinen, Teija},
    journaltitle = lehti,
    ...
  }
\end{koodilohko}
\caption{Muuttujien käyttö ja \koodi{@string}\-/rakenne}
\label{esim:bib-muuttujat}
\end{esimerkki*}

\subsubsection{Käyttöönotto}

\paketti{biblatex}\-/makropaketti otetaan käyttöön esimerkin
\ref{esim:biblatex-käyttöönotto} rivien avulla. Mukana ovat myös paketit
\paketti{polyglossia} ja \paketti{cs\-quotes}. Jälkimmäinen sisältää
lainausmerkkien käyttöön liittyvää logiikkaa (luku
\ref{luku:lainausmerkit}), jota ilman \paketti{biblatex} ei saa eri
kielten erilaisia lainausmerkkejä oikein vaan käyttää pelkästään
amerikkalaisia (``~'').

\begin{esimerkki*}
\begin{koodilohko}
  % Polyglossia tai babel on ladattava ennen biblatexia.
  \usepackage{polyglossia}

  % Kielikohtaiset lainausmerkit oikein csquoten avulla.
  \usepackage{csquotes}

  \usepackage[style=authoryear]{biblatex}
\end{koodilohko}
\caption{\paketti{biblatex}\-/makropaketin käyttöönotto ja asetuksia}
\label{esim:biblatex-käyttöönotto}
\end{esimerkki*}

Paketin asetuksissa käytetään valitsinta \koodi{style} ja sen asetusta
\koodi{author\-year}, joka asettaa lähdeviittausten ja lähdeluettelon
tyyliksi tekijän ja vuosiluvun. Se on yleinen käytäntö suomenkielisissä
teksteissä. Vastaavia tyylejä ovat myös \koodi{author\-year-comp},
\koodi{author\-year-ibid} ja \koodi{author\-year-icomp}, jotka lisäksi
tiivistävät peräkkäisiä lähdeviittauksia, jos teoksen tekijä on sama.

Numerointiin tai kirjainlyhenteisiin perustuvat lähdeluettelo\-/{} ja
viittaustyylit ovat nimeltään \koodi{nu\-mer\-ic} ja
\koodi{al\-pha\-bet\-ic}. Muitakin tyylejä on olemassa, mutta tämän
oppaan esimerkeissä käsitellään tekijä--vuosi-tyyliä.

Makropaketin omien lähdeluettelo\-/{} ja viittaustyylien lisäksi
Latex\-/jakelupaketissa on todennäköisesti mukana myös ulkopuolisten
tahojen tekemiä tyylejä. Tyylikokonaisuus nimeltä
\paketti{bib\-latex-ext}\avctan{biblatex-ext} laajentaa
\paketti{biblatex}\-/paketin tavallisten tyylien ominaisuuksia.
Laajennettujen tyylien käyttäminen ei vaadi erillisen makropaketin
lataamista, vaan tyylin saa käyttöön yksinkertaisesti vain
kirjoittamalla sen nimen \paketti{biblatex}\-/paketin lataamisen
yhteydessä. Laajennetut tyylit alkavat kirjaimilla \mbox{\koodi{ext-},}
esimerkiksi \koodi{ext-author\-year} tai \koodi{ext-author\-year-comp}.

Esimerkin \ref{esim:biblatex-käyttöönotto} komentojen lisäksi täytyy
komennolla \koodi{\keno add\-bib\-re\-source} nimetä kaikki käyttöön
otettavat teostietokantatiedostot. Komentoja ja tiedostoja voi olla
useampiakin, ja tietokanta voi olla myös verkko\-/osoitteen takana oleva
tiedosto. \koodi{\keno add\-bib\-re\-source}\-/komennot täytyy
kirjoittaa Latex\-/dokumentin esittelyosaan.

\begin{koodilohkosis}
  \addbibresource{teokset.bib}
  \addbibresource{~/texmf/omat_kirjoitukset.bib}
  \addbibresource[location=remote]{http://osoite.netissä/yhteiset.bib}
\end{koodilohkosis}

Lähdeluettelo ladotaan dokumenttiin komennolla \koodi{\keno
  print\-bib\-li\-og\-ra\-phy}. Komennolle voi antaa valinnaisen
argumentin, jonka valitsimilla vaikutetaan esimerkiksi lähdeluettelon
otsikon tekstiin tai poistetaan automaattinen otsikointi kokonaan. On
myös olemassa erilaisia lähdeteosten rajaamisvalitsimia, joiden avulla
voi määrittää, mitä teoksia kyseiseen luetteloon halutaan. Näin voidaan
esimerkiksi rajata painetut lähteet yhteen luetteloon, julkaisemattomat
toiseen ja verkkolähteet kolmanteen.

\begin{koodilohkosis}
  \printbibliography
  \printbibliography[title={Lähteet}]
  \printbibliography[heading=none,  % Ei automaattista otsikkoa,
    type=online]           % ja rajataan vain online-tyyppisiin.
\end{koodilohkosis}

Lähdeluetteloon tulevat mukaan vain ne teokset, joihin on viitattu.
Mitään ei siis näy, jos ei ole lähdeviittauksia. Seuraavassa alaluvussa
käsitellään lähdeviittauskomentoja ja myös ''näkymätöntä''
viittauskomentoa, jolla teoksia saadaan mukaan luetteloon ilman näkyvää
viittausta.

\subsubsection{Lähdeviittaukset}

\providecommand{\rivi}{}
\renewcommand{\rivi}[2]{\koodi{\keno #1\{\ldots\}} & #2 \\}

\leijutlk{
  \begin{tabular}{ll}
    \toprule
    \ots{Komento} & \ots{Esimerkki} \\
    \midrule
    \rivi{cite}{Meikäläinen 2020}
    \rivi{textcite}{Meikäläinen (2020)}
    \rivi{parencite}{(Meikäläinen 2020)}
    \rivi{citeauthor}{Meikäläinen}
    \rivi{citeyear}{2020}
    \rivi{citetitle}{[teoksen nimi]}
    \rivi{footcite}{Meikäläinen 2020 [alaviitteessä]}
    \rivi{nocite}{[näkymätön viittaus]}
    \bottomrule
  \end{tabular}
}{
  \caption{\paketti{biblatex}\-/paketin lähdeviittauskomentoja}
  \label{tlk:biblatex-cite}
}

Taulukkoon \ref{tlk:biblatex-cite} on koottu tavallisimpia
\paketti{biblatex}\-/paketin viittauskomentoja. Komennoille voi antaa
valinnaisen argumentin, jolla kerrotaan täsmentävää tietoa
lähdeviittauksesta. Yleensä se on viitattavan teoksen sivunumero.
Viittaus näkyy dokumentissa esimerkiksi seuraavalla tavalla.

\pagebreak[3]

\begin{koodilohkosis}
  \textcite[27--29]{johdatus} % Viittaus teokseen ”johdatus”.
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen ja Teikäläinen (2020, s. 27--29)
\end{tulossis}

Jos halutaan sisällyttää lähdeluetteloon teoksia, joihin ei ole
välttämättä viitattu, käytetään dokumentissa kerran ''näkymätöntä''
viittauskomentoa \koodi{\keno no\-cite}. Sille annetaan argumentiksi
tunnisteet niistä teoksista, jotka halutaan mukaan luetteloon.
Argumentti~\koodi{*} (tähti) valitsee kaikki teokset.

\begin{koodilohkosis}
  \nocite{meikäläinen, teikäläinen} % Nämä teokset mukaan.
  \nocite{*}                        % Kaikki mukaan.
\end{koodilohkosis}

\subsubsection{Lähdeluettelon mittoja}

Lähdeluettelon ulkoasuun voi vaikuttaa muutaman eri mitan avulla, joista
esitellään tässä yhteydessä vain osa. Lähdemerkinnän riippuvan
sisennyksen suuruus määräytyy mitan \koodi{\keno bibhang} avulla.
Yleensä lienee sopivaa asettaa se samaksi kuin tekstikappaleiden
ensimmäisen rivin sisennys \koodi{\keno parindent}.

\begin{koodilohkosis}
  \setlength{\parindent}{1.1em} % tekstikappaleiden 1. rivin sisennys
  \setlength{\bibhang}{\parindent}
\end{koodilohkosis}

Mitta \koodi{\keno bib\-item\-sep} on lähdemerkintöjen välinen
pystysuuntainen tila. Sen avulla voi harventaa lähdeluetteloa, jolloin
lähdemerkinnät erottuvat paremmin toisistaan. Mitan \koodi{\keno
  bib\-name\-sep} avulla voi tehdä suuremman pystysuuntaisen välin
lähdemerkintöjen väliin silloin, kun teoksen tekijä vaihtuu
(\koodi{author} tai \koodi{editor}). Toisin sanoen tämän mitan avulla
voi ryhmitellä saman tekijän teokset tiiviimmin yhteen ja jättää väliä
seuraavan tekijän teoksiin. Vastaavanlainen mitta on \koodi{\keno
  bib\-init\-sep}, jota käytetään silloin, kun lähdemerkinnän aloittava
kirjain vaihtuu. Tämän avulla voi ryhmitellä lähdemerkinnät aakkosittain
eli tehdä suuremman välin aina lähdemerkinnän alkukirjaimen vaihtuessa.

\begin{koodilohkosis}
  \setlength{\bibitemsep}{.5ex plus .1ex minus .1ex}
  \setlength{\bibnamesep}{1em  plus .2ex minus .1ex}
  \setlength{\bibinitsep}{2em  plus .2ex minus .1ex}
\end{koodilohkosis}

\subsubsection{Muita asetuksia}

Lähdemerkintöjen fonttiin voi vaikuttaa määrittelemällä uudelleen
komennon \koodi{\keno bibfont} ja sijoittamalla halutut fontti- tai muut
komennot kyseisen komennon määritelmään.

\begin{koodilohkosis}
  \renewcommand{\bibfont}{\sffamily\small}
\end{koodilohkosis}

Lähdemerkinnät itsessään muodostetaan automaattisesti tiettyjen
tyyli\-ase\-tus\-ten perusteella. Omiakin tyylejä voi tehdä, mutta
yleensä riittää vain yksittäisen asetusten muuttaminen. Niistä
käsitellään tässä yhteydessä muutama. Asetusten muuttamiseen tarvitaan
yleensä \paketti{biblatex}\-/paketin omia asetuskomentoja.

Lähdeluettelon nimet näkyvät oletusasetuksilla siten, että teoksen
ensimmäisen tekijän sukunimi mainitaan ensin (luettelon
aakkosjärjestyksen vuoksi) mutta saman teoksen muiden tekijöiden etunimi
mainitaan ensin. Tekijöiden nimet näkyvät siis seuraavalla tavalla:
''Meikäläinen, Matti ja Teija Teikäläinen''. Suomessa on kuitenkin
tapana kirjoittaa kaikki nimet samalla tavalla ja mainita sukunimi aina
ensin. Tämä saadaan toteutettua seuraavilla komennolla.

\pagebreak[3]

\begin{koodilohkosis}
  \DeclareNameAlias{default} {family-given}
  \DeclareNameAlias{sortname}{family-given}
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen, Matti ja Teikäläinen, Teija (2020). --~--
\end{tulossis}

Saman teoksen eri tekijöiden nimet erotetaan oletuksena toisistaan
pilkuilla paitsi kahden viimeisen nimen välissä on ja-sana. Usein on
kuitenkin tapana käyttää \&\=/merkkiä ainakin lähdeluettelossa.
Seuraavat esimerkkikomennot asettavat lähdeluettelon kaikkien nimien
erottimeksi \&\=/merkin.

\pagebreak[3]

\begin{koodilohkosis}
  \DeclareDelimFormat[bib]{multinamedelim}{\space\&\space}
  \DeclareDelimFormat[bib]{finalnamedelim}{\space\&\space}
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen, Matti \& Teikäläinen, Teija \& Tutkija, Tuija (2020).
  --~--
\end{tulossis}

Edellisten esimerkkikomentojen valinnainen argumentti \koodi{bib}
tarkoittaa, että vaikutetaan vain lähdeluetteloon. Argumentti voi olla
myös \mbox{\koodi{cite}}, jolloin vaikutetaan lähdeviittauksiin.
Ero\-tin\-merkki\-ase\-tuk\-sen nimi \koodi{multi\-name\-delim}
tarkoittaa muiden kuin kahden viimeisen tekijän nimen välissä olevaa
erotinta. Kahden viimeisen nimen erotin määritellään asetuksella
\koodi{final\-name\-delim}.

Useiden saman teoksen tekijöiden luettelot lyhennetään automaattisesti
esimerkiksi muotoon ''Meikäläinen et~al.'', ja lyhentämisen säännöt
määritellään tiettyjen \koodi{max}- ja \koodi{min}\-/alkuisten paketin
valitsimien avulla. Lähdeluettelossa teoksen tekijäluetteloon
vaikutetaan valitsimilla \koodi{max\-bib\-names} ja
\koodi{min\-bib\-names}, kun taas lähdeviittausten tekijäluetteloon
vaikutetaan valitsimilla \koodi{max\-cite\-names} ja
\koodi{min\-cite\-names}. Asetukset toimivat siten, että jos
enimmäismäärä (max) ylittyy, typistetään tekijäluettelo vähimmäismäärään
(min) ja lisätään ilmaus ''et al.'' tms.

Tekijäluetteloa ei kuitenkaan välttämättä lyhennetä, jos luettelosta
tulisi täsmälleen samanlainen kuin jollakin toisella teoksella. Tähän
asiaan puolestaan vaikutetaan valitsimella \koodi{unique\-list}, joka on
oletuksena päällä viittaustyylissä \koodi{author\-year}.

\begin{koodilohkosis}
  \usepackage[style=authoryear, maxbibnames=99, minbibnames=3,
    maxcitenames=3, mincitenames=1, uniquelist=true]{biblatex}
\end{koodilohkosis}

Kun halutaan näyttää lähdeluettelossa vain tekijän etunimen alkukirjain
eikä koko etunimeä, käytetään paketin valitsinta \koodi{given\-inits}.

\pagebreak[3]

\begin{koodilohkosis}
  \usepackage[…, giveninits]{biblatex}
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen, M. (2020). -- --
\end{tulossis}

Lähdeluettelossa näytetään teoksen tekijän nimen kohdalla ajatusviiva,
jos tekijä on sama kuin luettelon edelliselläkin teoksella. Mikäli tätä
(sinänsä yleistä) käytäntöä ei haluta, täytyy käyttää paketin asetusta
\koodi{dashed=\-false}.

\begin{koodilohkosis}
  \usepackage[…, dashed=false]{biblatex}
\end{koodilohkosis}

Joskus on tapana latoa lähdeluettelossa tekijöiden nimet esimerkiksi
pienversaalilla, jotta ne erottuvat luettelosta paremmin. Tällainen
muutos vaatii, että lähdeluettelon tulostamisen yhteydessä määritellään
uudelleen henkilön nimiin liittyvät tulostuskomennot \koodi{\keno
  mk\-bib\-name\-fam\-i\-ly}, \koodi{\keno mk\-bib\-name\-giv\-en},
\koodi{\keno mk\-bib\-name\-pre\-fix} ja \koodi{\keno
  mk\-bib\-name\-suf\-fix}. Se saadaan automaattiseksi seuraavilla
komennoilla.

\pagebreak[3]

\begin{koodilohkosis}
  \AtBeginBibliography{%
    \renewcommand{\mkbibnamefamily}[1]{\textsc{#1}}
    \renewcommand{\mkbibnamegiven} [1]{\textsc{#1}}
    \renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
    \renewcommand{\mkbibnamesuffix}[1]{\textsc{#1}}
  }
\end{koodilohkosis}

\begin{tulossis}
  \textsc{Meikäläinen}, \textsc{Matti} \& \textsc{Teikäläinen},
  \textsc{Teija} (2020). -- --
\end{tulossis}

Lähdeluettelon eri osien erottimena on yleensä piste. Joskus kuitenkin
tekijöiden nimien ja vuosiluvun jälkeen on kaksoispiste. Se saadaan
toteutettua seuraavalla komennolla.

\pagebreak[3]

\begin{koodilohkosis}
  \DeclareDelimFormat[bib]{nametitledelim}{\addcolon\space}
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen, Matti (2020): -- --
\end{tulossis}

Oletuksena \paketti{biblatex} kursivoi \koodi{book}\-/tyyppisten teosten
nimen (\koodi{title}). Sen sijaan artikkelikokoelmissa
(\koodi{incollection}) ja aikakauslehdissä (\koodi{article})
kursivoidaan julkaistun kokoelman nimi (\koodi{book\-title}) ja
aikakauslehden nimi (\koodi{jour\-nal\-title}). Näissä teostyypeissä
viitatun artikkelin nimi (\koodi{title}) kirjoitetaan lainausmerkkeihin.
Käytäntö tuntuu järkevältä, sillä kursivoituna on aina julkaistu
kokonainen teos eikä sen osa. Käytännössähän tiedonlähde joudutaan
hakemaan teoksen nimen perusteella. Joku voi silti haluta muuttaa näiden
ulkoasua ja esimerkiksi kursivoida aina viittauksen kohteena olevan
artikkelin. Seuraavassa on esimerkkikomennot edellä mainittujen
lähdeluettelon kenttien muuttamiseen.

\begin{koodilohkosis}
  \DeclareFieldFormat[article,incollection]{title}{\emph{#1}}
  \DeclareFieldFormat[article]{journaltitle}{#1}
  \DeclareFieldFormat[incollection]{booktitle}{#1}
\end{koodilohkosis}

Edellä olevissa esimerkkikomennoissa on valinnaisena argumenttina ne
teostyypit, joihin halutaan vaikuttaa. Jos valinnaisen argumentin jättää
pois, vaikutetaan kaikkiin teostyyppeihin, ellei tarkempaa
teostyyppikohtaista määritelmää ole olemassa. Ensimmäinen pakollinen
argumentti on kentän nimi teostietokannassa, ja toinen pakollinen
argumentti on sisältö, joka ladotaan lähdemerkintään kyseisen tiedon
kohdalle. Teostietokannasta tulevan kentän sisältö on parametrissa
\koodi{\#1}.

Mikäli haluaa jonkin teoksen tiedon lainausmerkkeihin tai sulkeisiin,
kannattaa käyttää komentoa \koodi{\keno mk\-bib\-quote} tai \koodi{\keno
  mk\-bib\-parens}. Ne ymmärtävät ottaa huomioon eri kielten
lainausmerkkikäytännöt ja mahdolliset sisäkkäiset sulkeet.

\begin{koodilohkosis}
  \DeclareFieldFormat[incollection]{booktitle}{\mkbibquote{#1}}
\end{koodilohkosis}

Oletuksena teoksen vuosiluku tai muu päiväys ladotaan lähdeluetteloon
sulkeissa. Joissakin lähdeluettelokäytännöissä sulkeita ei kuitenkin
ole, joten seuraavaksi käsitellään keino sulkeiden poistamiseen.
Tavallisessa \paketti{biblatex}\-/paketin lähdeluettelotyylissä
\koodi{author\-year} ei ole omaa asetusta teoksen päiväyksen ulkoasun
muuttamiseen, mutta jos käyttää tyyliä \koodi{ext-author\-year}, sekin
puute korjaantuu, ja voi käyttää \koodi{bib\-label\-date}\-/asetusta.

\pagebreak[3]

\begin{koodilohkosis}
  \usepackage[style=ext-authoryear]{biblatex}

  \DeclareFieldFormat{biblabeldate}{#1}
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen, Matti 2020. -- --
\end{tulossis}

Artikkelikokoelmissa (teostyyppi \koodi{incollection}) mainitaan
oletuksena kokoelman nimi ja toimittajat seuraavassa muodossa:
''Teoksessa: \emph{Hieno artikkelikokoelma.} Toim. Toimittaja, Teppo''.
Ensin siis mainitaan julkaisun nimi ja sen jälkeen toimittajien nimet.
Suomessa on tapana kirjoittaa nämä tiedot toisinpäin ja laittaa
toimittajarooli sulkeisiin. Tällaiset asetukset saa käyttämällä tyyliä
\koodi{ext-author\-year} (tms.), paketin asetusta
\koodi{in\-name\-before\-title=\-true} ja seuraavia komentoja.

\pagebreak[3]

\begin{koodilohkosis}
  \usepackage[style=ext-authoryear, innamebeforetitle=true]{biblatex}

  \DeclareFieldFormat{editortype}{\mkbibparens{#1}}
  \DeclareDelimFormat{editortypedelim}{\addspace}
\end{koodilohkosis}

\begin{tulossis}
  -- -- Teoksessa: Toimittaja, Teppo (toim.). \emph{Hieno
    artikkelikokoelma}. -- --
\end{tulossis}

Lähdeviittauksissa vuosiluvun ja sivunumeroiden välissä käytetään
välillä pilkkua ja välillä kaksoispistettä. Sivunumeroiden yhteydessä
voi olla lyhenne ''s.'' tai se voidaan jättää pois. Seuraavilla
komennoilla vaikutetaan näihin asetuksiin.

\pagebreak[3]

\begin{koodilohkosis}
  \DeclareFieldFormat{postnote}{#1} % Lyhenne ”s.” pois.
  \DeclareDelimFormat{postnotedelim}{\addcolon\space} % Kaksoispiste.

  \textcite[15--19]{tunniste} toteaa artikkelissaan -- --
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen (2020: 15--19) toteaa artikkelissaan -- --
\end{tulossis}

Kun samassa teoksessa usean tekijän luettelo lyhennetään, käytetään
oletuksena latinankielistä ilmausta pois jäävien nimien tilalla:
''Meikäläinen et al.''. Ilmauksen voi muuttaa suomenkieliseksi
seuraavalla komennolla.

\pagebreak[3]

\begin{koodilohkosis}
  \DefineBibliographyStrings{finnish}{
    andothers = {ym.},
  }
\end{koodilohkosis}

\begin{tulossis}
  Meikäläinen ym. (2020)
\end{tulossis}

\paketti{biblatex}\-/paketti sisältää valtavan paljon asetuksia ja
mahdollisuuksia lähdeluettelon ja \=/viitteiden ulkoasun säätämiseen.
Esimerkiksi komennolla \koodi{\keno
  De\-clare\-Bib\-li\-og\-ra\-phy\-Driv\-er} voi ottaa täysin haltuun,
miten tietty teostyyppi ladotaan lähdeluetteloon. Komennolla
\koodi{\keno De\-clare\-Sort\-ing\-Tem\-plate} voi määritellä omia
aakkostustapoja. Lisätietoa saa paketin ohjekirjasta.

\section{Kuvat ja värit}
\label{luku:grafiikka}

...

\section{Laatikot}

...

\section{Diaesitykset}
\label{luku:diaesitykset}

...

\section{Kirjeet}
\label{luku:kirjeet}

...
