\chapter{Merkintäkieli}

% Latex on merkintäkieli, eli se sisältää omat tapansa dokumentin
% rakenteen ja sisällön kuvaamiseen. Tässä luvussa käsitellään
% merkintäkielen perus\-asioita.

\section{Merkistö}

Latex\-/dokumenttiin voi kirjoittaa tekstiä Unicode\-/merkistöllä ja sen
\textsc{utf}\=/8\/-koodauksella, jos kääntäjänä on Unicoden osaava
ohjelma kuten Xelatex tai Lualatex. Pääasiassa siis merkit kirjoitetaan
sellaisenaan lähdedokumenttiin, mutta on kuitenkin kaikenlaisia
poikkeuksia, ja niitä käsitellään tässä alaluvussa.

\subsection{Varatut erikoismerkit}

Muutamalla merkillä on perus Latexissa erikoismerkitys, eikä niitä voi
käyttää normaalilla tavalla. Merkit ovat seuraavat:

\begin{koodilohkosis}
  % $ ^ _ # & { } ~ \
\end{koodilohkosis}

Useimmat näistä merkeistä voi suojata erikoismerkitykseltä
kirjoittamalla niiden eteen kenoviivan (\koodi{\keno}). Tildeä
(\textasciitilde), sirkumfleksia (\textasciicircum) eikä kenoviivaa
itseään ei voi suojata pelkän kenoviivan avulla, koska kenoviivan kanssa
ne muodostavat eräitä muita komentoja. Taulukossa
\ref{tlk:merkkien_suojaus} on koottuna, kuinka edellä mainitut
erikoismerkit suojataan eli saadaan ladottua dokumenttiin sellaisenaan.

\leijutlk{
  \begin{tabular}{cll}
    \toprule
    \ots{Merkki} & \multicolumn{2}{l}{\ots{Kirjoittaminen}} \\
    \midrule
    \koodi{\%} & \koodi{\keno\%} \\
    \koodi{\$} & \koodi{\keno\$} & \koodi{\keno textdollar} \\
    \koodi{\^{}} & \koodi{\keno\^{}\{\}} & \koodi{\keno textasciicircum} \\
    \koodi{\_} & \koodi{\keno\_} & \koodi{\keno textunderscore} \\
    \koodi{\#} & \koodi{\keno\#} \\
    \koodi{\&} & \koodi{\keno\&} \\
    \koodi{\{} & \koodi{\keno\{} & \koodi{\keno textbraceleft} \\
    \koodi{\}} & \koodi{\keno\}} & \koodi{\keno textbraceright} \\
    \koodi{\~{}} & \koodi{\keno\~{}\{\}} & \koodi{\keno textasciitilde} \\
    \koodi{\keno} && \koodi{\keno textbackslash} \\
    \bottomrule
  \end{tabular}
}{
  \caption{Varattujen erikoismerkkien kirjoittaminen}
  \label{tlk:merkkien_suojaus}
}

Jotkin makropaketit määrittelevät muitakin erikoismerkkejä. Esimerkiksi
kieli\-asetuksiin (luku \ref{luku:kieliasetukset}) liittyvät
\paketti{polyglossia}\-/{} ja \paketti{babel}\-/paketit voivat
määritellä pari lainausmerkillä (\koodi{\textquotedbl}) alkavaa,
tavutuksen hallintaan liittyvää komentoa.

\subsection{Sanaväli}
\label{luku:sanavali}

Välilyönti, sarkainmerkki ja yksi rivinvaihto ovat kaikki tavallisia
sanavälejä Latex\-/dokumentissa, ja näillä kolmella on sama merkitys.
Esimerkiksi rivin lopussa oleva rivinvaihto tarkoittaa samaa kuin
sanojen välissä oleva välilyönti. Välilyöntejä ja sarkainmerkkejä voi
kirjoittaa useita peräkkäin, mutta ne ovat sama asia kuin yksi väli.

\begin{koodilohkosis}
  Nämä      kaikki
       ovat            vain
  sanoja  peräkkäin  ja               kuuluvat
      samaan kappaleeseen.
\end{koodilohkosis}

\begin{tulossis}
  Nämä kaikki ovat vain sanoja peräkkäin ja kuuluvat samaan
  kappaleeseen.
\end{tulossis}

Sanavälien leveys ei ole vakio. Silloin kun tekstipalsta tasataan
molemmista reunoista -- kuten tämänkin oppaan leipätekstissä \==,
rivillä olevia sanavälejä venytetään sopivasti, jotta tekstipalstan
molemmat reunat saadaan tasaiseksi. Tietynlevyisiä välejä saa tehtyä
komennolla \koodi{\keno hspace} (luku \ref{luku:mitat}).

\subsection{Kappaleen vaihtuminen}

Tyhjä rivi tarkoittaa kappaleen vaihtumista. Rivi on tyhjä silloin, kun
se ei sisällä mitään muuta kuin rivinvaihdon tai kun se sisältää vain
välilyöntejä tai sarkainmerkkejä ja lopuksi rivinvaihdon. Tyhjiä rivejä
voi olla useita peräkkäin, mutta ne tarkoittavat samaa kuin yksi tyhjä
rivi.

\begin{koodilohkosis}
  Nämä rivit kuuluvat
  samaan kappaleeseen.

  Tässä on toinen tekstikappale.
  Nyt ei oteta kantaa siihen, miten
  rivit ja kappaleet muotoillaan.
\end{koodilohkosis}

Ladotuissa teksteissä uuden tekstikappaleen alkaminen ilmaistaan usein
sisennetyllä rivillä, mutta sisennyksiä eikä muitakaan muotoiluja ei
tehdä tekstieditorissa välien avulla. Kappaleiden muotoiluun on omat
keinonsa, ja niistä kerrotaan luvussa \ref{luku:kappale}.

\subsection{Sitova välilyönti}

Sitova välilyönti on samanlainen tyhjä merkki kuin tavallinenkin
välilyönti, mutta rivinvaihtoa ei sallita sen kohdalta. Sitovalla
välilyönnillä kannattaa estää esimerkiksi pienistä osista koostuvan
ilmauksen hajoaminen eri riveille (\emph{osa~5}). Latexissa sitova
välilyönti saadaan joko tildemerkillä (\koodi{\textasciitilde}) tai
nimenomaan siihen tarkoitetulla merkillä, jonka Unicode\-/tunnus on
\uctunnus{u+00a0 no-break space}.

Nämä kaksi eri merkkiä, tilde ja \uctunnus{u+00a0}, toimivat hieman eri
tavoin. Molemmat estävät rivinvaihdon, mutta
\koodi{\textasciitilde}\=/merkki sallii välin venymisen samalla tavalla
kuin tavallinenkin sanaväli sallii (luku \ref{luku:sanavali}). Merkki
\uctunnus{u+00a0} on vakiolevyinen eikä siis veny muiden sanavälien
tapaan. Rivillä sanavälejä täytyy venyttää silloin, kun tekstipalsta
tasataan molemmista reunoista.

\subsection{Ohuke}

Ohuke on tavallista sanaväliä kapeampi väli, ja se tehdään
komennolla~\koodi{\keno,} (kenoviiva ja pilkku). Ohuke on tasalevyinen
ja sitova, eli se ei veny muiden sanavälien tapaan, ja se estää
rivinvaihdon. Siksi ohuke sopii esimerkiksi pitkien lukujen ja
puhelinnumeroiden ryhmittelyyn paremmin kun sanaväli.

\begin{koodilohkosis}
  12\,750\,000
  J.\,R.\,R. Tolkien
\end{koodilohkosis}

Myös henkilön etunimen alkukirjainten välissä voi käyttää ohuketta, jos
tavallinen sanaväli vie kirjaimet turhan kauas toisistaan. Sukunimi
erotetaan kuitenkin aina sanavälillä. Joskus myös päiväyksissä käytetään
ohuketta järjestysluvun pisteiden jälkeen. Taulukossa \ref{tlk:ohuke}
vertaillaan sanaväliä, ohuketta ja yhteen kirjoittamista.

\leijutlk{
  \begin{tabular}{lrll}
    \toprule
    & \ots{Luku} & \ots{Päiväys} & \ots{Nimi} \\
    \midrule
    \otsrivi{Sanaväli} & 12 750 000 & \st{9. 5. 2020} & J. R. R. Tolkien \\
    \otsrivi{Ohuke} & 12\,750\,000 & 9.\,5.\,2020 & J.\,R.\,R. Tolkien \\
    \otsrivi{Yhteen} & 12750000 & 9.5.2020 & \st{J.R.R. Tolkien} \\
    \bottomrule
  \end{tabular}
}{
  \caption{Sanavälin, ohukkeen ja yhteen kirjoittamisen vertailu. Suomen
    kielen vastaiset kirjoitus\-asut on viivattu yli}
  \label{tlk:ohuke}
}

\subsection{Lainausmerkit ja heittomerkki}

Näppäilemällä \textsc{shift} eli vaihtonäppäin ja 2 saadaan yleensä
lainausmerkin yleisversio, niin sanottu \textsc{ascii}\-/lainausmerkki
(\textquotedbl), mutta se ei taida olla minkään kielen varsinainen
lainausmerkki. On siis syytä käyttää oikeita lainausmerkkejä, ja se käy
Latexissa varsin helposti.

Eri kielissä lainausmerkkikäytännöt ovat erilaiset. Suomen kielessä
käytetään ''tällaisia'' lainausmerkkejä tai joskus >>tällaisia>>
kulmalainausmerkkejä. Jos lainauksen sisään tarvitaan lainaus, täytyy
sisempi lainaus kirjoittaa 'tällaisten' puolilainausmerkkien avulla.
Yksittäin käytettynä se on nimeltään heittomerkki. Englannin kielessä
lainauksen alussa ja lopussa on erilainen merkki, ja ``tässä'' siitä
esimerkki. Samoin on puolilainausmerkin kohdalla: `näin'.

Latexissa voi käyttää Unicode\-/merkistöä ja lähdedokumenttiin voi
kirjoittaa suoraan ne lainausmerkit, jotka halutaan ladottavaksi, mutta
edellä mainituille merkeille on myös omat komentonsa. Näppäimistöltä
kirjoitettava yleisheittomerkki (\koodi{'}) tuottaa ladottuna
automaattisesti oikean kaarevan heittomerkin ('). Kun kirjoittaa kaksi
heittomerkkiä peräkkäin (\koodi{''}), on lopputuloksena yksi kaareva
lainausmerkki (''). Kahdella suurempi kuin \=/merkillä (\koodi{>>})
saadaan kulmalainausmerkki~(>>).

\begin{koodilohkosis}
  ''Lainaus, jonka 'sisällä' on lainaus.''
  >>Lainaus, jonka 'sisällä' on lainaus.>>
\end{koodilohkosis}

\begin{tulossis}
  ''Lainaus, jonka 'sisällä' on lainaus.'' \\
  >>Lainaus, jonka 'sisällä' on lainaus.>>
\end{tulossis}

Yllä mainitut riittävät suomen kieleen, mutta englantia ja muita kieliä
varten tarvitaan myös toisinpäin oleva merkki (``), joka tehdään
kahdella gra\-vis\-ak\-sen\-til\-la (\koodi{``}). Vastaava
puolilainausmerkki (`) tehdään yhdellä aksentilla (\koodi{`}). Joissakin
kielissä käytetään erilaisia kulmalainausmerkkejä lainauksen alussa ja
lopussa. Vasemmalle osoittava merkki (<<) tehdään kahdella pienempi kuin
\=/merkillä (<\mbox{}<). Muunlaisiin lainausmerkkeihin tarvittaneen
Unicode\-/merkkejä. Tosin kielikohtaiset asetukset (luku
\ref{luku:kieliasetukset}) voivat tuoda mukanaan omia keinojaan myös
kielikohtaisten lainausmerkkien tuottamiseen.

Joskus todella halutaan latoa yleislainausmerkki (\textquotedbl) tai
yleisheittomerkki (\textquotesingle). Ne saadaan komennoilla
\koodi{\keno textquotedbl} ja \koodi{\keno textquotesingle}. Oletuksena
myös tasalevyinen fontti (luku \ref{luku:kirjaintyypit}) kytkee pois
erikoiset lainausmerkkikomennot ja tuottaa suoraan niitä merkkejä, joita
lähdedokumenttiin on kirjoitettu. Muita tapoja lainausmerkkitoiminnon
estämiseen on esimerkissä \ref{esim:pois-tex-liga}.

\subsection{Yhdysmerkki, ajatusviiva ja miinusmerkki}

Yhdyssanan osien välissä käytettävä yhdysmerkki on Latexissa tavallinen
näppäimistöltä saatava yleis\-yh\-dys\-merk\-ki (\=/). Merkillä on
sivuvaikutus tavutukseen, mistä kerrotaan tarkemmin luvussa
\ref{luku:tavutus}.

Ajatusviivaa tarvitaan esimerkiksi äärikohtien (7--12,
Oulu--Rova\-niemi), luetelmien, vuorosanojen ja virkkeen irrallisen
lisäysten merkitseminen. Suomen kielessä käytetään yleensä vain lyhyttä
ajatusviivaa \mbox{(--)}, joka tehdään Latexissa kahdella peräkkäisellä
yhdysmerkillä \mbox{(\koodi{--})}. Pitkä ajatusviiva \mbox{(---)}
tehdään kolmella yhdysmerkillä \mbox{(\koodi{---})}. Myös Unicoden
ajatusviivamerkkejä voi käyttää: \uctunnus{u+2013 en dash} ja
\uctunnus{u+2014 em dash}. Ajatusviivatkin vaikuttavat sanan tavutukseen
(luku \ref{luku:tavutus}).

\begin{koodilohkosis}
  7--12-vuotiaat
  Oulu--Rovaniemi-yhteys
\end{koodilohkosis}

\begin{tulossis}
  7--12-vuotiaat \\
  Oulu--Rovaniemi-yhteys
\end{tulossis}

Silloin kun todella täytyy latoa kaksi tai kolme peräkkäistä
yhdysmerkkiä, voi käyttää tasalevyistä fonttia (luku
\ref{luku:kirjaintyypit}), joka oletuksena kytkee pois Latexin
ajatusviivatoiminnon. Muita tapoja on esimerkissä
\ref{esim:pois-tex-liga}.

\begin{esimerkki}
\begin{koodilohko}
  \addfontfeatures{Ligatures=TeXReset} % Fontista Tex-ligatuurit pois.
  -\mbox{}-  % Estetään ajatusviiva.
  >\mbox{}>  % Estetään kulmalainausmerkit.
  \texttt{…} % Tasalevyinen fontti estää Tex-ligatuurit.
\end{koodilohko}
\caption{Keinoja Tex-ligatuurien estämiseen. Komento \koodi{\keno
    addfontfeatures} on \paketti{fontspec}\-/makropaketin ominaisuus}
\label{esim:pois-tex-liga}
\end{esimerkki}

Miinusmerkille ei Latexissa ole erityistä merkintätapaa muuten kuin
matematiikkatilassa (luku \ref{luku:matematiikka}). Ajatusviivaa saa
käyttää myös miinusmerkkinä, mutta vielä parempi olisi käyttää
varsinaista Unicoden miinusmerkkiä \uctunnus{u+2212 minus sign}, koska
se on fonteissa suunniteltu typografisesti yhteensopivaksi muiden
matemaattisten merkkien kanssa. Tämän oppaan leipätekstin fontissakin on
pieni ero merkkien välillä: miinusmerkki on samalla korkeudella kuin
plusmerkin vaakaviiva; ajatusviiva on ylempänä (kuva
\ref{kuva:ajatusviiva_miinusmerkki}). Joissakin fonteissa eroa on myös
pituudessa.

\leijukuva{
  \addfontfeatures{Scale=9, LetterSpace=-5}
  +−= \hfill +–=
}{
  \caption{Vasemmalla miinusmerkin ja oikealla ajatusviivan vertailua
    muihin matemaattisiin merkkeihin}
  \label{kuva:ajatusviiva_miinusmerkki}
}

\subsection{Kolme pistettä eli ellipsi}

Ajatuksen katkeamista ja muuta sellaista ilmaisevalle kolmelle pisteelle
eli ellipsille (\ldots) on oma merkkinsä, ja fontissa se saattaa näyttää
hieman erilaiselta kuin kolme peräkkäistä pistemerkkiä. Tyypillisesti
ellipsimerkissä pisteet ovat hieman harvemmassa ja erottuvat toisistaan
paremmin kuin kolmena erillisenä merkkinä ladotut pisteet. Ellipsi
tehdään Latexissa komennolla \koodi{\keno ldots} tai Unicode\-/merkillä
\uctunnus{u+2026 horizontal ellipsis}.

\subsection{Ylä- ja alaindeksi}

H\textsubscript{2}O
H\textsubscript*{2}O


\subsection{Tarkkeet}
%\label{luku:tarkkeet}

Latexissa on useita komentoja tarkkeellisten kirjainten
(\'a\,\v{s}\,\c{c}\,\~o) kirjoittamiseen sekä muille merkeille, joita ei
ehkä ihan helposti saa suoraan näppäimistöltä. Komentoja on koottu
taulukkoon \ref{tlk:tarkkeet}.

Taulukon tarkekomennoissa on käytetty a\=/kirjainta esimerkkinä, mutta
tarke voi liittyä muihinkin kirjaimiin. Merkit voi kirjoittaa
Latex\-/lähdedokumenttiin myös sellaisenaan, eli näiden komentojen
käyttö ei ole välttämätöntä.

\providecommand{\rivi}{}
\renewcommand{\rivi}[3]{\koodi{\keno #1} & #2 & #3 \\}

\leijutlk{
  \begin{tabular}[t]{lll}
    \toprule
    \multicolumn{2}{l}{\ots{Esimerkki}} & \ots{Merkitys} \\
    \midrule
    \rivi{`a}{\`a}{gravis}
    \rivi{'a}{\'a}{akuutti}
    \rivi{\^{}a}{\^a}{sirkumfleksi}
    \rivi{\~{}a}{\~a}{tilde}
    \rivi{\textquotedbl a}{\"a}{treema}
    \rivi{H\{a\}}{\H{a}}{kaksoisakuutti}
    \rivi{r\{a\}}{\r{a}}{yläympyrä}
    \rivi{v\{a\}}{\v{a}}{hattu}
    \rivi{t\{ae\}}{\t{ae}}{sidontakaari}
    \rivi{u\{a\}}{\u{a}}{lyhyysmerkki}
    \rivi{=a}{\=a}{pituusmerkki}
    \rivi{b\{a\}}{\b{a}}{alaviiva}
    \rivi{c\{a\}}{\c{a}}{sedilji}
    \rivi{.a}{\.a}{yläpiste}
    \rivi{d\{a\}}{\d{a}}{alapiste}
    \rivi{k\{a\}}{\k{a}}{ogonek}
    \rivi{AE}{\AE}{AE-ligatuuri}
    \rivi{ae}{\ae}{ae-ligatuuri}
    \bottomrule
  \end{tabular}\hspace{7mm}%
  \begin{tabular}[t]{lll}
    \toprule
    \multicolumn{2}{l}{\ots{Esimerkki}} & \ots{Merkitys} \\
    \midrule
    \rivi{OE}{\OE}{OE-ligatuuri}
    \rivi{oe}{\oe}{oe-ligatuuri}
    \rivi{L}{\L}{poikkiviiva-L}
    \rivi{l}{\l}{poikkiviiva-l}
    \rivi{O}{\O}{poikkiviiva-O}
    \rivi{o}{\o}{poikkiviiva-o}
    \rivi{DJ}{\DJ}{poikkiviiva-D}
    \rivi{dj}{\dj}{poikkiviiva-d}
    \rivi{DH}{\DH}{iso eth}
    \rivi{dh}{\dh}{pieni eth}
    \rivi{NG}{\NG}{iso äng}
    \rivi{ng}{\ng}{pieni äng}
    \rivi{SS}{\SS}{iso kaksois-s}
    \rivi{ss}{\ss}{pieni kaksois-s}
    \rivi{TH}{\TH}{iso thorn}
    \rivi{th}{\th}{pieni thorn}
    \rivi{i}{\i}{pisteetön i}
    \rivi{j}{\j}{pisteetön j}
    \bottomrule
  \end{tabular}
}{
  \caption{Komentoja tarkkeellisten ja muiden kirjainten
    kirjoittamiseen}
  \label{tlk:tarkkeet}
}

\subsection{Kommentit}

Latex\-/dokumentissa prosentin merkki (\koodi{\%}) on kommenttimerkki,
jonka jälkeisen rivin\-osan kääntäjä jättää huomioimatta. Merkki on
tarkoitettu kirjoittajan omien kommenttien ja muistiinpanojen
kirjoittamiseen.

\begin{koodilohkosis}
  % Nyt ei tosin ole
  % mitään kommentoitavaa.
\end{koodilohkosis}

Kommenttimerkki vaikuttaa kääntäjään myös siten, että se syö kaikki
välilyönnit ja sarkainmerkit, jotka tulevat kyseisen kommentin jälkeen.
Tämän vuoksi kommenttimerkin avulla voi yhdistää eri riveillä olevan
tekstin. Seuraava esimerkki tuottaa ladottuna ehjän sanan \emph{Latex}.

\begin{koodilohkosis}
  La% Nämä rivit
    t% yhdistyvät.
      ex
\end{koodilohkosis}

\begin{tulossis}
  La% Nämä rivit
    t% yhdistyvät.
      ex
\end{tulossis}

\section{Komennot}
%\label{luku:komennot}

\subsection{Perusteet}

Latexin komennot alkavat kenoviivalla (\koodi{\textbackslash}), jonka
jälkeen tulee komennon nimi. Nimi koostuu yleensä pienistä tai isoista
kirjaimista, mutta komento voi olla myös merkkejä.

Komennot voivat ottaa vastaan argumentteja eli lisätietoa, jota komento
käsittelee ja tarvitsee toimintaansa. Jotkin argumentit voivat olla
pakollisia ja jotkin valinnaisia. Pakolliset kirjoitetaan
aaltosulkeisiin \koodi{\{\ldots\}} ja valinnaiset hakasulkeisiin
\koodi{[\ldots]}.

\begin{koodilohkosis}
  \komento
  \toinenkomento{argu}{mentteja}
  \toinenkomento[valinnainen]{argu}{mentteja}
\end{koodilohkosis}

Komennon nimen perässä olevat sanavälit syödään pois. Seuraavassa
esimerkissä sana \emph{Latex} ladotaan ehjänä, jos vain \koodi{\keno
  komento} itsessään ei kirjoita mitään eikä vaikuta tekstin latomiseen.

\begin{koodilohkosis}
  La\komento   tex
\end{koodilohkosis}

\begin{tulossis}
  Latex
\end{tulossis}

Jos haluaa komennon jälkeen yhden sanavälin, täytyy kirjoittaa komennon
nimen jälkeen aaltosulkeet: \koodi{\keno komento\{\}}. Aaltosulkeiden
jälkeen ei syödä välejä.

Komennon nimen ja argumenttien välissä voi olla sanavälejä, ja ne kaikki
syödään pois. Komennon ja sen argumentit voi siis kirjoittaa vaikka
seuraavalla tavalla.

\begin{koodilohkosis}
  \toinenkomento  [valinnainen]
     {argu}   {mentteja}
\end{koodilohkosis}

Omien komentojen tärkein tarkoitus on merkintätapojen abstrahointi eli
teknisen toteutuksen ja yksityiskohtien piilottaminen. Abstrahointi voi
helpottaa työskentelyä huomattavastikin ja tehdä lähdedokumentista
helppolukuista. Otetaan esimerkki tämän oppaan toteutuksesta.

Tämä opas käsittelee välillä Unicode\-/merkkejä ja niiden tunnuksia
kuten \uctunnus{u+0061 latin small letter~a}. Merkkien tunnukset
ladotaan erilaisella kirjainleikkauksella, pienversaalilla. Jos fontti
vain tukee pienversaalia, sitä saadaan helposti komennolla \koodi{\keno
  text\-sc}. Tätä komentoa ei ehkä siltikään kannata käyttää suoraan
dokumentissa. Jos nimittäin kirjoittaa dokumentin täyteen \koodi{\keno
  text\-sc}\-/komentoja, voi myöhemmin olla työlästä muuttaa
Unicode\-/tunnusten ulko\-asu ja toteutus toisenlaiseksi.

Jossain vaiheessa kirjoittaja oivaltaa, että Unicode\-/tunnukset ovat
englannin kieltä ja että sanoja pitäisi tavuttaa englannin sääntöjen
mukaan eikä suomen. Pitäisi siis liittää \koodi{\keno
  text\-sc}\-/komentojen ympärille vielä \koodi{\keno
  text\-en\-glish}\-/komento.%
\footnote{Komento \koodi{\keno textenglish} on
  \paketti{polyglossia}\-/paketin ominaisuus.} Lähdedokumentin
kirjoittaminen on ikävää ja ulko\-asu sekava, jos Unicode\-/tunnusten
kohdalla on aina \koodi{\keno textenglish\{\keno text\-sc\{\ldots\}\}}.

Parasta olisi jo ennen kirjoittamista miettiä, mitä loogisia rakenteita
teksti sisältää. Erilaisia rakenteita tai ilmauksia varten kannattaa
luoda komento, jotta sen toteutusta voi myöhemmin muuttaa helposti.
Esimerkiksi Unicoden merkkitunnuksille voisi luoda oman komennon
\koodi{\keno uctunnus}, jota käytetään aina tunnusten ilmaisemiseen
Latex\-/dokumentissa. Komento määritellään vain yhdessä paikassa, ja
määritelmää on helppoa muuttaa. Tekstikin pysyy selkeänä, kun siellä on
vain korkean tason komentoja, jotka ilmaisevat tarkoituksen eivätkä
teknistä toteutusta.

\subsection{Komentojen määrittely}
\label{luku:komennot-määr}

Komentojen määrittelyyn on kolme erilaista komentoa, ja niille kaikille
annetaan samanlaiset argumentit. Komennot ovat seuraavat:

\begin{koodilohkosis}
  \newcommand     {\nimi}[n][oletus]{määritelmä}
  \renewcommand   {\nimi}[n][oletus]{määritelmä}
  \providecommand {\nimi}[n][oletus]{määritelmä}
\end{koodilohkosis}

Ensimmäinen pakollinen argumentti on komennon nimi (\koodi{\keno nimi}).
Komento \koodi{\keno newcommand} määrittelee uuden komennon. Jos komento
on jo olemassa, annetaan virheilmoitus. Toinen komento \koodi{\keno
  renewcommand} määrittelee olemassa olevan komennon uudelleen. Se antaa
virheilmoituksen, jos komentoa ei ollut olemassa. Kolmas komento
\koodi{\keno providecommand} puolestaan määrittelee uuden komennon vain
siinä tapauksessa, että sellaista ei ollut ennen olemassa. Se ei anna
virheilmoitusta.

Komentojen toinen pakollinen argumentti (\koodi{määritelmä}) sisältää
komennon määritelmän eli mitä tahansa tekstiä tai komentoja.
Suoritusvaiheessa komento ikään kuin vaihdetaan sen määritelmäksi.

\begin{koodilohkosis}
  \newcommand{\komento}{Minua komennettiin!}
  \komento
\end{koodilohkosis}

\begin{tulossis}
  Minua komennettiin!
\end{tulossis}

Komentojen ensimmäinen valinnainen argumentti (\koodi{n}) on luku, joka
kertoo, kuinka monta argumenttia määriteltävä komento käsittelee.
Määritelmässä voi käyttää parametreja \koodi{\#1}, \koodi{\#2},
\koodi{\#3} jne., ja ne korvautuvat komennon suoritusvaiheessa
ensimmäisellä, toisella, kolmannella jne. argumentilla.

\begin{koodilohkosis}
  \newcommand{\komento}[2]{Sanoit #1 ja #2!}
  \komento{hip}{hei}
\end{koodilohkosis}

\begin{tulossis}
  Sanoit hip ja hei!
\end{tulossis}

Toinen valinnainen argumentti (\koodi{oletus}) -- jos se on mukana --
kertoo, että määriteltävän komennon ensimmäinen argumentti on
valinnainen ja että tämä on sen ole\-tus\-arvo. Ole\-tus\-arvoa
käytetään silloin, kun valinnaista argumenttia ei ole annettu.

\begin{koodilohkosis}
  \newcommand{\komento}[3][tyyppi]{Hei #1, sanoit #2 ja #3!}
  \komento{hip}{hei}
  \komento[Leslie]{hip}{hei}
\end{koodilohkosis}

\begin{tulossis}
  Hei tyyppi, sanoit hip ja hei! \\
  Hei Leslie, sanoit hip ja hei!
\end{tulossis}

Joskus yhden komennon määritelmä sisältää komennon \koodi{\keno
  renewcommand}, joka sitten määrittelee uudelleen jonkin toisen
komennon. Silloin parametrit \koodi{\#1}, \koodi{\#2} jne. on
tarkoitettu ensimmäisen eli uloimman kerroksen käsiteltäväksi. Sisempi
kerros käyttää parametreja \koodi{\#\#1}, \koodi{\#\#2} jne.

Kaikista kolmesta komentojen määrittelykomennosta on olemassa
tähdellinen versio eli sellainen, jonka komennon nimen lopussa on tähti
(\koodi{*}). Latexin komennoissa on tapana, että tähdellinen versio --
jos sellainen on olemassa -- tarjoaa samaan asiaan jonkin toisenlaisen
näkökulman.

\begin{koodilohkosis}
  \newcommand*     {\nimi}[n][oletus]{määritelmä}
  \renewcommand*   {\nimi}[n][oletus]{määritelmä}
  \providecommand* {\nimi}[n][oletus]{määritelmä}
\end{koodilohkosis}

Komentojen määrittelyssä tähdelliset versiot toimivat muuten samalla
tavalla, mutta ne antavat virheilmoituksen, jos komennolle annetut
argumentit sisältävät enemmän kuin yhden tekstikappaleen. Niinpä
seuraava esimerkki tuottaa käännettäessä virheen.

\begin{koodilohkosis}
  \newcommand*{\komento}[1]{Teksti: #1}

  \komento{
    Ensimmäinen tekstikappale.

    Toinen tekstikappale.
  }
\end{koodilohkosis}

\koodi{\keno newcommand*}\-/komennolla määritelty \koodi{\keno komento}
ei siis suostu ottamaan vastaan argumentteja, jotka sisältävät kappaleen
vaihtumisen eli enemmän kuin yhden tekstikappaleen. Tähdelliset versiot
tuovat tällaisen suo\-jaus\-omi\-nai\-suu\-den.

\subsection{Hyödyllistä lisätietoa}
\label{luku:komennot-lisä}

Komennon määrittelyssä on välillä hyötyä komennosta nimeltä \koodi{\keno
  ignorespaces}, joka jättää sanavälit huomioimatta komennon jälkeen.
Ilman tätä komentoa tulisi seuraavassa esimerkissä sanojen väliin yksi
välilyönti.

\begin{koodilohkosis}
  \newcommand{\komento}[1]{#1\ignorespaces}
  \komento{yhdys}       sana
\end{koodilohkosis}

\begin{tulossis}
  yhdyssana
\end{tulossis}

Monimutkaisiin komentoihin voidaan tarvita ehtorakenteita, ja ne saa
toteutettua \paketti{ifthen}\=/paketin tarjoaman \koodi{\keno
  if\-then\-else}\-/komennon avulla. Se on ohjelmointikielistä tuttu
ehtorakenne: jos annettu ehtolauseke on tosi, käsitellään then\-/haara;
muussa tapauksessa käsitellään else-haara. Lisätietoa saa kyseisen
paketin ohjekirjasta.\footnote{\url{https://www.ctan.org/pkg/ifthen}}

\section{Ympäristöt}
%\label{luku:ymparistot}

Ympäristöt ovat rakenteita, joilla on aloittava \koodi{\keno
  begin}\-/komento ja lopettava \koodi{\keno end}\-/komento sekä
yksilöllinen nimi. Ympäristöjen ajatuksena on, että jokin ominaisuus tai
jotkin toiminnot ovat voimassa vain ympäristön sisällä ja asiat
palautuvat ennalleen ympäristön jälkeen. Jos esimerkiksi jotakin
fontti\-asetusta (luku \ref{luku:kirjaintyypit}) muuttaa ympäristön
sisäpuolella, asetus palautuu ympäristön jälkeen samaksi kuin se oli
ennen ympäristön alkua. Samoin ympäristön sisällä määritellyt komennot
(luku \ref{luku:komennot-määr}) ovat voimassa vain kyseisessä
ympäristössä.

\begin{koodilohkosis}
  \begin{nimi}
    % ympäristön
    % vaikutusalue
  \end{nimi}
\end{koodilohkosis}

Yleisin ympäristö on nimeltään \koodi{document}, jonka sisään koko
dokumentin sisältö kirjoitetaan. Ympäristöjä käytetään tavallisesta
leipätekstistä poikkeavien rakenteiden ilmaisemiseen, esimerkiksi
luetelmiin ja taulukoihin (luvut \ref{luku:luetelmat} ja
\ref{luku:taulukot}). Ympäristöjä voi tehdä itsekin mihin hyvänsä
tarkoitukseen. Niitä määritellään seuraavilla komennoilla.

\begin{koodilohkosis}
  \newenvironment   {nimi}[n][oletus]{aloitus}{lopetus}
  \renewenvironment {nimi}[n][oletus]{aloitus}{lopetus}
\end{koodilohkosis}

Komento \koodi{\keno newenvironment} määrittelee uuden ympäristön. Se
antaa virheilmoituksen, jos samanniminen ympäristö on jo olemassa.
Komento \koodi{\keno renewenvironment} puolestaan määrittelee uudelleen
ympäristön, joka on jo olemassa. Se antaa virheilmoituksen, jos
ympäristöä ei ollutkaan olemassa.

Argumentit ovat lähes samanlaiset kuin komentojen määrittelyssä (luku
\ref{luku:komennot-määr}). Ympäristöjen määrittelykomennoilla on kolme
pakollista argumenttia: ensimmäinen on ympäristön nimi, toinen on
ympäristön aloitusmääritelmä (\koodi{aloitus}) ja kolmas on
lopetusmääritelmä (\koodi{lopetus}).

\begin{koodilohkosis}
  \newenvironment{ymp}{Tästä se alkaa.}{Tähän se päättyy.}

  \begin{ymp}
    Ympäristön sisältöä.
  \end{ymp}
\end{koodilohkosis}

\begin{tulossis}
  Tästä se alkaa. Ympäristön sisältöä. Tähän se päättyy.
\end{tulossis}

Tavallisesti ympäristön aloitusmääritelmään kirjoitetaan jonkin toisen
ympäristön aloituskomento sekä mahdollisesti suoritetaan joitakin
asetuskomentoja. Vastaavasti lopetusmääritelmässä lopetetaan ympäristö
eli palataan normaaliin tilaan. Tarkoituksena on abstrahoida jokin
monimutkaisempi kokonaisuus eli tehdä uusi helppokäyttöinen ympäristö, joka
piilottaa teknisen toteutuksen.

\begin{koodilohkosis}
  \newenvironment{ymp}
  {\begin{mahtavuus}
      \omia\hienoja\asetuksia}
    {\end{mahtavuus}}
\end{koodilohkosis}

Omille ympäristölle voi määritellä argumentteja samalla tavalla kuin
komennoillekin (luku \ref{luku:komennot-määr}). Ensimmäinen valinnainen
argumentti (\koodi{n}) on luku joka kertoo, kuinka monta argumenttia
määriteltävä ympäristö käsittelee. Ympäristön aloitusmääritelmässä voi
argumentteihin viitata parametreilla \koodi{\#1}, \koodi{\#2},
\koodi{\#3} jne.

Jos toinen valinnainen argumentti (\koodi{oletus}) on mukana, se
ilmaisee, että määriteltävän ympäristön ensimmäinen argumentti on
valinnainen ja että tämä on sen ole\-tus\-arvo. Oletusta käytetään
silloin, kun valinnaista argumenttia ei ole annettu. Argumentit annetaan
ympäristön aloittavan komennon yhteydessä.

\begin{koodilohkosis}
  \begin{ymp}[valinnainen]{argu}{mentteja}
    % ympäristön
    % vaikutusalue
  \end{ymp}
\end{koodilohkosis}

Ympäristön määrittelykomennoille on myös tähdelliset versiot
\koodi{\keno newenvironment*} ja \koodi{\keno renewenvironment*}. Ne
toimivat samoin kuin edellä kuvatut tavallisetkin komentoversiot, mutta
ne eivät salli, että määritellylle ympäristölle annetut argumentit
sisältävät enemmän kuin yhden tekstikappaleen. Toiminta on siis sama
kuin komentojenkin määrittelyn tähdellisissä versioissa (luku
\ref{luku:komennot-määr}).

\begin{koodilohkosis}
  \newenvironment*   {nimi}[n][oletus]{aloitus}{lopetus}
  \renewenvironment* {nimi}[n][oletus]{aloitus}{lopetus}
\end{koodilohkosis}

Joskus ympäristöjen määrittelyyn on hyödyllistä sisällyttää komento
\koodi{\keno ignorespaces}, joka jättää huomioimatta komennon jälkeiset
sanavälit. Luvussa \ref{luku:komennot-lisä} on tästä esimerkki. Lisäksi
on olemassa komento \koodi{\keno ig\-nore\-spaces\-af\-ter\-end}, joka
jättää huomioimatta ympäristön lopettavan \koodi{\keno end}\-/komennon
jälkeiset sanavälit.

\section{Lohkot}
\section{Mitat}
\label{luku:mitat}
\section{Laskurit}
