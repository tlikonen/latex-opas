\chapter{Merkintäkieli}

% Latex on merkintäkieli, eli se sisältää omat tapansa dokumentin
% rakenteen ja sisällön kuvaamiseen. Tässä luvussa käsitellään
% merkintäkielen perus\-asioita.

\section{Merkistö}

Latex\-/dokumenttiin voi kirjoittaa tekstiä Unicode\-/merkistöllä ja sen
\textsc{utf}\=/8\/-koodauksella, jos kääntäjänä on Unicoden osaava
ohjelma kuten Xelatex tai Lualatex. Pääasiassa siis merkit kirjoitetaan
sellaisenaan lähdedokumenttiin, mutta on kuitenkin kaikenlaisia
poikkeuksia, ja niitä käsitellään tässä alaluvussa.

\subsection{Varatut erikoismerkit}

Muutamalla merkillä on perus Latexissa erikoismerkitys, eikä niitä voi
käyttää normaalilla tavalla. Merkit ovat seuraavat:

\begin{koodilohkosis}
  % $ ^ _ # & { } ~ \
\end{koodilohkosis}

Useimmat näistä merkeistä voi suojata erikoismerkitykseltä
kirjoittamalla niiden eteen kenoviivan (\koodi{\keno}). Tildeä
(\textasciitilde), sirkumfleksia (\textasciicircum) eikä kenoviivaa
itseään ei voi suojata pelkän kenoviivan avulla, koska kenoviivan kanssa
ne muodostavat eräitä muita komentoja. Taulukossa
\ref{tlk:merkkien_suojaus} on koottuna, kuinka edellä mainitut
erikoismerkit suojataan eli saadaan ladottua dokumenttiin sellaisenaan.

\leijutlk{
  \begin{tabular}{cll}
    \toprule
    \ots{Merkki} & \multicolumn{2}{l}{\ots{Kirjoittaminen}} \\
    \midrule
    \koodi{\%} & \koodi{\keno\%} \\
    \koodi{\$} & \koodi{\keno\$} & \koodi{\keno textdollar} \\
    \koodi{\^{}} & \koodi{\keno\^{}\{\}} & \koodi{\keno textasciicircum} \\
    \koodi{\_} & \koodi{\keno\_} & \koodi{\keno textunderscore} \\
    \koodi{\#} & \koodi{\keno\#} \\
    \koodi{\&} & \koodi{\keno\&} \\
    \koodi{\{} & \koodi{\keno\{} & \koodi{\keno textbraceleft} \\
    \koodi{\}} & \koodi{\keno\}} & \koodi{\keno textbraceright} \\
    \koodi{\~{}} & \koodi{\keno\~{}\{\}} & \koodi{\keno textasciitilde} \\
    \koodi{\keno} && \koodi{\keno textbackslash} \\
    \bottomrule
  \end{tabular}
}{
  \caption{Varattujen erikoismerkkien kirjoittaminen}
  \label{tlk:merkkien_suojaus}
}

Jotkin makropaketit määrittelevät muitakin erikoismerkkejä. Esimerkiksi
kieli\-asetuksiin (luku \ref{luku:kieliasetukset}) liittyvät
\paketti{polyglossia}\-/{} ja \paketti{babel}\-/paketit voivat
määritellä pari lainausmerkillä (\koodi{\textquotedbl}) alkavaa,
tavutuksen hallintaan liittyvää komentoa.

\subsection{Sanaväli}
\label{luku:sanavali}

Välilyönti, sarkainmerkki ja yksi rivinvaihto ovat kaikki tavallisia
sanavälejä Latex\-/dokumentissa, ja näillä kolmella on sama merkitys.
Esimerkiksi rivin lopussa oleva rivinvaihto tarkoittaa samaa kuin
sanojen välissä oleva välilyönti. Välilyöntejä ja sarkainmerkkejä voi
kirjoittaa useita peräkkäin, mutta ne ovat sama asia kuin yksi väli.

\pagebreak[3]

\begin{koodilohkosis}
  Nämä      kaikki
       ovat            vain
  sanoja  peräkkäin  ja               kuuluvat
      samaan kappaleeseen.
\end{koodilohkosis}

\begin{tulossis}
  Nämä kaikki ovat vain sanoja peräkkäin ja kuuluvat samaan
  kappaleeseen.
\end{tulossis}

Sanavälien leveys ei ole vakio. Silloin kun tekstipalsta tasataan
molemmista reunoista -- kuten tämänkin oppaan leipätekstissä \==,
rivillä olevia sanavälejä venytetään sopivasti, jotta tekstipalstan
molemmat reunat saadaan tasaiseksi. Tietynlevyisiä välejä saa tehtyä
komennolla \koodi{\keno hspace} (luku \ref{luku:mitat}).

\subsection{Kappaleen vaihtuminen}

Tyhjä rivi tarkoittaa kappaleen vaihtumista. Rivi on tyhjä silloin, kun
se ei sisällä mitään muuta kuin rivinvaihdon tai kun se sisältää vain
välilyöntejä tai sarkainmerkkejä ja lopuksi rivinvaihdon. Tyhjiä rivejä
voi olla useita peräkkäin, mutta ne tarkoittavat samaa kuin yksi tyhjä
rivi. Uuden tekstikappaleen voi aloittaa myös komennolla \koodi{\keno
  par}.

\begin{koodilohkosis}
  Nämä rivit kuuluvat
  samaan kappaleeseen.

  Tässä on toinen tekstikappale.
  Nyt ei oteta kantaa siihen, miten
  rivit ja kappaleet muotoillaan.
\end{koodilohkosis}

Ladotuissa teksteissä uuden tekstikappaleen alkaminen ilmaistaan usein
sisennetyllä rivillä, mutta sisennyksiä eikä muitakaan muotoiluja ei
tehdä tekstieditorissa välien avulla. Kappaleiden muotoiluun on omat
keinonsa, ja niistä käsitellään luvussa \ref{luku:kappale}.

\subsection{Kommentit}

Latex\-/dokumentissa prosentin merkki (\koodi{\%}) on kommenttimerkki,
jonka jälkeisen rivin\-osan kääntäjä jättää huomioimatta. Merkki on
tarkoitettu kirjoittajan omien kommenttien ja muistiinpanojen
kirjoittamiseen.

\begin{koodilohkosis}
  % Nyt ei tosin ole
  % mitään kommentoitavaa.
\end{koodilohkosis}

Kommenttimerkki vaikuttaa kääntäjään myös siten, että se syö kaikki
välilyönnit ja sarkainmerkit, jotka tulevat kyseisen kommentin jälkeen.
Tämän vuoksi kommenttimerkin avulla voi yhdistää eri riveillä olevan
tekstin. Seuraava esimerkki tuottaa ladottuna ehjän sanan \emph{Latex}.

\begin{koodilohkosis}
  La% Nämä rivit
    t% yhdistyvät.
      ex
\end{koodilohkosis}

\begin{tulossis}
  La% Nämä rivit
    t% yhdistyvät.
      ex
\end{tulossis}

\subsection{Aaltosulkeet}
\label{luku:aaltosulkeet}

Aaltosulkeet \mbox{\koodi{\{\}}} muodostavat eräänlaisen näkymättömän
ympäristön, jonka sisällä voi olla väliaikaisesti voimassa erilaiset
asetukset kuin ulkopuolella. Aaltosulkeiden sisällä suoritetut komennot,
uusien komentojen määrittelyt (luku \ref{luku:komennot}) tai asetetut
mittojen arvot (luku \ref{luku:mitat}) ovat voimassa vain kyseisen
ympäristön sisäpuolella. Seuraavassa esimerkissä aaltosulkeilla rajataan
kursivointikomennon \koodi{\keno itshape} vai\-ku\-tus\-aluetta.

\pagebreak[3]

\begin{koodilohkosis}
  tavallinen {\itshape kursiivi} tavallinen
\end{koodilohkosis}

\begin{tulossis}
  tavallinen {\itshape kursiivi} tavallinen
\end{tulossis}

\subsection{Sitova välilyönti}

Sitova välilyönti on samanlainen tyhjä merkki kuin tavallinenkin
välilyönti, mutta rivinvaihtoa ei sallita sen kohdalta. Sitovalla
välilyönnillä kannattaa estää esimerkiksi pienistä osista koostuvan
ilmauksen hajoaminen eri riveille (esimerkki: \emph{osa~5}). Latexissa
sitova välilyönti saadaan joko tildemerkillä (\koodi{\textasciitilde})
tai nimenomaan siihen tarkoitetulla merkillä, jonka Unicode\-/tunnus on
\uctunnus{u+00a0 no-break space}.

Nämä kaksi eri merkkiä, tilde ja \uctunnus{u+00a0}, toimivat hieman eri
tavoin. Molemmat estävät rivinvaihdon, mutta
\koodi{\textasciitilde}\=/merkki sallii välin venymisen samalla tavalla
kuin tavallinenkin sanaväli sallii (luku \ref{luku:sanavali}). Merkki
\uctunnus{u+00a0} on vakiolevyinen eikä siis veny muiden sanavälien
tapaan. Rivillä sanavälejä täytyy venyttää silloin, kun tekstipalsta
tasataan molemmista reunoista.

\subsection{Ohuke}
\label{luku:ohuke}

Ohuke on tavallista sanaväliä kapeampi väli, ja se tehdään
komennolla~\koodi{\keno,} (kenoviiva ja pilkku). Ohukkeen leveys
Latexissa on \murtoluku{1/6} typografisen neliön leveydestä eli
em-mitasta (luku \ref{luku:mitat}). Ohuke on tasalevyinen ja sitova, eli
se ei veny muiden sanavälien tapaan, ja se estää rivinvaihdon. Siksi
ohuke sopii esimerkiksi pitkien lukujen ja puhelinnumeroiden
ryhmittelyyn paremmin kun sanaväli.

\begin{koodilohkosis}
  12\,750\,000
  J.\,R.\,R. Tolkien
\end{koodilohkosis}

Myös henkilön etunimen alkukirjainten välissä voi käyttää ohuketta, jos
tavallinen sanaväli vie kirjaimet turhan kauas toisistaan. Sukunimi
erotetaan kuitenkin aina sanavälillä. Joskus myös päiväyksissä käytetään
ohuketta järjestysluvun pisteiden jälkeen. Taulukossa \ref{tlk:ohuke}
vertaillaan sanaväliä, ohuketta ja yhteen kirjoittamista.

\leijutlk{
  \begin{tabular}{lrll}
    \toprule
    & \ots{Luku} & \ots{Päiväys} & \ots{Nimi} \\
    \midrule
    \otsrivi{Sanaväli} & 12 750 000 & \st{9. 5. 2020} & J. R. R. Tolkien \\
    \otsrivi{Ohuke} & 12\,750\,000 & 9.\,5.\,2020 & J.\,R.\,R. Tolkien \\
    \otsrivi{Yhteen} & 12750000 & 9.5.2020 & \st{J.R.R. Tolkien} \\
    \bottomrule
  \end{tabular}
}{
  \caption{Sanavälin, ohukkeen ja yhteen kirjoittamisen vertailu. Suomen
    kielen vastaiset kirjoitus\-asut on viivattu yli}
  \label{tlk:ohuke}
}

\subsection{Lainausmerkit ja heittomerkki}

Näppäilemällä \textsc{shift} eli vaihtonäppäin ja 2 saadaan yleensä
lainausmerkin yleisversio, niin sanottu \textsc{ascii}\-/lainausmerkki
(\textquotedbl), mutta se ei taida olla minkään kielen varsinainen
lainausmerkki. On siis syytä käyttää oikeita lainausmerkkejä, ja se käy
Latexissa varsin helposti.

Eri kielissä lainausmerkkikäytännöt ovat erilaiset. Suomen kielessä
käytetään ''tällaisia'' lainausmerkkejä tai joskus >>tällaisia>>
kulmalainausmerkkejä. Jos lainauksen sisään tarvitaan lainaus, täytyy
sisempi lainaus kirjoittaa 'tällaisten' puolilainausmerkkien avulla.
Yksittäin käytettynä se on nimeltään heittomerkki. Englannin kielessä
lainauksen alussa ja lopussa on erilainen merkki, ja ``tässä'' siitä
esimerkki. Samoin on puolilainausmerkin kohdalla: `näin'.

Latexissa voi käyttää Unicode\-/merkistöä ja lähdedokumenttiin voi
kirjoittaa suoraan ne lainausmerkit, jotka halutaan ladottavaksi, mutta
edellä mainituille merkeille on myös omat komentonsa. Näppäimistöltä
kirjoitettava yleisheittomerkki (\koodi{'}) tuottaa ladottuna
automaattisesti oikean kaarevan heittomerkin ('). Kun kirjoittaa kaksi
heittomerkkiä peräkkäin (\koodi{''}), on lopputuloksena yksi kaareva
lainausmerkki (''). Kahdella suurempi kuin \=/merkillä (\koodi{>>})
saadaan kulmalainausmerkki~(>>).

\pagebreak[3]

\begin{koodilohkosis}
  ''Lainaus, jonka 'sisällä' on lainaus.''
  >>Lainaus, jonka 'sisällä' on lainaus.>>
\end{koodilohkosis}

\begin{tulossis}
  ''Lainaus, jonka 'sisällä' on lainaus.'' \\
  >>Lainaus, jonka 'sisällä' on lainaus.>>
\end{tulossis}

Yllä mainitut riittävät suomen kieleen, mutta englantia ja muita kieliä
varten tarvitaan myös toisinpäin oleva merkki (``), joka tehdään
kahdella gra\-vis\-ak\-sen\-til\-la (\koodi{``}). Vastaava
puolilainausmerkki (`) tehdään yhdellä aksentilla (\koodi{`}). Joissakin
kielissä käytetään erilaisia kulmalainausmerkkejä lainauksen alussa ja
lopussa. Vasemmalle osoittava merkki (<<) tehdään kahdella pienempi kuin
\=/merkillä (\koodi{<<}). Muunlaisiin lainausmerkkeihin tarvittaneen
Unicode\-/merkkejä. Tosin kielikohtaiset asetukset (luku
\ref{luku:kieliasetukset}) voivat tuoda mukanaan omia keinojaan myös
kielikohtaisten lainausmerkkien tuottamiseen.

Joskus todella halutaan latoa yleislainausmerkki (\textquotedbl) tai
yleisheittomerkki (\textquotesingle). Ne saadaan komennoilla
\koodi{\keno textquotedbl} ja \koodi{\keno textquotesingle}. Oletuksena
myös tasalevyinen fontti (luku \ref{luku:kirjaintyypit}) kytkee pois
erikoiset lainausmerkkikomennot ja tuottaa suoraan niitä merkkejä, joita
lähdedokumenttiin on kirjoitettu. Muita tapoja lainausmerkkitoiminnon
estämiseen on esimerkissä \ref{esim:pois-tex-liga}.

\subsection{Yhdysmerkki, ajatusviiva ja miinusmerkki}

Yhdyssanan osien välissä käytettävä yhdysmerkki on Latexissa tavallinen
näppäimistöltä saatava yleis\-yh\-dys\-merk\-ki (\=/). Merkillä on
vaikutusta myös sanan tavutukseen (luku \ref{luku:tavutus}).

Ajatusviivaa tarvitaan esimerkiksi äärikohtien (27--29,
Oulu--Rova\-niemi), luetelmien, vuorosanojen ja virkkeen irrallisen
lisäysten merkitseminen. Suomen kielessä käytetään yleensä vain lyhyttä
ajatusviivaa \mbox{(--)}, joka tehdään Latexissa kahdella peräkkäisellä
yhdysmerkillä \mbox{(\koodi{--})}. Pitkä ajatusviiva \mbox{(---)}
tehdään kolmella yhdysmerkillä \mbox{(\koodi{---})}. Myös Unicoden
ajatusviivamerkkejä voi käyttää: \uctunnus{u+2013 en dash} ja
\uctunnus{u+2014 em dash}. Ajatusviivat vaikuttavat sanan tavutukseen
samoin kuin yhdysmerkki (luku \ref{luku:tavutus}).

\pagebreak[3]

\begin{koodilohkosis}
  Oulu--Rovaniemi-yhteys
\end{koodilohkosis}

\begin{tulossis}
  Oulu--Rovaniemi-yhteys
\end{tulossis}

Silloin kun todella täytyy latoa kaksi tai kolme peräkkäistä
yhdysmerkkiä, voi käyttää tasalevyistä fonttia (luku
\ref{luku:kirjaintyypit}), joka oletuksena kytkee pois Latexin
ajatusviivatoiminnon. Muita tapoja on esimerkissä
\ref{esim:pois-tex-liga}.

\begin{esimerkki}
\begin{koodilohko}
  \addfontfeatures{Ligatures=TeXReset} % Fontista Tex-ligatuurit pois.
  -{}-       % Estetään ajatusviiva.
  >{}>       % Estetään kulmalainausmerkit.
  \texttt{…} % Tasalevyinen fontti estää Tex-ligatuurit.
\end{koodilohko}
\caption{Keinoja Tex-ligatuurien estämiseen. Komento \koodi{\keno
    addfontfeatures} on \paketti{fontspec}\-/makropaketin ominaisuus}
\label{esim:pois-tex-liga}
\end{esimerkki}

Miinusmerkille ei Latexissa ole erityistä merkintätapaa muuten kuin
matematiikkatilassa (luku \ref{luku:matematiikka}). Ajatusviivaa saa
käyttää myös miinusmerkkinä, mutta vielä parempi olisi käyttää
varsinaista Unicoden miinusmerkkiä \uctunnus{u+2212 minus sign}, koska
se on fonteissa suunniteltu typografisesti yhteensopivaksi muiden
matemaattisten merkkien kanssa. Tämän oppaan leipätekstin fontissakin on
pieni ero merkkien välillä: miinusmerkki on samalla korkeudella kuin
plusmerkin vaakaviiva; ajatusviiva on ylempänä (kuva
\ref{kuva:ajatusviiva_miinusmerkki}). Joissakin fonteissa eroa on myös
pituudessa.

\leijukuva{
  \addfontfeatures{Scale=9, LetterSpace=-5}
  +−= \hfill +–=
}{
  \caption{Vasemmalla miinusmerkin ja oikealla ajatusviivan vertailua
    muihin matemaattisiin merkkeihin}
  \label{kuva:ajatusviiva_miinusmerkki}
}

\subsection{Kolme pistettä eli ellipsi}

Ajatuksen katkeamista ja muuta sellaista ilmaisevalle kolmelle pisteelle
eli ellipsille (\ldots) on oma merkkinsä, ja fontissa se saattaa näyttää
hieman erilaiselta kuin kolme peräkkäistä pistemerkkiä. Tyypillisesti
ellipsimerkissä pisteet ovat hieman harvemmassa ja erottuvat toisistaan
paremmin kuin kolmena erillisenä merkkinä ladotut pisteet. Ellipsi
tehdään Latexissa komennoilla \koodi{\keno dots}, \koodi{\keno ldots},
\koodi{\keno text\-el\-lip\-sis} tai Unicode\-/merkillä \uctunnus{u+2026
  horizontal ellipsis}.

\subsection{Ylä- ja alaindeksi}

Yläindeksit (a\textsuperscript{2}) tehdään komennolla \koodi{\keno
  textsuperscript} ja alaindeksit (a\textsubscript{2}) komennolla
\koodi{\keno textsubscript}. Oletus\-asetuksilla Latex toteuttaa
indeksit mekaanisesti pienentämällä fonttia ja sijoittamalla pienennetyn
tekstin peruslinjan tai gemenalinjan tuntumaan. Lopputulos ei ole
typografisesti välttämättä kovin hyvä, koska fontin pienentäminen
ohentaa samalla merkkien viivoja ja ohuimmat hiusviivat voivat kadota.

Open Type \=/fontit sisältävät usein tuen oikeille ylä- ja
alaindekseille, jotka fontin suunnittelija on toteuttanut. Niitä
kannattaa käyttää, koska suunnittelija tuntee oman fonttinsa ja saa
todennäköisesti parempaa jälkea kuin Latex mekaanisesti. Open Type
\=/fonttien indeksit on kätevintä ottaa käyttöön
\paketti{real\-scripts}\-/paketin avulla.

\begin{koodilohkosis}
  \usepackage{realscripts}
\end{koodilohkosis}

Paketti \paketti{real\-scripts} määrittelee uudelleen Latexin ylä- ja
alaindeksikomennot, niin että ne ensisijaisesti pyrkivät käyttämään Open
Type \=/fontin ominaisuutta. Jos käytössä oleva fontti ei sisällä tukea
ylä- eikä alaindekseille, käytetään Latexin mekaanista keinoa. Paketti
määrittelee pari muutakin hyödyllistä komentoa, muun muassa tähdelliset
versiot edellä mainituista: \koodi{\keno text\-su\-per\-script*} ja
\koodi{\keno text\-sub\-script*}. Nämä komennot toteuttavat aina
mekaanisen ylä- tai alaindeksin. Seuraavassa esimerkissä vertaillaan
oikeita ja mekaanisia (tähdelliset) ylä- ja alaindeksejä.

\pagebreak[3]

\begin{koodilohkosis}
  x\textsuperscript {ab36}
  x\textsuperscript*{ab36} \\
  H\textsubscript {2}SO\textsubscript {4}
  H\textsubscript*{2}SO\textsubscript*{4}
\end{koodilohkosis}

\begin{tulossis}
  x\textsuperscript {ab36}
  x\textsuperscript*{ab36} \\*
  H\textsubscript {2}SO\textsubscript {4}
  H\textsubscript*{2}SO\textsubscript*{4}
\end{tulossis}

Kuten esimerkki paljastaa, lopputuloksessa on eroa. Ensin mainitut ovat
fontin suunnittelijan versioita ja jälkimmäiset Latexin mekaanisesti
tekemiä. Mekaaninen ylä- ja ala\-in\-dek\-si\-toi\-min\-to ohentaa
merkkejä turhan paljon, eikä se ymmärrä poistaa gemenanumeroita
(3\,6\,2\,4) käytöstä vaan latoo ne sellaisenaan suunnilleen oikeaan
paikkaan.

Ylä- ja alaindeksejä käytettäessä on siis syytä ladata
\paketti{real\-scripts}\-/paketti ja käyttää indeksit hallitsevaa Open
Type \=/fonttia. Fonttien ominaisuuksia voi tutkia käyttöjärjestelmän
komentotulkissa komennolla \koodi{otf\-info}. Toisaalta fonttiin
sisältyviä ylä- ja alaindeksejä voi myös kirjoittaa Unicode\-/merkistön
avulla sellaisenaan. Lopputulos on sama.

\pagebreak[3]

\begin{koodilohkosis}
  x²ᵃ x\textsuperscript{2a}
\end{koodilohkosis}

\begin{tulossis}
  x²ᵃ x\textsuperscript{2a}
\end{tulossis}

Edellisessä esimerkissä on kyse Unicode\-/merkeistä \uctunnus{u+00b2
  superscript two} ja \uctunnus{u+1d43 modifier letter small~a}. Niitä
ei kaikissa fonteissa edes ole.

\subsection{Tarkkeet}
%\label{luku:tarkkeet}

Latexissa on useita komentoja tarkkeellisten kirjainten
(\'a\,\v{s}\,\c{c}\,\~o) kirjoittamiseen sekä muille merkeille, joita ei
ehkä ihan helposti saa suoraan näppäimistöltä. Komentoja on koottu
taulukkoon \ref{tlk:tarkkeet}.

Taulukon tarkekomennoissa on käytetty a\=/kirjainta esimerkkinä, mutta
tarke voi liittyä muihinkin kirjaimiin. Merkit voi kirjoittaa
Latex\-/lähdedokumenttiin myös sellaisenaan, eli näiden komentojen
käyttö ei ole välttämätöntä.

\providecommand{\rivi}{}
\renewcommand{\rivi}[3]{\koodi{\keno #1} & #2 & #3 \\}

\leijutlk{
  \begin{tabular}[t]{lll}
    \toprule
    \multicolumn{2}{l}{\ots{Esimerkki}} & \ots{Merkitys} \\
    \midrule
    \rivi{`a}{\`a}{gravis}
    \rivi{'a}{\'a}{akuutti}
    \rivi{\^{}a}{\^a}{sirkumfleksi}
    \rivi{\~{}a}{\~a}{tilde}
    \rivi{\textquotedbl a}{\"a}{treema}
    \rivi{H\{a\}}{\H{a}}{kaksoisakuutti}
    \rivi{r\{a\}}{\r{a}}{yläympyrä}
    \rivi{v\{a\}}{\v{a}}{hattu}
    \rivi{t\{ae\}}{\t{ae}}{sidontakaari}
    \rivi{u\{a\}}{\u{a}}{lyhyysmerkki}
    \rivi{=a}{\=a}{pituusmerkki}
    \rivi{b\{a\}}{\b{a}}{alaviiva}
    \rivi{c\{a\}}{\c{a}}{sedilji}
    \rivi{.a}{\.a}{yläpiste}
    \rivi{d\{a\}}{\d{a}}{alapiste}
    \rivi{k\{a\}}{\k{a}}{ogonek}
    \rivi{AE}{\AE}{AE-ligatuuri}
    \rivi{ae}{\ae}{ae-ligatuuri}
    \bottomrule
  \end{tabular}\hspace{1.3em}%
  \begin{tabular}[t]{lll}
    \toprule
    \multicolumn{2}{l}{\ots{Esimerkki}} & \ots{Merkitys} \\
    \midrule
    \rivi{OE}{\OE}{OE-ligatuuri}
    \rivi{oe}{\oe}{oe-ligatuuri}
    \rivi{L}{\L}{poikkiviiva-L}
    \rivi{l}{\l}{poikkiviiva-l}
    \rivi{O}{\O}{poikkiviiva-O}
    \rivi{o}{\o}{poikkiviiva-o}
    \rivi{DJ}{\DJ}{poikkiviiva-D}
    \rivi{dj}{\dj}{poikkiviiva-d}
    \rivi{DH}{\DH}{versaali-eth}
    \rivi{dh}{\dh}{gemena-eth}
    \rivi{NG}{\NG}{versaali-äng}
    \rivi{ng}{\ng}{gemena-äng}
    \rivi{SS}{\SS}{versaali kaksois-s}
    \rivi{ss}{\ss}{gemena kaksois-s}
    \rivi{TH}{\TH}{versaali thorn}
    \rivi{th}{\th}{gemena thorn}
    \rivi{i}{\i}{pisteetön i}
    \rivi{j}{\j}{pisteetön j}
    \bottomrule
  \end{tabular}
}{
  \caption{Komentoja tarkkeellisten ja muiden kirjainten
    kirjoittamiseen}
  \label{tlk:tarkkeet}
}

\subsection{Muita erikoismerkkejä KESKEN}

% Latex 2e -manuaali, luku 23.

\section{Komennot}
\label{luku:komennot}

\subsection{Perusteet}

Latexin komennot alkavat kenoviivalla (\koodi{\textbackslash}), jonka
jälkeen tulee komennon nimi. Nimi koostuu yleensä pienistä tai isoista
kirjaimista, mutta komento voi olla myös merkkejä.

Komennot voivat ottaa vastaan argumentteja eli lisätietoa, jota komento
käsittelee ja tarvitsee toimintaansa. Jotkin argumentit voivat olla
pakollisia ja jotkin valinnaisia. Pakolliset kirjoitetaan
aaltosulkeisiin \koodi{\{\ldots\}} ja valinnaiset hakasulkeisiin
\koodi{[\ldots]}.

\begin{koodilohkosis}
  \komento
  \toinenkomento{argu}{mentteja}
  \toinenkomento[valinnainen]{argu}{mentteja}
\end{koodilohkosis}

Komennon nimen perässä olevat sanavälit syödään pois. Seuraavassa
esimerkissä sana \emph{Latex} ladotaan ehjänä, jos vain \koodi{\keno
  komento} itsessään ei kirjoita mitään eikä vaikuta tekstin latomiseen.

\pagebreak[3]

\begin{koodilohkosis}
  La\komento   tex
\end{koodilohkosis}

\begin{tulossis}
  Latex
\end{tulossis}

Jos haluaa komennon jälkeen yhden sanavälin, täytyy kirjoittaa komennon
nimen jälkeen aaltosulkeet: \koodi{\keno komento\{\}}. Aaltosulkeiden
jälkeen ei syödä välejä.

Komennon nimen ja argumenttien välissä voi olla sanavälejä, ja ne kaikki
syödään pois. Komennon ja sen argumentit voi siis kirjoittaa vaikka
seuraavalla tavalla.

\begin{koodilohkosis}
  \toinenkomento  [valinnainen]
     {argu}   {mentteja}
\end{koodilohkosis}

Omien komentojen tärkein tarkoitus on merkintätapojen abstrahointi eli
teknisen toteutuksen ja yksityiskohtien piilottaminen. Abstrahointi voi
helpottaa työskentelyä huomattavastikin ja tehdä lähdedokumentista
helppolukuista. Otetaan esimerkki tämän oppaan toteutuksesta.

Tämä opas käsittelee välillä Unicode\-/merkkejä ja niiden tunnuksia
kuten \uctunnus{u+0061 latin small letter~a}. Merkkien tunnukset
ladotaan erilaisella kirjainleikkauksella, pienversaalilla eli
kapiteelilla. Jos fontti vain tukee pienversaalia, sitä saadaan helposti
komennolla \koodi{\keno text\-sc}. Silti tätä komentoa ei ehkä kannata
käyttää suoraan dokumentissa. Jos nimittäin kirjoittaa dokumentin
täyteen \koodi{\keno text\-sc}\-/komentoja, voi myöhemmin olla työlästä
muuttaa Unicode\-/tunnusten ulko\-asu ja toteutus toisenlaiseksi.

Jossain vaiheessa kirjoittaja oivaltaa, että Unicode\-/tunnukset ovat
englannin kieltä ja että sanoja pitäisi tavuttaa englannin sääntöjen
mukaan eikä suomen. Pitäisi siis liittää \koodi{\keno
  text\-sc}\-/komentojen ympärille vielä \koodi{\keno
  text\-en\-glish}\-/komento.%
\footnote{Komento \koodi{\keno textenglish} on
  \paketti{polyglossia}\-/paketin ominaisuus.} Lähdedokumentin
kirjoittaminen on ikävää ja ulko\-asu sekava, jos Unicode\-/tunnusten
kohdalla on aina \koodi{\keno textenglish\{\keno text\-sc\{\ldots\}\}}.

Parasta olisi jo ennen kirjoittamista miettiä, mitä loogisia rakenteita
teksti sisältää. Erilaisia rakenteita tai ilmauksia varten kannattaa
luoda komento, jotta sen toteutusta voi myöhemmin muuttaa helposti.
Esimerkiksi Unicoden merkkitunnuksille voisi luoda oman komennon
\koodi{\keno uctunnus}, jota käytetään aina tunnusten ilmaisemiseen
Latex\-/dokumentissa. Komento määritellään vain yhdessä paikassa, ja
määritelmää on helppoa muuttaa. Tekstikin pysyy selkeänä, kun siellä on
vain korkean tason komentoja, jotka ilmaisevat tarkoituksen eivätkä
teknistä toteutusta.

\subsection{Komentojen määrittely}
\label{luku:komennot-määr}

Komentojen määrittelyyn on kolme erilaista komentoa, ja niille kaikille
annetaan samanlaiset argumentit. Komennot ovat seuraavat:

\begin{koodilohkosis}
  \newcommand     {\nimi}[n][oletus]{määritelmä}
  \renewcommand   {\nimi}[n][oletus]{määritelmä}
  \providecommand {\nimi}[n][oletus]{määritelmä}
\end{koodilohkosis}

Ensimmäinen pakollinen argumentti on komennon nimi (\koodi{\keno nimi}).
Komento \koodi{\keno newcommand} määrittelee uuden komennon. Jos komento
on jo olemassa, annetaan virheilmoitus. Toinen komento \koodi{\keno
  renewcommand} määrittelee olemassa olevan komennon uudelleen. Se antaa
virheilmoituksen, jos komentoa ei ollut olemassa. Kolmas komento
\koodi{\keno providecommand} puolestaan määrittelee uuden komennon vain
siinä tapauksessa, että sellaista ei ollut ennen olemassa. Se ei anna
virheilmoitusta.

Komentojen toinen pakollinen argumentti (\koodi{määritelmä}) sisältää
komennon määritelmän eli mitä tahansa tekstiä tai komentoja.
Suoritusvaiheessa komento ikään kuin vaihdetaan sen määritelmäksi.

\pagebreak[3]

\begin{koodilohkosis}
  \newcommand{\komento}{Minua komennettiin!}
  \komento
\end{koodilohkosis}

\begin{tulossis}
  Minua komennettiin!
\end{tulossis}

Komentojen ensimmäinen valinnainen argumentti (\koodi{n}) on luku, joka
kertoo, kuinka monta argumenttia määriteltävä komento käsittelee.
Määritelmässä voi käyttää parametreja \koodi{\#1}, \koodi{\#2},
\koodi{\#3} jne., ja ne korvautuvat komennon suoritusvaiheessa
ensimmäisellä, toisella, kolmannella jne. argumentilla.

\pagebreak[3]

\begin{koodilohkosis}
  \newcommand{\komento}[2]{Sanoit #1 ja #2!}
  \komento{hip}{hei}
\end{koodilohkosis}

\begin{tulossis}
  Sanoit hip ja hei!
\end{tulossis}

Toinen valinnainen argumentti (\koodi{oletus}) -- jos se on mukana --
kertoo, että määriteltävän komennon ensimmäinen argumentti on
valinnainen ja että tämä on sen ole\-tus\-arvo. Ole\-tus\-arvoa
käytetään silloin, kun valinnaista argumenttia ei ole annettu.

\pagebreak[3]

\begin{koodilohkosis}
  \newcommand{\komento}[3][tyyppi]{Hei #1, sanoit #2 ja #3!}
  \komento{hip}{hei} \\
  \komento[Leslie]{hip}{hei}
\end{koodilohkosis}

\begin{tulossis}
  Hei tyyppi, sanoit hip ja hei! \\
  Hei Leslie, sanoit hip ja hei!
\end{tulossis}

Joskus yhden komennon määritelmä sisältää komennon \koodi{\keno
  renewcommand}, joka sitten määrittelee uudelleen jonkin toisen
komennon. Silloin parametrit \koodi{\#1}, \koodi{\#2} jne. on
tarkoitettu ensimmäisen eli uloimman kerroksen käsiteltäväksi. Sisempi
kerros käyttää parametreja \koodi{\#\#1}, \koodi{\#\#2} jne.

Kaikista kolmesta komentojen määrittelykomennosta on olemassa
tähdellinen versio eli sellainen, jonka komennon nimen lopussa on tähti
(\koodi{*}). Latexin komennoissa on tapana, että tähdellinen versio --
jos sellainen on olemassa -- tarjoaa samaan asiaan jonkin toisenlaisen
näkökulman.

\begin{koodilohkosis}
  \newcommand*     {\nimi}[n][oletus]{määritelmä}
  \renewcommand*   {\nimi}[n][oletus]{määritelmä}
  \providecommand* {\nimi}[n][oletus]{määritelmä}
\end{koodilohkosis}

Komentojen määrittelyssä tähdelliset versiot toimivat muuten samalla
tavalla, mutta ne antavat virheilmoituksen, jos komennolle annetut
argumentit sisältävät enemmän kuin yhden tekstikappaleen. Niinpä
seuraava esimerkki tuottaa käännettäessä virheen.

\begin{koodilohkosis}
  \newcommand*{\komento}[1]{Teksti: #1}

  \komento{
    Ensimmäinen tekstikappale.

    Toinen tekstikappale.
  }
\end{koodilohkosis}

\koodi{\keno newcommand*}\-/komennolla määritelty \koodi{\keno komento}
ei siis suostu ottamaan vastaan argumentteja, jotka sisältävät kappaleen
vaihtumisen eli enemmän kuin yhden tekstikappaleen. Tähdelliset versiot
tuovat tällaisen suo\-jaus\-omi\-nai\-suu\-den.

\subsection{Hyödyllistä lisätietoa}
\label{luku:komennot-lisä}

Komennon määrittelyssä on välillä hyötyä \koodi{\keno
  ignorespaces}\-/komennosta, joka jättää sanavälit huomioimatta
komennon jälkeen. Ilman tätä komentoa tulisi seuraavassa esimerkissä
sanojen väliin yksi välilyönti.

\pagebreak[3]

\begin{koodilohkosis}
  \newcommand{\komento}[1]{#1\ignorespaces}
  \komento{yhdys}       sana
\end{koodilohkosis}

\begin{tulossis}
  yhdyssana
\end{tulossis}

Aaltosulkeilla (luku \ref{luku:aaltosulkeet}) voi rajata
komentomäärittelyn vai\-ku\-tus\-aluet\-ta. Seuraavan esimerkin alussa
asetetaan \koodi{\keno komento} tiettyyn alkuperäismääritelmään.
Aaltosulkeiden sisällä se määritellään väliaikaisesti uudestaan.
Aaltosulkeilla rajatun ympäristön jälkeen komennon uusi määritelmä
lakkaa ja komento palautuu alkuperäiseksi.

\pagebreak[3]

\begin{koodilohkosis}
  \newcommand{\komento}{alkuperäinen}
  \komento
  {%
    \renewcommand{\komento}{muutettu}
    \komento
  }
  \komento
\end{koodilohkosis}

\begin{tulossis}
  alkuperäinen muutettu alkuperäinen
\end{tulossis}

Monimutkaisiin komentoihin voidaan tarvita ehtorakenteita. Ne saa
toteutettua \paketti{ifthen}\=/paketin tarjoaman \koodi{\keno
  if\-then\-else}\-/komennon avulla. Se on ohjelmointikielistä tuttu
ehtorakenne: jos annettu ehtolauseke on tosi, käsitellään then\-/haara;
muussa tapauksessa käsitellään else-haara. Lisätietoa saa kyseisen
paketin ohjekirjasta.\footnote{\url{https://www.ctan.org/pkg/ifthen}}

\section{Ympäristöt}
%\label{luku:ymparistot}

Ympäristöt ovat rakenteita, joilla on aloittava \koodi{\keno
  begin}\-/komento ja lopettava \koodi{\keno end}\-/komento sekä
yksilöllinen nimi. Ympäristöjen ajatuksena on, että jokin ominaisuus tai
jotkin toiminnot ovat voimassa vain ympäristön sisällä ja asiat
palautuvat ennalleen ympäristön jälkeen. Tässä mielessä ne toimivat
samalla tavalla kuin aaltosulkeet (luku \ref{luku:aaltosulkeet}). Jos
esimerkiksi fonttiasetusta (luku \ref{luku:kirjaintyypit}) muuttaa
ympäristön sisäpuolella, asetus palautuu ympäristön jälkeen samaksi kuin
se oli ennen ympäristön alkua. Samoin ympäristön sisällä määritellyt
komennot (luku \ref{luku:komennot-määr}) ovat voimassa vain kyseisessä
ympäristössä.

\begin{koodilohkosis}
  \begin{nimi}
    % ympäristön
    % vaikutusalue
  \end{nimi}
\end{koodilohkosis}

Yleisin ympäristö on nimeltään \koodi{document}, jonka sisään koko
dokumentin sisältö kirjoitetaan. Ympäristöjä käytetään tavallisesta
leipätekstistä poikkeavien rakenteiden ilmaisemiseen, esimerkiksi
luetelmiin ja taulukoihin (luvut \ref{luku:luetelmat} ja
\ref{luku:taulukot}). Ympäristöjä voi tehdä itsekin mihin hyvänsä
tarkoitukseen. Niitä määritellään seuraavilla komennoilla.

\begin{koodilohkosis}
  \newenvironment   {nimi}[n][oletus]{aloitus}{lopetus}
  \renewenvironment {nimi}[n][oletus]{aloitus}{lopetus}
\end{koodilohkosis}

Komento \koodi{\keno newenvironment} määrittelee uuden ympäristön. Se
antaa virheilmoituksen, jos samanniminen ympäristö on jo olemassa.
Komento \koodi{\keno renewenvironment} puolestaan määrittelee uudelleen
ympäristön, joka on jo olemassa. Se antaa virheilmoituksen, jos
ympäristöä ei ollutkaan olemassa.

Argumentit ovat lähes samanlaiset kuin komentojen määrittelyssä (luku
\ref{luku:komennot-määr}). Ympäristöjen määrittelykomennoilla on kolme
pakollista argumenttia: ensimmäinen on ympäristön nimi, toinen on
ympäristön aloitusmääritelmä (\koodi{aloitus}) ja kolmas on
lopetusmääritelmä (\koodi{lopetus}).

\begin{koodilohkosis}
  \newenvironment{ymp}{Tästä se alkaa.}{Tähän se päättyy.}

  \begin{ymp}
    Ympäristön sisältöä.
  \end{ymp}
\end{koodilohkosis}

\begin{tulossis}
  Tästä se alkaa. Ympäristön sisältöä. Tähän se päättyy.
\end{tulossis}

Tavallisesti ympäristön aloitusmääritelmään kirjoitetaan jonkin toisen
ympäristön aloituskomento sekä mahdollisesti suoritetaan joitakin
asetuskomentoja. Vastaavasti lopetusmääritelmässä lopetetaan ympäristö
eli palataan normaaliin tilaan. Tarkoituksena on abstrahoida jokin
monimutkaisempi kokonaisuus eli tehdä uusi helppokäyttöinen ympäristö, joka
piilottaa teknisen toteutuksen.

\begin{koodilohkosis}
  \newenvironment{ymp}
  {\begin{mahtavuus}
      \omia\hienoja\asetuksia}
    {\end{mahtavuus}}
\end{koodilohkosis}

Omille ympäristölle voi määritellä argumentteja samalla tavalla kuin
komennoillekin (luku \ref{luku:komennot-määr}). Ensimmäinen valinnainen
argumentti (\koodi{n}) on luku joka kertoo, kuinka monta argumenttia
määriteltävä ympäristö käsittelee. Ympäristön aloitusmääritelmässä voi
argumentteihin viitata parametreilla \koodi{\#1}, \koodi{\#2},
\koodi{\#3} jne.

Jos toinen valinnainen argumentti (\koodi{oletus}) on mukana, se
ilmaisee, että määriteltävän ympäristön ensimmäinen argumentti on
valinnainen ja että tämä on sen ole\-tus\-arvo. Oletusta käytetään
silloin, kun valinnaista argumenttia ei ole annettu. Argumentit annetaan
ympäristön aloittavan \koodi{\keno begin}\-/komennon yhteydessä.

\begin{koodilohkosis}
  \begin{ymp}[valinnainen]{argu}{mentteja}
    % ympäristön
    % vaikutusalue
  \end{ymp}
\end{koodilohkosis}

Ympäristön määrittelykomennoille on myös tähdelliset versiot
\koodi{\keno newenvironment*} ja \koodi{\keno renewenvironment*}. Ne
toimivat samoin kuin edellä kuvatut tavallisetkin komentoversiot, mutta
ne eivät salli, että määritellylle ympäristölle annetut argumentit
sisältävät enemmän kuin yhden tekstikappaleen. Toiminta on siis sama
kuin komentojenkin määrittelyn tähdellisissä versioissa (luku
\ref{luku:komennot-määr}).

\begin{koodilohkosis}
  \newenvironment*   {nimi}[n][oletus]{aloitus}{lopetus}
  \renewenvironment* {nimi}[n][oletus]{aloitus}{lopetus}
\end{koodilohkosis}

Joskus ympäristöjen määrittelyyn on hyödyllistä sisällyttää komento
\koodi{\keno ignorespaces}, joka jättää huomioimatta komennon jälkeiset
sanavälit. Toinen hyödyllinen on \koodi{\keno
  ig\-nore\-spaces\-af\-ter\-end}, joka jättää huomioimatta ympäristön
lopettavan \koodi{\keno end}\-/komennon jälkeiset sanavälit.

\pagebreak[3]

\begin{koodilohkosis}
  \newenvironment{ymp}
    {Yhdys\ignorespaces}
    {esi\ignorespacesafterend}

  \begin{ymp}
    sana% kommentti poistaa seuraavan sanavälin
  \end{ymp}   merkki.
\end{koodilohkosis}

\begin{tulossis}
  Yhdyssanaesimerkki.
\end{tulossis}

\section{Mitat}
\label{luku:mitat}

\subsection{Mittayksiköt}

Koska typografia on pitkälti teksti- ja muiden elementtien sijoittelua,
tarvitaan sitä varten mittavälineitä. Niinpä Latexissakin on
pituusmittoja (engl. \emph{length}) ja useita pituuden mittayksiköitä.
Taulukkoon \ref{tlk:mittayksikot} on koottu mittayksiköiden lyhenteet ja
merkitykset. Teknisesti on samantekevää, mitä yksiköitä käyttää, sillä
ne ovat vain välineitä pituuden ilmaisemiseen. Sisäisesti Tex käyttää
sp-yksikköä, joka ilmaisee samalla mittojen tarkkuuden: pienin jakamaton
yksikkö on 1\,sp.

\leijutlk{
  \begin{tabular}{ll}
    \toprule
    \ots{Lyh.} & \ots{Merkitys} \\
    \midrule
    bp & piste uudessa pica-järjestelmässä, 1/72 tuumaa, 0,3528 mm \\
    pt & piste vanhassa pica-järjestelmässä, 1/72,27 tuumaa, 0,3515 mm \\
    pc & pica eli 12 pt-pistettä \\
    sp & 1/65536 pt-pistettä, Texin sisäisesti käyttämä yksikkö \\
    dd & piste Didot-järjestelmässä, 0,376 mm \\
    cc & cicero eli 12 dd-pistettä \\
    mm & millimetri \\
    cm & senttimetri \\
    in & tuuma, 25,4 mm \\
    ex & nykyisen fontin x-korkeus, perus- ja gemenalinjan etäisyys \\
    em & typografisen neliön sivun pituus, sama kuin fontin koko \\
    \bottomrule
  \end{tabular}
}{
  \caption{Latexin mittayksiköiden lyhenteet ja merkitykset}
  \label{tlk:mittayksikot}
}

Usein tietyt yksiköt ovat vakiintuneet tiettyihin tilanteisiin.
Esimerkiksi fonttien kokoja ja rivikorkeuksia on tapana mitata
pistemittojen avulla. Nykyään käytetään lähinnä bp\-/yksikön mukaista
pistettä, joka tuli käyttöön Post Script \=/standardin myötä vuonna 1984
ja jota käytetään julkaisuohjelmissa. Sivun mittoja kuten leveyttä,
korkeutta ja marginaaleja ilmaistaan tavallisesti metrijärjestelmän
avulla eli senttimetreissä tai millimetreissä.

Latexin mittojen mittaluvuissa desi\-maa\-li\-erot\-ti\-me\-na on piste,
ja mittayksikön lyhenne kirjoitetaan kiinni mittalukuun. Seuraavassa
esimerkissä tehdään vaakasuuntaisia ja pystysuuntaisia välejä
komennoilla \koodi{\keno hspace} ja \koodi{\keno vspace}.

\pagebreak[3]

\begin{koodilohkosis}
  Sanat\hspace{1.2cm}hassusti
  \vspace{2mm}

  \hspace{1.75em}erillään.
\end{koodilohkosis}

\begin{tulossis}
  Sanat\hspace{1.2cm}hassusti  \nopagebreak
  \vspace{2mm}

  \hspace{1.75em}erillään.
\end{tulossis}

\subsection{Mittakomennot ja typografinen viivasto}

Mittoja tallennetaan eräänlaisiin muuttujiin, jotka näyttävät päällepäin
komennoilta eli niiden alussa on kenoviiva (\koodi{\keno}) ja sitten
kirjaimista koostuva nimi. Esimerkiksi mitta \koodi{\keno text\-width}
on teks\-ti\-alueen leveys nykyisellä sivulla. Komentomaisesta
ulko\-asus\-taan huolimatta mittoja ei voi suorittaa komentoina; ne
sopivat vain komennon argumentiksi, silloin kun tarvitaan mitta.

Uusia mittoja luodaan komennolla \koodi{\keno new\-length} ja olemassa
olevia mittoja asetetaan esimerkiksi komennoilla \koodi{\keno
  set\-length} ja \koodi{\keno add\-to\-length}. Omien mittoja on
tarpeen luoda silloin, kun halutaan määritellä tietynsuuruinen mitta,
jota käytetään Latex\-/koodissa useita kertoja.

\begin{koodilohkosis}
  \newlength{\omamitta}         % luodaan mitta
  \setlength{\omamitta}{2.3em}  % asetetaan mitta
  \addtolength{\omamitta}{1em}  % kasvatetaan mittaa
  \addtolength{\omamitta}{-1em} % vähennetään mittaa
\end{koodilohkosis}

Näin luotuja mittoja voi käyttää mittayksiköiden tavoin, eli niille voi
asettaa eteen kertoimen. Esimerkiksi seuraava \koodi{\keno
  hspace}\-/komento luo vaakasuuntaisen välin, jonka pituus on 0,7
kertaa \koodi{\keno oma\-mitta}.

\begin{koodilohkosis}
  \hspace{0.7\omamitta}
\end{koodilohkosis}

Koska vaakasuuntaisten välien tekeminen on typografiassa varsin
tavallista, on niitä varten olemassa omia komentoja. Typografisen neliön
levyisen (1~em) välin voi tehdä komennolla \koodi{\keno quad}. Sen
puolikkaan (\murtoluku{1/2}\,em) saa komennolla \koodi{\keno en\-space}.
Ohuke eli \murtoluku{1/6}\,em-väli tehdään \koodi{\keno,}\-/komennolla,
josta on tarkempaa tietoa luvussa \ref{luku:ohuke}.

\leijukuva{
  \begin{tikzpicture}
    [viiva/.style={line width=.7bp}, xscale=1.1, yscale=1.9,
    baseline=0pt]
    \node at (.04,.25) {\fontsize{120bp}{120bp}\selectfont p};

    \draw [viiva, color=red] (-1,.98) rectangle (1,-.5);
    \draw [viiva, color=red] (1,.98) -- (2.25,.98);
    \draw [viiva, color=red] (-1,.02) -- (2.25,.02);
    \draw [viiva, color=red] (1,-.5) -- (2.25,-.5);

    \draw [viiva, <->, color=black] (1.2,.02) -- (1.2,.98);
    \node at (1.9,.5) {korkeus};

    \draw [viiva, <->, color=black] (1.2,.02) -- (1.2,-.5);
    \node at (1.9,-.25) {syvyys};

    \draw [viiva, <->, color=black] (-1,1.1) -- (1,1.1);
    \node at (0,1.25) {leveys};

    \node at (3.13,1.61) {ylälinja};
    \node at (3.13,1.44) {versaalilinja};
    \node at (3.13,.98) {gemenalinja};
    \node at (3.13,.02) {peruslinja};
    \node at (3.13,-.5) {alalinja};

    \node at (6.52,.74) {\fontsize{120bp}{120bp}\selectfont H};

    \draw [viiva, color=red] (5.05,1.47) rectangle (7.95,.02);
    \draw [viiva, color=red] (5.05,.02) -- (4,.02);
    \draw [viiva, color=red] (5.05,1.47) -- (4,1.47);
    \draw [viiva, color=red] (7.95,1.58) -- (4,1.58);
    \draw [viiva, color=red] (7.95,.98) -- (4,.98);

    \draw [viiva, <->, color=black] (4.86,.02) -- (4.86,1.47);
    \node at (4.1,.5) {korkeus};

    \draw [viiva, <->, color=black] (5.05,-.1) -- (7.95,-.1);
    \node at (6.5,-.3) {leveys};
\end{tikzpicture}
}{
  \caption{Kirjainten mitat ja typografinen viivasto}
  \label{kuva:kirjainmitat}
}

Latex sisältää myös komennot mittojen poimimiseen kirjaimista tai muista
merkeistä. Mittoja on kolme: leveys (\textenglish{width}), korkeus
(\textenglish{height}) ja syvyys (\textenglish{depth}). Leveys on merkin
viemä tila leveyssuunnassa. Korkeus tarkoittaa merkin korkeutta
peruslinjan yläpuolella, ja syvyys on merkin korkeus peruslinjan
alapuolella. Kuva \ref{kuva:kirjainmitat} havainnollistaa näitä kolmea
mittaa sekä typografista viivastoa.

Gemenalinja sijaitsee gemenakirjainten eli pienaakkosten korkeudella.
Peruslinjan ja gemenalinjan etäisyys on fontin x\=/korkeus (1\,ex).
Optisen vaikutelman vuoksi gemenalinja ei tarkoita ehdotonta
gemenakirjainten ylintä kohtaa. Esimerkiksi p\=/kirjaimen yläpääte ja
silmukan yläkaari voivat yltää hieman gemenalinjan yläpuolelle ja
silmukan alakaari peruslinjan alapuolelle. Fonttien suunnittelijat
tekevät tällaisia optisia korjauksia, jotta kirjainten hahmot näyttävät
yhtä korkeilta ja tasapainoisilta yhdessä.

Versaalilinja sijaitsee versaalikirjainten eli suuraakkosten
korkeudella. Jotkin kirjaimet voivat yltää hieman versaalilinjan
yläpuolellekin. Esimerkiksi joidenkin fonttien Hk\=/kirjaimia
vertailemalla näkee, että k\=/kirjaimen yläpääte yltää H\=/kirjaimen eli
versaalilinjan yläpuolelle, ylälinjan tuntumaan.

\pagebreak[3]

Merkkien leveyden, korkeuden ja syvyyden voi mitata alla olevan
esimerkin komennoilla. Esimerkin ensimmäisellä rivillä luodaan uudet
mitat \koodi{\keno leveys}, \koodi{\keno korkeus} ja \koodi{\keno
  syvyys}, joihin sitten tallennetaan merkkien mitat.

\begin{koodilohkosis}
  \newlength{\leveys} \newlength{\korkeus} \newlength{\syvyys}
  \settowidth{\leveys}{abc} % merkkien ”abc” leveys
  \settoheight{\korkeus}{H} % merkin ”H” korkeus
  \settodepth{\syvyys}{p}   % merkin ”p” syvyys
\end{koodilohkosis}

\pagebreak[3]

Mitat saa näkyviin kirjoittamalla mitan eteen komennon \koodi{\keno
  the}. Näin mitan pituus ladotaan dokumenttiin. Yksikkönä on
typografinen piste (pt).

\begin{koodilohkosis}
  Leveys: \the\leveys, korkeus: \the\korkeus, syvyys: \the\syvyys.
\end{koodilohkosis}

\begin{tulossis}
  Leveys: 14.62865pt, korkeus: 6.81897pt, syvyys: 2.4662pt.
\end{tulossis}

Aiemmin mainituista optisista korjauksista johtuu, että gemenakirjaimet
eivät ole välttämättä täsmälleen samankorkuisia. Gemena\=/x asettuu
yleensä perus- ja gemenalinjojen väliin, mutta gemena\=/o voi yltää
aavistuksen verran linjojen ylä- ja alapuolelle. Alla on esimerkki,
jossa mitataan ja tulostetaan x:n ja o:n korkeus.

\pagebreak[3]

\begin{koodilohkosis}
  \newlength{\korkeusx} \newlength{\korkeuso}
  \settoheight{\korkeusx}{x}
  \settoheight{\korkeuso}{o}
  x-korkeus: \the\korkeusx, o-korkeus: \the\korkeuso
\end{koodilohkosis}

\begin{tulossis}
  x-korkeus: 4.54247pt, o-korkeus: 4.62679pt
\end{tulossis}

\subsection{Venyvät mitat}

Edellä on puhuttu vain kiinteistä mitoista, mutta Latex tuntee myös
venyvät mitat. Niiden ajatuksena on, että Latexille voi antaa luvan
kutistaa tai venyttää mittaa tietyissä rajoissa. Venyviä mittoja
käytettään usein pystysuuntaisissa väleissä, esimerkiksi väliotsikon
edellä ja jälkeen tai tekstikappaleiden välissä. Latex pystyy latomaan
sivut yleensä paremman näköiseksi, kun sille antaa venyvien mittojen
avulla hieman säätövaraa. Alla on esimerkki venyvän kappalevälin
(\koodi{\keno par\-skip}) määrittämisestä. Samalla asetetaan kappaleen
ensimmäisen rivin sisennys (\koodi{\keno par\-in\-dent}) nollaan
(\koodi{0em}).

\begin{koodilohkosis}
  \setlength{\parskip}{2ex plus 0.2ex minus 0.1ex}
  \setlength{\parindent}{0em}
\end{koodilohkosis}

Venyvissä mitoissa mainitaan ensin normaali pituus ja sitten sanoilla
\koodi{plus} ja \koodi{minus} ilmaistaan, kuinka paljon mitta voi venyä
tai kutistua. Molempia ei välttämättä tarvitse antaa.

Venyvät mitat voivat sisältää ''äärettömän'' mittayksikön \koodi{fill},
joka antaa luvan venyttää mittaa niin, että kaikki käytettävissä oleva
tila täyttyy. Äärettömän mittayksikön kanssa mittaluku ilmaisee
suhdeluvun muihin äärettömiin mittoihin. Seuraava esimerkki
havainnollistaa asiaa.

\pagebreak[3]

\begin{koodilohkosis}
  x\hspace{0mm plus 1fill}x\hspace{0mm plus 2fill}x
\end{koodilohkosis}

\begin{tulossis}
  x\hspace{0mm plus 1fill}x\hspace{0mm plus 2fill}x
\end{tulossis}

Edellisen esimerkin mittojen luonnollinen pituus on nolla millimetriä
(\koodi{0mm}), mutta \koodi{plus} ja \koodi{fill} \=/mitan vuoksi ne
voivat venyä ja täyttää koko käytettävissä olevan tilan. Ensin
mainitulla on suhdeluku 1 (\koodi{1fill}) ja jälkimmäisellä suhdeluku 2
(\koodi{2fill}), joten jälkimmäinen väli on kaksinkertainen ensimmäiseen
verrattuna. Saman äärettömästi venyvän mitan ja suhdeluvut voi ilmaista
myös \koodi{\keno stretch}\-/mitan tai \koodi{\keno hfill}\-/komentojen
avulla seuraavasti.

\pagebreak[3]

\begin{koodilohkosis}
  x\hspace{\stretch{1}}x\hspace{\stretch{2}}x \\
  x\hfill x\hfill\hfill x
\end{koodilohkosis}

\begin{tulossis}
  x\hspace{\stretch{1}}x\hspace{\stretch{2}}x \\
  x\hfill x\hfill\hfill x
\end{tulossis}

Vastaavasti pystysuuntaisen äärettömästi venyvän välin voi tehdä
komennolla \koodi{\keno vfill}, joka tekee saman asian kuin \koodi{\keno
  vspace\{0mm plus 1fill\}}.

Äärettömästi venyvälle, koko tilan täyttävälle mittayksikölle on itse
asiassa kolme eri versiota: \koodi{fil}, \koodi{fill} ja \koodi{filll}.
Niiden erona on tärkeysjärjestys. Ensin mainittu \koodi{fil} on vähiten
tärkeä, ja viimeinen eli \koodi{filll} on tärkein. Jos samassa
yhteydessä käytetään eri tär\-keys\-as\-tei\-sia yksiköitä,
korkeammantasoiset mitätöivät alemmantasoiset.

\pagebreak[3]

\begin{koodilohkosis}
  x\hspace{0mm plus 1filll}x\hspace{0mm plus 1fill}x
\end{koodilohkosis}

\begin{tulossis}
  x\hspace{0mm plus 1filll}x\hspace{0mm plus 1fill}x
\end{tulossis}

Edellisessä esimerkissä ensimmäinen venyvä mitta \koodi{1filll} mitätöi
jälkimmäisen \koodi{1fill} kokonaan. Yleensä lienee parasta käyttää
keskimmäistä (\koodi{fill}), mutta eri tär\-keys\-as\-teil\-le voi olla
käyttöä esimerkiksi makropaketin koodissa: \koodi{fil} sallii, että
käyttäjä tai muu koodi syrjäyttää asetuksen; \koodi{filll} on ehdoton
sääntö, joka syrjäyttää muut.

\section{Laskurit KESKEN}

% \usepackage{chngcntr}
% \usepackage{totcount}

Laskureiden avulla Latex pitää kirjaa esimerkiksi sivunumeroista,
lukujen ja alalukujen sekä kuvien ja muiden elementtien numeroinnista.
Esimerkiksi nyt olemme sivulla \arabic{page}, ja kyseessä on
pääluvun~\arabic{chapter} alaluku~\arabic{section}. Edellisen virkkeen
luvut tulevat Latexin laskureista automaattisesti.

Tavallisista laskureista ei tarvitse itse huolehtia, sillä ne ovat vain
tekniikkaa, joka vaikuttaa korkeamman tason toimintojen taustalla.
Joskus on kuitenkin käyttöä myös omille laskureille, ja toisaalta
joidenkin laskureiden avulla käyttäjä voi muuttaa tiettyjä asetuksia.
