\documentclass[a4paper,10pt,notitlepage,oneside]{book}
\usepackage[vscale=.75, hscale=.68, footskip=1.5cm]{geometry}
\usepackage{fontspec}
\usepackage{polyglossia}
\usepackage{ragged2e}
\usepackage{footmisc}
%\usepackage{titling}
\usepackage{titlesec}
\usepackage{titletoc}
\usepackage{color}
\usepackage{floatrow}
\usepackage{caption}
\usepackage{newfloat}
\usepackage{fancyvrb}
%\usepackage{placeins}
\usepackage{booktabs}
%\usepackage{fancyhdr}
%\usepackage{noindentafter}
\usepackage[unicode,hyperfootnotes=false]{hyperref}
\usepackage[shortcuts]{extdash}

\hypersetup{ hidelinks, bookmarksopen, bookmarksnumbered,
  pdfauthor={Teemu Likonen} }

\setdefaultlanguage{finnish}
\setotherlanguage{english}

\setmainfont{Linux Libertine O}
[Scale=1.4, Numbers=Lowercase]

\setsansfont{Linux Biolinum O}
[Scale=MatchLowercase, Numbers=Lowercase]

\setmonofont{Linux Libertine Mono O}
[Scale=MatchLowercase, LetterSpace=-2]

\linespread{1.58}

\newcommand{\gemenanum}{\addfontfeatures{Numbers=Lowercase}}
\newcommand{\versaalinum}{\addfontfeatures{Numbers=Uppercase}}

\clubpenalty=10000
\widowpenalty=10000
\setlength{\emergencystretch}{1em}

\setlength{\parindent}{1.2em}
\setlength{\parskip}{0em}
\setlength{\footnotemargin}{\parindent}
\setlength{\floatsep}{3ex}
\setlength{\textfloatsep}{4ex}

\DeclareFloatingEnvironment[ name={Esimerkki} ]{esim}

\DefineVerbatimEnvironment{koodilohko}{Verbatim}{
  fontsize=\footnotesize, gobble=1, frame=lines, numbers=left,
  numbersep=.3em, xleftmargin=0em, xrightmargin=0em, baselinestretch=1.3 }

\floatsetup{ font={small}, justification=raggedright,
  margins=raggedright, captionskip=1ex, capposition=bottom }

\DeclareCaptionFont{rivivali}{\linespread{1.3}\selectfont}

\captionsetup{ font={small, sf, rivivali}, labelfont={bf}, textfont={},
  textformat=period, margin=.5em, justification=raggedright,
  singlelinecheck=off }

\captionsetup[esim]{ skip=-.5ex, margin=.5em }

\newcommand{\leiju}[3]{
  \begin{#1}
    \floatbox{#1}{#2}{#3}
  \end{#1}
}

\newcommand{\leijutlk}[2]{\leiju{table}{#1}{\versaalinum #2}}

%\fancyhf{}
% \fancyhf[hl]{\small\nouppercase{\leftmark}}
% \fancyhf[hr]{\small\nouppercase{\rightmark}}
% \fancyhf[fc]{\thepage}
%\renewcommand{\headrulewidth}{1pt}

% \fancypagestyle{plain}{%
%   \fancyhf{}
%   \fancyhf[fc]{\thepage}
%   \renewcommand{\headrulewidth}{0pt}
% }

\definecolor{tavu}{rgb}{1,0,0}
\definecolor{sitova}{rgb}{1,0,0}

\newcommand{\keno}{\textbackslash}
\newcommand{\koodi}[1]{\textsf{#1}}
\newcommand{\tavuvihje}{\keno-}
\newcommand{\tavukohta}{\textcolor{tavu}{\rule{1pt}{1.5ex}}}
\newcommand{\sitovaym}{\textcolor{sitova}{-}}

\newcommand{\ots}[1]{{\sffamily\bfseries\versaalinum #1}}

\addto{\captionsfinnish}{
  \renewcommand{\contentsname}{Sisällys}
}

\newcommand{\otsikkotyyli}{ \raggedright \linespread{1.1} \sffamily
  \bfseries }

\titleformat{\chapter}[display]{\LARGE\bfseries}
{\chaptertitlename\hspace{.3em}\thechapter}{1.5ex}{\otsikkotyyli\Huge}[]
\titlespacing*{\chapter}{0em}{*13}{*8}

\titleformat{\section}{\otsikkotyyli\Large}
{\thesection}{.8em}{}[]
\titlespacing*{\section}{0pt}{*4}{*2}

\titleformat{\subsection}{\otsikkotyyli\normalsize}
{\thesubsection}{.8em}{}[]
\titlespacing*{\subsection}{0pt}{*3}{*1}

\begin{document}
\pagestyle{empty}

\hyphenation{
  Ext-dash
  Font-spec
  Lua-la-tex
  ni-men-omaan
  Open-type
  Poly-glos-sia
  True-type
  Xe-la-tex
}

{
  \renewcommand{\thispagestyle}[1]{}
  %\tableofcontents
}

\clearpage
\pagestyle{plain}

\chapter*{Esipuhe}
\addcontentsline{toc}{chapter}{Esipuhe}
\phantomsection

% Suurin innoittajani tämän kirjan kirjoittamiselle on ollut Latex itse.

% Miksi Latex?

\input{luku-valmistautuminen}

\chapter{Merkintäkieli}
\section{Erikoismerkit}
\section{Komennot, ympäristöt ja lohkot}
\section{Laatikot}

\chapter{Dokumentin asetukset}
\section{Dokumenttiluokat}
\label{luku:dokumenttiluokat}
\section{Kirjaintyypit}
\label{luku:kirjaintyypit}

\subsection{Perheet, muodot, sarjat, koot}

% \rmfamily \sffamily \ttfamily
% \mdseries \bfseries
% \upshape \slshape \itshape \scshape

\leijutlk{
  \caption{Pistekoot dokumenttiluokkien valitsimilla \koodi{10pt, 11pt}
    ja \koodi{12pt}}
  \label{tlk:pistekoot}
}{
  \begin{tabular}{lrrr}
    \toprule
    \ots{Komento} & \ots{10pt} & \ots{11pt} & \ots{12pt} \\
    \midrule
    \koodi{\keno tiny} & 5 & 6 & 6 \\
    \koodi{\keno scriptsize} & 7 & 8 & 8 \\
    \koodi{\keno footnotesize} & 8 & 9 & 10 \\
    \koodi{\keno small} & 9 & 10 & 11 \\
    \koodi{\keno normalsize} & 10 & 11 & 12 \\
    \koodi{\keno large} & 12 & 12 & 14 \\
    \koodi{\keno Large} & 14 & 14 & 17 \\
    \koodi{\keno LARGE} & 17 & 17 & 20 \\
    \koodi{\keno huge} & 20 & 20 & 25 \\
    \koodi{\keno Huge} & 25 & 25 & 25 \\
    \bottomrule
  \end{tabular}
}

\subsection{Koot suhteellisesti}
\subsection{Koot absoluuttisesti}
\section{Kieli}
\label{luku:kieliasetukset}
\section{Sivu}
\label{luku:sivuasetukset}
\subsection{Marginaalit ja mitat}
\subsection{Ylä- ja alatunnisteet}

\chapter{Kirjoittaminen}
\section{Kappale}
\subsection{Tasaus}
\subsection{Sisennykset ja välit}
\subsection{Riippuva sisennys}
\section{Korostus}
\section{Otsikot}
\section{Alaviitteet}
\section{Ristiviitteet}
\section{Tavutus}
\section{Luetelmat}
\section{Taulukot}
\section{Kelluvat osat}
\section{Lähdeluettelo ja -viitteet}
\section{Grafiikka}

\chapter{Matematiikka}

\chapter{Virittely}
\section{Laskurit}
\section{Päiväykset ja kellonajat}

\end{document}
