% Tekijä:   Teemu Likonen <tlikonen@iki.fi>
% Lisenssi: Creative Commons Nimeä-JaaSamoin 4.0 Kansainvälinen (CC BY-SA 4.0)
%           https://creativecommons.org/licenses/by-sa/4.0/legalcode.fi

\documentclass{book}
\usepackage[a5paper, twoside,
hscale=.72, vscale=.77,
hratio=17:28, vratio=20:32,
footskip=12mm, footnotesep=13bp,
marginparwidth=50bp, marginparsep=10bp]{geometry}
\usepackage[quiet]{fontspec}
% \usepackage[mode=text, input-decimal-markers={,}, output-decimal-marker={,},
% per-mode=symbol]{siunitx}
\usepackage{polyglossia}
\usepackage[finnish,showseconds=false]{datetime2}
\usepackage{ragged2e}
\usepackage[hang,bottom,norule]{footmisc}
\usepackage[clearempty]{titlesec}
%\usepackage{titletoc}
%\usepackage{graphicx}
\usepackage{color}
\usepackage{floatrow}
\usepackage{caption}
\usepackage{newfloat}
\usepackage{fancyvrb}
\usepackage{booktabs}
\usepackage{noindentafter}
\usepackage{soul}
% \usepackage{imakeidx} \makeindex[intoc]
% \usepackage{ifthen}
\usepackage{chngcntr}
\usepackage{realscripts}
\usepackage{csquotes}
\usepackage[style=authoryear, dashed=false, maxbibnames=99]{biblatex}
\usepackage{tikz}
\usepackage{totcount}
\usepackage{nowidow} \setnowidow
%\usepackage{showhyphens}
\usepackage[unicode,hyperfootnotes=false]{hyperref}
\usepackage[shortcuts]{extdash}

\hypersetup{ hidelinks, bookmarksopen, bookmarksnumbered,
  pdfauthor={Teemu Likonen}, pdftitle={Käytännöllistä Latexia} }

\title{Käytännöllistä Latexia}
\author{Teemu Likonen}
\date{\DTMdate}

\setdefaultlanguage{finnish}
\setotherlanguage{english}
\newcommand{\englishfont}{}
\newcommand{\englanti}[1]{\textenglish{#1}}

\defaultfontfeatures{Ligatures={TeX, Common}}

\setmainfont {libertinusserif}
[Numbers=Lowercase,
UprightFont=*-regular,
ItalicFont=*-italic,
BoldFont=*-semibold,
BoldItalicFont=*-semibolditalic,
Extension=.otf]

\setsansfont {libertinussans}
[Scale=MatchLowercase, Numbers=Lowercase,
UprightFont=*-regular,
ItalicFont=*-italic,
BoldFont=*-bold,
BoldItalicFont=*-bolditalic,
Extension=.otf]

\setmonofont {libertinusmono}
[Scale=MatchLowercase, Ligatures={TeXReset, NoCommon}, FakeStretch=.8,
HyphenChar=-,
UprightFont=*-regular,
ItalicFont=*-italic,
BoldFont=*-bold,
BoldItalicFont=*-bolditalic,
Extension=.otf]

% Esimerkkien tulosteet tällä fontilla:
\newcommand{\erikoisfontti}{\rmfamily}

\newfontface{\viivastofontti}{libertinusserif-regular.otf}

\renewcommand{\footnotesize}{\fontsize{8bp}{9bp}\selectfont}
\renewcommand{\small}{\fontsize{9bp}{10bp}\selectfont}
\renewcommand{\normalsize}{\fontsize{10.5bp}{13bp}\selectfont}
\renewcommand{\large}{\fontsize{13bp}{15bp}\selectfont}
\renewcommand{\Large}{\fontsize{16bp}{18bp}\selectfont}
\renewcommand{\LARGE}{\fontsize{20bp}{22bp}\selectfont}
\renewcommand{\huge}{\fontsize{24bp}{26bp}\selectfont}
\linespread{1}
\normalsize

\newcommand{\gemenanum}{\addfontfeatures{Numbers=Lowercase}}
\newcommand{\versaalinum}{\addfontfeatures{Numbers=Uppercase}}
\newcommand{\murtoluku}[2]{{\addfontfeatures{Fractions=On}#1/#2}}

\urlstyle{sf}
\newcommand{\kulmaurl}[1]
{\href{#1}{\guilsinglleft\nolinkurl{#1}\guilsinglright}}
\newcommand{\kulmasp}[1]
{\href{mailto:#1}{\guilsinglleft\nolinkurl{#1}\guilsinglright}}

\setlength{\emergencystretch}{1em}

\setlength{\parindent}{1em}
\setlength{\bibhang}{\parindent}
\setlength{\bibitemsep}{.5ex plus .1ex minus .1ex}
\newlength{\sisennys}\setlength{\sisennys}{1.8em}
\setlength{\parskip}{0em}
\setlength{\footnotemargin}{.8em}
\setlength{\floatsep}{.8em plus .3em minus .1em}
\setlength{\textfloatsep}{1.3em plus .3em minus .1em}

\addbibresource{kirjallisuutta.bib}
\nocite{*}
\renewcommand{\bibfont}{\RaggedRight}

\DeclareDelimFormat[bib]{nametitledelim}{\addcolon\space}
\DeclareDelimFormat[bib]{multinamedelim}{\space--\space}
\DeclareDelimFormat[bib]{finalnamedelim}{\space--\space}
\DeclareFieldFormat{url}{Saatavissa: \kulmaurl{#1}}
\DeclareNameAlias{sortname}{family-given}
\DeclareNameAlias{default}{family-given}
\DefineBibliographyStrings{finnish}{andothers = {ym.}}

\DeclareFloatingEnvironment[ name={Esimerkki} ]{esimerkki}

\renewcommand{\theFancyVerbLine}
{\sffamily\versaalinum\fontsize{6bp}{7bp}\selectfont\arabic{FancyVerbLine}}

\DefineVerbatimEnvironment{koodilohko}{Verbatim}{ fontsize=\small,
  gobble=2, frame=single, framesep=.4em, numbers=left, numbersep=.3em,
  xleftmargin=0em, xrightmargin=0mm, baselinestretch=1 }

\DefineVerbatimEnvironment{koodilohkosis}{Verbatim}{
  fontsize=\small, gobble=2, frame=none, numbers=none,
  numbersep=0em, xleftmargin=\sisennys, xrightmargin=0mm,
  baselinestretch=1, samepage=true }

\newenvironment{tulossis}{%
    \begin{list}{}{
        \setlength{\leftmargin}{\sisennys}
        \erikoisfontti\small
      }\item[⇒]}{%
    \end{list}}

\floatsetup{ font={small}, justification=raggedright,
  margins=raggedright, captionskip=2ex, capposition=bottom }

\captionsetup{ font={small, sf}, labelfont={bf}, textfont={},
  textformat=period, margin=.5em, justification=RaggedRight,
  singlelinecheck=off }

\captionsetup[esimerkki]{ skip=-0.5ex, margin=.5em }

\newcommand{\leijutlk}[2]{%
  \begin{table*}
    \floatbox{table}{\versaalinum #1}{#2}
  \end{table*}}

\newcommand{\leijukuva}[2]{%
  \begin{figure*}
    \floatbox{figure}{#1}{#2}
  \end{figure*}}

\newenvironment{nluetelma}{%
  \begin{list}{\theenumi.}{
      \usecounter{enumi}
      \setlength{\leftmargin}{1.3em}
      \setlength{\labelsep}{.3em}
      \setlength{\itemsep}{.2ex plus .2ex}
      \setlength{\parsep}{0em}
      \setlength{\topsep}{.2ex plus .2ex}
      \RaggedRight
    }}{%
  \end{list}}

\definecolor{tavu}{rgb}{1,0,0}

\newcommand{\keno}{\textbackslash}
\newcommand{\koodi}[1]{\texttt{#1}}
\newcommand{\marginaali}[1]{\marginpar{\footnotesize #1}}
\newcommand{\koodimargin}[1]{\marginaali{\koodi{#1}}}
\newcommand{\tavukohta}{\textcolor{tavu}{\raisebox{-.2ex}{\rule{.6bp}{2ex}}}}
\newcommand{\uctunnus}[1]{\textsc{\englanti{#1}}}
\newcommand{\paketti}[1]{\textsf{#1}}
\newcommand{\avctan}[1]{\footnote{\url{https://www.ctan.org/pkg/#1}}}

\newcommand{\ots}[1]{{\sffamily\bfseries #1}}
\newcommand{\otsrivi}[1]{{\sffamily #1}}
\newcommand{\katk}{\discretionary{}{}{}}

\NoIndentAfterEnv{koodilohkosis}
\NoIndentAfterEnv{tulossis}
\NoIndentAfterEnv{nluetelma}

\addto{\captionsfinnish}{
  \renewcommand{\contentsname}{Sisällys}
}

\setcounter{tocdepth}{2}
\setcounter{secnumdepth}{2}

\counterwithout{footnote}{chapter}

\newcommand{\otsikkotyyli}{ \raggedright \sffamily \bfseries }

\titleformat{\chapter}[display]{\Large\bfseries}
{\chaptertitlename\hspace{.3em}\thechapter}{1.5ex}{\otsikkotyyli\huge}[]
\titlespacing*{\chapter}{0em}{*13}{*8}

\titleformat{\section}{\otsikkotyyli\large}
{\thesection}{.8em}{}[]
\titlespacing*{\section}{0pt}{*4}{*2}

\titleformat{\subsection}{\otsikkotyyli\normalsize}
{\thesubsection}{.8em}{}[]
\titlespacing*{\subsection}{0bp}{*2}{*1}

\titleformat{\subsubsection}{\normalsize\bfseries\itshape}
{\thesubsubsection}{.8em}{}[]
\titlespacing*{\subsubsection}{\parindent}{*2}{*1}

\regtotcounter{chapter}

\begin{document}
\pagestyle{empty}

\hyphenation{
  abst-ra-hoin-ti
  abst-rak-te-ja
  abst-rak-tio-ta-soil-la
  abst-rak-tio-ta-sol-la
  abst-rak-tio-ta-sol-taan
  abst-rak-tio-ta-son
  ala-in-dek-se-jä
  ala-in-dek-seil-le
  ala-in-dek-si-ko-men-not
  ala-in-dek-sien
  ala-in-dek-sin
  ala-in-dek-sit
  ala-in-dek-siä
  alku-osaa
  an-tiik-va
  an-tiik-va-font-tien
  an-tiik-vaa
  an-tiik-vaan
  an-tiik-van
  ar-ti-cle
  au-thor
  ba-bel
  beam-er
  bib-latex
  dis-cre-tionary
  doc-u-ment
  doc-u-ment-class
  ed-i-tor
  esit-te-ly-osaan
  esit-te-ly-osak-si
  esit-te-ly-osas-sa
  ext-dash
  font-size
  font-spec
  font-ti-ase-tuk-siin
  font-ti-ase-tuk-sil-le
  font-ti-ase-tus
  font-ti-ase-tus-ta
  ge-om-e-try
  gro-tes-ki
  gro-tes-kin
  hspace
  hy-phen-ation
  jul-kai-su-oh-jel-miin
  jul-kai-su-oh-jel-mis-sa
  kie-li-ase-tuk-sia
  kie-li-ase-tuk-sis-ta
  kie-li-ase-tuk-set
  kie-li-ase-tus-ten
  konk-reet-ti-ses-ti
  konk-reet-ti-sia
  käyt-töön-ot-toon
  käyt-töön-oton
  käyt-töön-otos-sa
  käyt-töön-otto
  käyt-töön-ottoa
  la-don-ta-oh-jel-man
  La-tex-mk
  La-tex-mk-rc
  large
  line-spread
  Lua-latex
  Match-Low-er-case
  mem-oir
  mit-ta-yk-si-köi-den
  mit-ta-yk-si-köi-tä
  mit-ta-yk-si-köl-le
  mit-ta-yk-si-kön
  new-com-mand
  new-en-vi-ron-ment
  ni-men-omaan
  note
  ole-tus-ar-vo
  ole-tus-ar-voa
  ole-tus-ase-tuk-set
  ole-tus-ase-tuk-sia
  ole-tus-ase-tuk-sil-la
  page
  pages
  par-in-dent
  para-graph
  pe-rus-osas-ta
  pe-rus-osat
  pe-rus-osien
  pe-rus-osiin
  pien-aak-ko-set
  pien-aak-kos-ten
  poly-glos-sia
  pub-lish-er
  pää-asial-li-nen
  pää-asial-li-sen
  pää-asias-sa
  re-new-com-mand
  re-new-en-vi-ron-ment
  sa-man-ai-kai-ses-ti
  Scale
  sec-tion
  slides
  small
  style
  sub-sec-tion
  suur-aak-kos-ten
  table
  teks-ti-edi-to-ria
  teks-ti-edi-to-ril-la
  teks-ti-edi-to-rin
  teks-ti-edi-to-ris-sa
  teks-ti-edi-to-ris-sa-kin
  teks-ti-edi-to-ris-ta
  teks-ti-osa
  teks-ti-osaan
  teks-ti-osan
  teks-ti-osas-sa
  the-bib-li-og-ra-phy
  tie-to-kone-oh-jel-ma
  tie-to-kone-oh-jel-mat
  tie-to-kone-oh-jel-mia
  title
  ty-po-gra-fi-sen
  ty-po-gra-fi-ses-ta
  ty-po-gra-fi-ses-ti
  ty-po-gra-fi-set
  ty-po-gra-fi-sia
  ty-po-gra-fi-sis-ta
  ty-po-gra-fia
  ty-po-gra-fian
  ty-po-gra-fias-sa
  ty-po-gra-fis-ten
  ulko-asu
  ulko-asua
  ulko-asun
  ulko-asus-ta
  ulko-asuun
  Uni-code
  Uni-coden
  use-pack-age
  vaih-to-eh-don
  vaih-to-eh-to
  vaih-to-eh-to-ja
  vaih-to-eh-toi-ses-ti
  vir-he-il-moi-tuk-sen
  vir-he-il-moi-tus
  vir-he-il-moi-tus-ta
  vol-ume
  vspace
  väli-ai-kai-ses-ti
  väli-ai-kais-tie-dos-to-jen
  väli-ai-kais-tie-dos-toa
  väli-ai-kais-tie-dos-toon
  väli-ai-kais-tie-dos-tot
  väli-ot-si-kon
  väli-ot-si-kot
  Xe-latex
  ylä-in-dek-si
  ylä-in-dek-sit
}

\newgeometry{top=1cm, bottom=1.8cm, hmargin=1.3cm}
\pdfbookmark[0]{Kansi}{luku:kansi}
\DTMsetstyle{finnish}

\vspace*{.2\textheight}

{

  \setlength{\parindent}{0pt}

  \fontsize{14bp}{14bp}\rmfamily Teemu Likonen

  \fontsize{48bp}{48bp}\sffamily\bfseries%
  \hspace{-3bp}%
  Käytännöllistä

  \fontsize{60bp}{60bp}\selectfont%
  \hspace{-5bp}%
  \LaTeX{}ia

}

\vfill

{

  \raggedleft
  Latex-ladontajärjestelmän opas \\
  \DTMtoday

}

\clearpage
\restoregeometry
\pdfbookmark[0]{Tekijänoikeus}{luku:tekijänoikeus}
\DTMsetstyle{finnish-numeric}

\null\vfill

{
  \setlength{\parindent}{0em}
  \setlength{\parskip}{1.2ex plus .1ex}

  \section*{Käytännöllistä Latexia}

  Tekijä: Teemu Likonen \kulmasp{tlikonen@iki.fi}

  Päiväys: \DTMtoday{} kello \DTMcurrenttime{} (Ensijulkaisu: ei ole
  julkaistu vielä)

  Lisenssi: \emph{Creative Commons Nimeä-Jaa\-Samoin 4.0 Kansainvälinen}
  (\textsc{cc by-sa} 4.0). Lisenssi antaa sinulle luvan kopioida ja
  levittää tätä teosta tai sen osia missä tahansa välineessä ja
  muodossa. Sisältöä saa muokata, ja sen pohjalta saa luoda uusia
  teoksia mihin tahansa tarkoitukseen, myös kaupallisesti. Ehdot ovat
  seuraavat:

  \begin{list}{\textbullet}{
      \setlength{\leftmargin}{1em}
      \setlength{\topsep}{0ex}
      \setlength{\partopsep}{0ex}
      \setlength{\itemsep}{0ex}
    }
  \item Sinun on mainittava tekijä(t) asianmukaisesti, tarjottava linkki
    lisenssin koko tekstiin (ks. alla) sekä mainittava, mikäli olet
    tehnyt muutoksia.
  \item Jos muokkaat teosta tai luot sen pohjalta uuden teoksen, sinun on
    jaettava muutoksiasi samalla lisenssillä kuin alkuperäistä teosta.
  \item Et saa asettaa sellaisia oikeudellisia ehtoja tai teknisiä
    estoja, jotka estävät muita tekemästä asioita, jotka tämä lisenssi
    sallii.
  \end{list}

  Lisenssin koko teksti: \\
  \url{https://creativecommons.org/licenses/by-sa/4.0/legalcode.fi}

  Poikkeus lisenssiin: Jos teet tästä teoksesta oman sähköisen
  dokumentin (esim. \textsc{pdf}), dokumenttiin mahdollisesti
  upotettavat fontit eivät kuulu tämän lisenssin piiriin, eli niillä saa
  olla jokin toinen lisenssi. Ilmaise sähköisen dokumentin käyttäjille
  selvästi, jos upotettujen fonttien lisenssi rajoittaa käyttöä eri
  tavalla kuin tämä lisenssi ja että tämä lisenssi on silti voimassa
  teoksen muun sisällön osalta. (Jos haluat, voit poistaa tämän
  poikkeuksen, jolloin myös fonttien lisenssin on oltava yhteensopiva
  tämän lisenssin kanssa.)

}

\cleardoublepage
\pagestyle{plain}
\pdfbookmark[0]{Sisällys}{luku:sisallys}

\tableofcontents

\cleardoublepage

\input{esipuhe}
\input{valmistautuminen}
\input{merkintakieli}
\input{asetukset}
\input{kirjoittaminen}

\chapter{Matematiikka}
\label{luku:matematiikka}

% \section{Käyttöönotto}
% \subsection{Unicode-math}
% \subsection{Mathspec}
% \subsection{Vanha tapa}
% \section{Jotain sisältöäkin tarvitaan}
% \section{Ympäristöjä}
% align... (amsmath)

...

\chapter{Muuta}

...

\section{Päiväykset ja kellonajat}
% \day\month\year
% Em. laskureissa on kenoviiva
% datetime2-paketti

...

\section{Omat paketit}

...

\section{Omat dokumenttiluokat}
\label{luku:omat_dokumenttiluokat}

Oman dokumenttiluokan tekeminen voi olla hyödyllistä silloin, kun täytyy
tuottaa paljon samantyylisiä dokumentteja ja haluaa määrittää monet
asetukset valmiiksi. Jotkin oppilaitokset ovat tehneet oman
dokumenttiluokan, koska opinnäytetöille ja muille julkaisuille halutaan
yhtenäinen ulkoasu ja typografia.

\backmatter

\chapter [Kirjallisuutta] {Kirjallisuutta \enspace {\normalsize\ldots ja
    muuta hyödyllistä}}

\printbibliography[heading=none]

%\printindex

\end{document}
