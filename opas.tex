% Tekijä:   Teemu Likonen <tlikonen@iki.fi>
% Lisenssi: GNU General Public License, versio 3

\documentclass{book}
\usepackage[a5paper, twoside,
ratio={17:28, 20:32}, scale={.72, .77},
footskip=12mm, footnotesep=13bp,
marginparwidth=50bp, marginparsep=10bp]{geometry}
\usepackage{fontspec}
\usepackage[mode=text, input-decimal-markers={,}, output-decimal-marker={,},
per-mode=symbol]{siunitx}
\usepackage{polyglossia}
\usepackage[finnish,showseconds=false]{datetime2}
\usepackage{ragged2e}
\usepackage[hang,bottom,norule]{footmisc}
\usepackage[clearempty]{titlesec}
%\usepackage{titletoc}
%\usepackage{graphicx}
\usepackage{color}
\usepackage{floatrow}
\usepackage{caption}
\usepackage{newfloat}
\usepackage{fancyvrb}
\usepackage{booktabs}
%\usepackage{fancyhdr}
\usepackage{noindentafter}
\usepackage{soul}
% \usepackage{imakeidx} \makeindex[intoc]
% \usepackage{ifthen}
\usepackage{chngcntr}
\usepackage{realscripts}
\usepackage{csquotes}
\usepackage[style=authoryear, dashed=false, maxbibnames=99]{biblatex}
\usepackage{tikz}
\usepackage{totcount}
\usepackage[unicode,hyperfootnotes=false]{hyperref}
\usepackage[shortcuts]{extdash}

\hypersetup{ hidelinks, bookmarksopen, bookmarksnumbered,
  pdfauthor={Teemu Likonen}, pdftitle={Käytännöllistä Latexia} }

\title{Käytännöllistä Latexia}
\author{Teemu Likonen}
\date{\DTMdate}

\setdefaultlanguage{finnish}
\setotherlanguage{english}
\newcommand{\englishfont}{}
\newcommand{\englanti}[1]{\textenglish{#1}}

% Tavutus päälle
\defaultfontfeatures[\ttfamily]{}

\setmainfont {Linux Libertine O} [Numbers=Lowercase]
\setsansfont {Linux Biolinum O} [Scale=MatchLowercase, Numbers=Lowercase]
\setmonofont {Linux Libertine Mono O}
[Scale=MatchLowercase, Ligatures={TeXReset, NoCommon}, FakeStretch=.8]

\newfontface{\varafontti}{TeX Gyre Pagella}[Scale=MatchLowercase]
\newfontface{\viivastofontti}{TeX Gyre Termes}

\renewcommand{\footnotesize}{\fontsize{8bp}{9bp}\selectfont}
\renewcommand{\small}{\fontsize{9bp}{10bp}\selectfont}
\renewcommand{\normalsize}{\fontsize{10.5bp}{13bp}\selectfont}
\renewcommand{\large}{\fontsize{13bp}{15bp}\selectfont}
\renewcommand{\Large}{\fontsize{16bp}{18bp}\selectfont}
\renewcommand{\LARGE}{\fontsize{20bp}{22bp}\selectfont}
\renewcommand{\huge}{\fontsize{24bp}{26bp}\selectfont}
\linespread{1}
\normalsize

\newcommand{\gemenanum}{\addfontfeatures{Numbers=Lowercase}}
\newcommand{\versaalinum}{\addfontfeatures{Numbers=Uppercase}}
\newcommand{\murtoluku}[1]{{\addfontfeatures{Fractions=On}#1}}

\urlstyle{same}
\newcommand{\kulmaurl}[1]
{\href{#1}{\guilsinglleft\nolinkurl{#1}\guilsinglright}}
\newcommand{\angleemailurl}[1]
{\href{mailto:#1}{\guilsinglleft\nolinkurl{#1}\guilsinglright}}

\clubpenalty=10000
\widowpenalty=10000
\setlength{\emergencystretch}{1em}

\setlength{\parindent}{1em}
\setlength{\bibhang}{\parindent}
\setlength{\bibitemsep}{.5ex plus .1ex minus .1ex}
\newlength{\sisennys}\setlength{\sisennys}{1.8em}
\setlength{\parskip}{0em}
\setlength{\footnotemargin}{.8em}
\setlength{\floatsep}{.8em plus .3em minus .1em}
\setlength{\textfloatsep}{1.3em plus .3em minus .1em}

\addbibresource{kirjallisuutta.bib}
\nocite{*}
\DeclareDelimFormat[bib]{nametitledelim}{\addcolon\space}
\DeclareDelimFormat[bib]{multinamedelim}{\space--\space}
\DeclareDelimFormat[bib]{finalnamedelim}{\space--\space}
\DeclareFieldFormat{url}{Saatavissa: \kulmaurl{#1}}
\DeclareNameAlias{sortname}{family-given}
\DeclareNameAlias{default}{family-given}
\DefineBibliographyStrings{finnish}{andothers = {ym.}}

\DeclareFloatingEnvironment[ name={Esimerkki} ]{esimerkki}

\renewcommand{\theFancyVerbLine}
{\sffamily\versaalinum\fontsize{6bp}{7bp}\selectfont\arabic{FancyVerbLine}}

\DefineVerbatimEnvironment{koodilohko}{Verbatim}{ fontsize=\small,
  gobble=2, frame=single, framesep=.4em, numbers=left, numbersep=.3em,
  xleftmargin=0em, xrightmargin=0mm, baselinestretch=1 }

\DefineVerbatimEnvironment{koodilohkosis}{Verbatim}{
  fontsize=\small, gobble=2, frame=none, numbers=none,
  numbersep=0em, xleftmargin=\sisennys, xrightmargin=0mm,
  baselinestretch=1, samepage=true }

\newenvironment{tulossis}
{\begin{list}{}{
      \setlength{\leftmargin}{\sisennys}
      \small
    }\item[⇒]
  }{\end{list}}

\floatsetup{ font={small}, justification=raggedright,
  margins=raggedright, captionskip=2ex, capposition=bottom }

\captionsetup{ font={small, sf}, labelfont={bf}, textfont={},
  textformat=period, margin=.5em, justification=RaggedRight,
  singlelinecheck=off }

\captionsetup[esimerkki]{ skip=-0.5ex, margin=.5em }

\newcommand{\leijutlk}[2]{%
  \begin{table*}
    \floatbox{table}{\versaalinum #1}{#2}
  \end{table*}}

\newcommand{\leijukuva}[2]{%
  \begin{figure*}
    \floatbox{figure}{#1}{#2}
  \end{figure*}}

%\fancyhf{}
% \fancyhf[hl]{\small\nouppercase{\leftmark}}
% \fancyhf[hr]{\small\nouppercase{\rightmark}}
% \fancyhf[fc]{\thepage}
%\renewcommand{\headrulewidth}{1bp}

% \fancypagestyle{plain}{%
%   \fancyhf{}
%   \fancyhf[fc]{\thepage}
%   \renewcommand{\headrulewidth}{0bp}
% }

\definecolor{tavu}{rgb}{1,0,0}
\definecolor{sitova}{rgb}{1,0,0}

\newcommand{\keno}{\textbackslash}
\newcommand{\koodi}[1]{\texttt{\englanti{#1}}}
\newcommand{\koodimargin}[1]{\marginpar{\koodi{#1}}}
\newcommand{\tavukohta}{\textcolor{tavu}{\rule{.6bp}{1.5ex}}}
\newcommand{\sitovaym}{\textcolor{sitova}{-}}
\newcommand{\uctunnus}[1]{\englanti{\textsc{#1}}}
\newcommand{\paketti}[1]{\englanti{\textsf{#1}}}
\newcommand{\avctan}[1]{\footnote{\url{https://www.ctan.org/pkg/#1}}}

\newcommand{\ots}[1]{{\sffamily\bfseries\versaalinum #1}}
\newcommand{\otsrivi}[1]{{\sffamily\versaalinum #1}}

\NoIndentAfterEnv{koodilohkosis}
\NoIndentAfterEnv{tulossis}

\addto{\captionsfinnish}{
  \renewcommand{\contentsname}{Sisällys}
}

\setcounter{tocdepth}{2}
\setcounter{secnumdepth}{2}

\counterwithout{footnote}{chapter}

\newcommand{\otsikkotyyli}{ \raggedright \sffamily \bfseries }

\titleformat{\chapter}[display]{\Large\bfseries}
{\chaptertitlename\hspace{.3em}\thechapter}{1.5ex}{\otsikkotyyli\huge}[]
\titlespacing*{\chapter}{0em}{*13}{*8}

\titleformat{\section}{\otsikkotyyli\large}
{\thesection}{.8em}{}[]
\titlespacing*{\section}{0pt}{*4}{*2}

\titleformat{\subsection}{\otsikkotyyli\normalsize}
{\thesubsection}{.8em}{}[]
\titlespacing*{\subsection}{0bp}{*2}{*1}

% \titleformat{\subsubsection}{\normalsize\itshape\bfseries}
% {\thesubsubsection}{.8em}{}[]
% \titlespacing*{\subsubsection}{0bp}{*3}{*1}

\regtotcounter{chapter}

\begin{document}
\pagestyle{empty}
\addfontfeatures{Numbers=Lowercase}

\hyphenation{
  abst-ra-hoin-ti
  abst-rak-te-ja
  abst-rak-tio-ta-soil-la
  abst-rak-tio-ta-sol-la
  abst-rak-tio-ta-sol-taan
  abst-rak-tio-ta-son
  ala-in-dek-se-jä
  ala-in-dek-seil-le
  ala-in-dek-si-ko-men-not
  ala-in-dek-sien
  ala-in-dek-sin
  ala-in-dek-sit
  ala-in-dek-siä
  alku-osaa
  an-tiik-va
  an-tiik-vaa
  an-tiik-va-font-tien
  ba-bel
  doc-u-ment
  doc-u-ment-class
  esit-te-ly-osas-sa
  ext-dash
  font-size
  font-spec
  font-ti-ase-tuk-siin
  font-ti-ase-tuk-sil-le
  font-ti-ase-tus
  font-ti-ase-tus-ta
  gro-tes-ki
  hspace
  hy-phen-ation
  jul-kai-su-oh-jel-miin
  jul-kai-su-oh-jel-mis-sa
  konk-reet-ti-ses-ti
  konk-reet-ti-sia
  käyt-töön-ot-toon
  käyt-töön-oton
  käyt-töön-otos-sa
  käyt-töön-otto
  käyt-töön-ottoa
  la-don-ta-oh-jel-man
  La-tex-mk
  La-tex-mk-rc
  large
  line-spread
  Lua-la-tex
  Match-Low-er-case
  mit-ta-yk-si-köi-den
  mit-ta-yk-si-köi-tä
  mit-ta-yk-si-köl-le
  mit-ta-yk-si-kön
  new-com-mand
  new-en-vi-ron-ment
  ni-men-omaan
  ole-tus-ase-tuk-set
  ole-tus-ase-tuk-sia
  ole-tus-ase-tuk-sil-la
  pe-rus-osas-ta
  pe-rus-osat
  pe-rus-osien
  pe-rus-osiin
  pien-aak-ko-set
  pien-aak-kos-ten
  poly-glos-sia
  re-new-com-mand
  re-new-en-vi-ron-ment
  sa-man-ai-kai-ses-ti
  Scale
  suur-aak-kos-ten
  teks-ti-edi-to-ria
  teks-ti-edi-to-ril-la
  teks-ti-edi-to-rin
  teks-ti-edi-to-ris-sa
  teks-ti-edi-to-ris-sa-kin
  teks-ti-edi-to-ris-ta
  teks-ti-osa
  teks-ti-osan
  tie-to-kone-oh-jel-ma
  tie-to-kone-oh-jel-mat
  tie-to-kone-oh-jel-mia
  ty-po-gra-fi-sen
  ty-po-gra-fi-ses-ta
  ty-po-gra-fi-ses-ti
  ty-po-gra-fi-set
  ty-po-gra-fi-sia
  ty-po-gra-fi-sis-ta
  ty-po-gra-fia
  ty-po-gra-fian
  ty-po-gra-fias-sa
  ty-po-gra-fis-ten
  Type
  ulko-asu
  ulko-asua
  ulko-asun
  ulko-asus-ta
  ulko-asuun
  Uni-code
  use-pack-age
  vaih-to-eh-don
  vaih-to-eh-to
  vaih-to-eh-to-ja
  vir-he-il-moi-tuk-sen
  vir-he-il-moi-tus
  vir-he-il-moi-tus-ta
  vspace
  väli-ai-kai-ses-ti
  väli-ai-kais-tie-dos-to-jen
  väli-ai-kais-tie-dos-toa
  väli-ai-kais-tie-dos-toon
  väli-ai-kais-tie-dos-tot
  väli-ot-si-kon
  väli-ot-si-kot
  Xe-la-tex
  ylä-in-dek-si
  ylä-in-dek-sit
}

\newgeometry{top=1cm, bottom=1.8cm, hmargin=1.3cm}
\pdfbookmark[0]{Kansi}{luku:kansi}
\DTMsetstyle{finnish}

\vspace*{4cm}

{

  \setlength{\parindent}{0pt}

  \fontsize{14bp}{14bp}\rmfamily Teemu Likonen

  \fontsize{48bp}{48bp}\sffamily\bfseries
  \hspace{-3bp}%
  {\addfontfeatures{LetterSpace=-4} Käytännöllistä}

  \hspace{-7bp}%
  {\addfontfeatures{LetterSpace=3, FakeStretch=1.5} \LaTeX{}ia}

}

\vfill

{

  \raggedleft
  Latex-ladontajärjestelmän opas \\
  \DTMtoday

}

\clearpage
\restoregeometry
\pdfbookmark[0]{Tekijänoikeus}{luku:tekijänoikeus}
\DTMsetstyle{finnish-numeric}

\null\vfill

{
  \setlength{\parindent}{0em}
  \setlength{\parskip}{1.2ex plus .1ex}

  \section*{Käytännöllistä Latexia}

  Tekijä: Teemu Likonen \angleemailurl{tlikonen@iki.fi}

  Päiväys: \DTMtoday{} kello \DTMcurrenttime{} (Ensijulkaisu: ei ole
  julkaistu vielä)

  Lisenssi: \englanti{\textsc{gnu} General Public License}, versio~3

  Lisenssi antaa luvan käyttää ja levittää tätä opasta vapaasti.
  Oppaaseen saa myös tehdä muutoksia, mutta jos levittää omaa muunneltua
  versiota, täytyy muunnellut Latex\-/tiedostot (tex, bib) tai muut
  lähdetiedostot antaa muiden käyttöön. Muunnellut versiot täytyy
  levittää tällä samalla lisenssillä tai sen uudemmalla versiolla.

  Lisenssin koko teksti englanninkielisenä: \\
  \url{https://www.gnu.org/licenses/gpl-3.0.html}

}

\cleardoublepage
\pagestyle{plain}
\pdfbookmark[0]{Sisällys}{luku:sisallys}

\tableofcontents

\cleardoublepage

\input{esipuhe}
\input{valmistautuminen}
\input{merkintakieli}
\input{asetukset}
\input{kirjoittaminen}

\chapter{Matematiikka}
\label{luku:matematiikka}

% \section{Käyttöönotto}
% \subsection{Unicode-math}
% \subsection{Mathspec}
% \subsection{Vanha tapa}
% \section{Jotain sisältöäkin tarvitaan}
% \section{Ympäristöjä}
% align... (amsmath)

...

\chapter{Muuta}

...

\section{Päiväykset ja kellonajat}
% \day\month\year
% Em. laskureissa on kenoviiva
% datetime2-paketti

...

\section{Omat paketit}

...

\section{Omat dokumenttiluokat}
\label{luku:omat_dokumenttiluokat}

Oman dokumenttiluokan tekeminen voi olla hyödyllistä silloin, kun täytyy
tuottaa paljon samantyylisiä dokumentteja ja haluaa määrittää monet
asetukset valmiiksi. Joskus oppilaitokset ovat tehneet oman
dokumenttiluokan, koska opinnäytetöille halutaan yhtenäinen ulkoasu ja
typografiset käytännöt.

\backmatter

\chapter{Kirjallisuutta}
\printbibliography[heading=none]

%\printindex

\end{document}
