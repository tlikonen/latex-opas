% Tekijä:   Teemu Likonen <tlikonen@iki.fi>
% Lisenssi: Creative Commons Nimeä-JaaSamoin 4.0 Kansainvälinen
%           (CC BY-SA 4.0)

\chapter{Valmistautuminen}

\section{Käsitteet ja nimet}

Latex ja sen ympärille rakentuneet ohjelmistot ovat käsitteellisesti
aika monimutkainen kokonaisuus, johon kuuluu eri\-/ikäisiä ja
abstraktiotasoltaan erilaisia osia. Mukaan kuuluu tietenkin
konkreettisia tietokoneohjelmia, jotka tekevät konkreettisia asioita.
Mukaan kuuluu kuitenkin myös ihmisten luomia abstrakteja käsitteitä
kuten Latex\-/formaatti, Tex\-/ohjelmointikieli tai muu yleinen idea,
jonka tietokoneohjelmat pyrkivät konkreettisesti toteuttamaan.

Internetissä näkyy silloin tällöin käsitekeskusteluja, jossa
ihmetellään, mihin mikäkin palikka kuuluu käsitteellisesti. Missä
suhteessa jotkin uudemmat osat ovat vanhempiin? Oikeiden termien
osaamisesta voi olla hyötyä, kun pyytää verkossa suurelta yleisöltä
apua. Viestintä vaatii, että puhutaan suunnilleen samaa kieltä. Yritän
seuraavaksi selventää peruskäsitteitä.

\subsection{Tex ja Latex}

Tex on tietokoneohjelma (\koodi{tex}), joka osaa lukea tietynmuotoisia
tekstitiedostoja ja latoa niiden perusteella tekstidokumentin, joka on
tarkoitettu ihmisten luettavaksi. Tex on myös tekstin ladontaan
tarkoitettu ohjelmointikieli. Se noudattaa sille annettuja ohjeita ja
latoo kirjaimia ja muuta tavaraa peräkkäin sivulle. Ihmisten
näkökulmasta Tex on hyvin tekninen ja matalatasoinen järjestelmä, eikä
sellaisten kanssa yleensä haluta olla missään tekemisissä. Siirtykäämme
siis eteenpäin.

Latex toimii korkeammalla abstraktiotasolla kuin Tex. Se on kokoelma
Tex\-/ohjelmointikielen makroja, jotka piilottavat monimutkaiset
tekniset yksityiskohdat ja toteuttavat varsin helppokäyttöisen
merkintäkielen, jolla dokumenttien rakenne ja ulkoasua kuvataan. Ihmiset
siis kirjoittavat yleensä Latex\-/muotoisia dokumentteja, ja Latex
puolestaan huolehtii matalamman tason Texin käskyttämisestä. Latex on
myös tietokoneohjelma (\koodi{latex}, \koodi{pdf\-latex}), jolla
lähdetiedosto käännetään julkaistavaksi dvi- tai pdf\-/dokumentiksi.%
\footnote{\textsc{dvi} = device independent file format; \textsc{pdf} =
  portable document format}

Latex\-/järjestelmästä käytetään tällä hetkellä versiota Latex~2ε, joka
julkaistiin jo vuonna 1994 ja johon ilmestyy pieniä parannuksia
vuosittain. Perusosat ovat kuitenkin varsin muuttumattomia. Varsinainen
kiinnostava kehitys tapahtuukin esimerkiksi Latexin kääntäjissä
(Lualatex ja Xelatex) sekä eri tekijöiden dokumenttiluokissa (luku
\ref{luku:dokumenttiluokat}) ja makropaketeissa.

\subsection{Lualatex ja Xelatex}

Nyky\-aikana Latex\-/dokumentteja ei juuri käännetä alkuperäisillä
\koodi{latex}- tai \koodi{pdf\-latex}\-/ohjelmilla vaan kehittyneemmillä
kään\-täjä\-ohjel\-milla.%
\footnote{Englannin kielellä kääntäjiä on tapana kutsua yleisnimellä
  \emph{\englanti{engine}} 'kone, moottori'.} Niistä tärkeimmät ovat
Lualatex ja Xelatex (tietokoneohjelmat \koodi{lualatex} ja
\koodi{xelatex}). Ne muun muassa osaavat lukea Unicode\-/merkistöllä
kirjoitettuja lähdedokumentteja ja käyttää nyky\-aikaisia \englanti{True
  Type}- ja \englanti{Open Type} \=/fontteja, mitä alkuperäinen Latex ja
Tex eivät osaa.

Lualatexilla ja Xelatexilla ei ole käyttäjän kannalta suurtakaan eroa --
ei välttämättä mitään näkyvää eroa. Ensin mainittu sisältää
Lua\-/nimisen ohjelmointikielen, ja sillä on merkitystä joillekuille
makropakettien tekijöille. Jotkin harvat makropaketit eivät toimi
Lualatexissa, kun taas toiset eivät toimi Xelatexissa. Joskus saattaa
tulla vastaan myös yksittäinen, kehityksestä ehkä jälkeen jäänyt
paketti, joka ei toimi kummassakaan vaan ainoastaan perinteisillä
kääntäjillä (\koodi{latex}, \koodi{pdflatex}).

Miksi on olemassa kaksi ulkoisesti lähes samanlaista kääntäjää? Tärkein
syy taitaa olla se, että Xelatex tehtiin ensin ja myöhemmin jotkut
ajattelivat, että Lua\-/ohjelmointikieli täytyy saada mukaan. Se
oikeastaan pakotti kirjoittamaan koko homman uusiksi. Toteutuksissa on
muitakin sisäisiä eroja. Xelatex oli pitkään suositumpi ja paremmin
tuettu eri makropaketeissa, mutta erot ovat sittemmin tasoittuneet.

Latex\-/dokumentit yleensä kääntyvät yhtä lailla molemmilla ohjelmilla,
mutta joskus valmiissa pdf:ssä näkyy pieniä eroja, kun kääntäjää
vaihtaa. Ainakin joissakin fonttien asetuksissa ja joidenkin
Unicode\-/merkkien käsittelyssä on eroja. On ihan hyödyllistä kokeilla
kääntää omat dokumentit kummallakin ohjelmalla, koska se voi paljastaa
huonoja, epäyhteensopivia käytäntöjä omassa Latex\-/koodissa. Ei ehkä
kuitenkaan kannata vaihtaa kääntäjää viime hetkellä ennen tärkeän
tekstin julkaisua, koska huonolla tuurilla voi tulla ikäviä yllätyksiä.

\subsection{Latex yläkäsitteenä}

Jotta kaikki olisi mahdollisimman sekavaa, sana Latex toimii myös
yleisenä nimityksenä tälle kaikelle. Se esiintyy ilmaisuissa kuten
''Toteutin dokumentin Latexilla'' tai ''Tämä artikkeli on tehty
Latexilla''. Ilmaukset sitten tarkoittavat suunnilleen seuraavanlaista:
Henkilöllä on asennettuna tietokoneelle Latex\-/jakelu (kuten Tex Live).
Hän on kirjoittanut tekstieditorilla (kuten \textsc{gnu} Emacsilla)
tekstitiedoston, jossa on dokumentin sisältö ja Latex\-/makroille
tarkoitettuja komentoja mutta myös joitakin Tex\-/komentoja. Sitten hän
on kääntänyt eli ladotuttanut tekstitiedostonsa pdf\-/tiedostoksi
Latex\-/ladontaohjelman jollakin toteutuksella (kuten Lualatexilla tai
Xelatexilla).

Meille taitaa riittää vain Latexista puhuminen, mutta siitäkin on
mainittava vielä yksi asia. Latexin harrastajat tykkäävät käyttää
dokumenttiensa leipätekstissä logoja kuten \TeX{} ja \LaTeX{}. Usein
teksteissä näkyy myös logojen pohjalta mukailtuja kir\-joi\-tus\-asu\-ja
TeX ja LaTeX. Mielestäni logojen eikä muodikkaiden
kIR\-joi\-Tus\-Asu\-Jen paikka ei ole leipätekstissä. Tässä oppaassa
viittaan kaikkiin nimiin kielenhuollon normien mukaisesti eli käytän
tavallisia erisnimiä kuten Tex ja Latex. Koodi ja komennot ovat siinä
muodossa kuin ne tietokoneelle annetaan, esimerkiksi \koodi{lualatex}.

\section{Asentaminen}
\label{luku:asentaminen}

Latex pitää tietysti asentaa tietokoneelle, jotta sitä voisi käyttää.
Miten edellisessä luvussa kuvattu sekava kokonaisuus saadaan ehjänä
omalle tietokoneelle? Onneksi muut ovat jo ratkaisseet sen ongelman aika
pitkälle.

Tavallisin tapa Latexin käyttöönottoon on jonkin Latexin jakelupaketin
asentaminen. Jakelupaketti sisältää perusosien lisäksi paljon
makropaketteja ja niiden ohjekirjoja. Kaikkea ei koskaan tarvitse, mutta
kun yllättävä tarve tulee tai lukee vinkkejä verkkokeskusteluista, on
mukavaa huomata, että makropaketti olikin itsellä jo valmiina. Siksi
suosittelen kokonaisen jakelupaketin asentamista.

GNU/Linuxissa ja muissa Unix\-/tyyppisissä käyttöjärjestelmissä
käytetään yleensä Tex Live \=/nimistä jakelua. Se on todennäköisesti
saatavilla käyttöjärjestelmäjakelun pakettivarastoista. Esimerkiksi
Debianiin ja sen kaltaisiin järjestelmiin on asennuspaketti
texlive-full, joka asentaa kaiken helposti ja kerralla.

Windows\-/käyttöjärjestelmälle on saatavilla Tex Liven lisäksi Miktex ja
Protext. Mac OS \=/käyttöjärjestelmän kanssa käytettäneen yleensä
Mactex\-/nimistä jakelua.

\section{Apuohjelmia}

\subsection{Tekstieditori}

Kannattaa käyttää kunnollista tekstieditoria, koska se on tärkein
työkalu ja sen kanssa ollaan eniten tekemisissä. Pyri löytämään
sellainen editori, joka osaa värjätä tekstiä Latexin tai Texin
tekstipiirteiden mukaisesti. Väreillä ei sinänsä ole merkitystä, mutta
editorin laadusta se yleensä kertoo paljon. Jos editori tuntee
erilaisten ohjelmointi\-/{} ja merkintäkielten luonnetta ja osaa merkitä
kielen avainsanoja havainnollisilla väreillä, se todennäköisesti on
tehty tehokkaaseen ohjelmointiin ja muuhun vastaavaan työskentelyyn.
Ihan yksinkertaisiin editoreihin ei tuollaisia ominaisuuksia yleensä
tehdä.

\subsection{Pdf-katselin}

Latex\-/kääntäjät eli \=/moottorit kuten Lualatex ja Xelatex tuottavat
pdf\-/tiedoston, ja niiden katselemiseen tarvitaan tietenkin oma
ohjelmansa. Sellaisia on saatavilla paljon erilaisia, ja melkein mikä
tahansa kelpaa, mutta yksi tietty ominaisuus olisi toivottavaa olla:
muuttuneen pdf\-/tiedoston automaattinen lataaminen.

Välillä työskentely on sitä, että tehdään Latex\-/dokumenttiin pieni
muutos, käännetään se ja katsotaan pdf:ää. Lopputulos ei ehkä ihan
miellytä. Muokataan tekstiä tai asetuksia vähän, käännetään ja
katsotaan, miltä ladottu pdf nyt näyttää.

On suuri apu, jos pdf\-/katselimessa ei tarvitse joka kerta valikoiden
kautta avata samaa tiedostoa uudelleen, vaan ohjelma itse huomaa, että
jo avattu tiedosto muuttui tiedostojärjestelmässä, ja lataa sen
automaattisesti uudelleen. Jotkin pdf\-/ohjelmat osaavat tämän. Jotkin
ohjelmat eivät ihan osaa mutta osaavat sentään yhdellä
näppäinpainalluksella avata pdf:n uudelleen tiedostojärjestelmästä.

Hyvän tekstieditorin ja pdf\-/katselimen kanssa työskentely on sujuvaa.
Parhaimmillaan tietty näppäinkomento editorissa tallentaa ja kääntää
dokumentin, ja pian pdf\-/katselin lataa muuttuneen pdf:n
automaattisesti näkyviin. Sekä editorin että pdf\-/katselimen voi pitää
sa\-man\-aikai\-ses\-ti esillä, eikä muualle tarvitse yleensä siirtyä.

\subsection{Latexmk}
\label{luku:latexmk}

Erin\-omaisen hyödyllinen apu\-ohjelma on Latexmk, koska se helpottaa
dokumenttien kääntämistä ja muutakin työskentelyä. Varsin usein
Latex\-/dokumentit täytyy kääntää useita kertoja ennen kuin
pdf\-/tiedosto on valmis. Tämä johtuu siitä, että dokumentit sisältävät
usein ristiviitteitä eli viittauksia dokumentin toisiin osiin. Latex ei
saa ristiviitteitä kohdalleen yhdellä kääntämisellä, vaan ensin se
kirjoittaa viittausten kohteet muistiin väliaikaistiedostoon ja
seuraavilla kääntökerroilla käyttää väliaikaistiedostoa apunaan.

Tavallinenkin Latexin kääntäjä kyllä huomauttaa tietokoneen käyttäjää,
kun uusintakäännös on tarpeen, mutta Latexmk\-/ohjelma käynnistää
uusintakäännöksen itse, aina kun se on tarpeellista. Alla ovat
esimerkkikomennot Latex\-/dokumentin kääntämiseen Lualatexilla ja
Xelatexilla.

\begin{koodilohkosis}
  latexmk -lualatex teksti.tex
  latexmk -xelatex  teksti.tex
\end{koodilohkosis}

Työskentelyä erityisen paljon helpottava valitsin on \koodi{\=/pvc}. Kun
tuo valitsin on mukana komennossa, Latexmk jää tarkkailemaan annettua
Latex\-/tiedostoa, ja kun se huomaa tiedoston muuttuneen, se kääntää
tiedoston automaattisesti uudelleen. Käyttäjän ei siis tarvitse muuta
kuin tallentaa tiedosto tekstieditorista, ja tarkkailutilassa oleva
Latexmk kääntää sen aina itsestään.

Muitakin hyödyllisiä toimintoja on mukana. Seuraavista esimerkeistä
ensimmäinen komento (\koodi{latexmk \=/c}) poistaa kääntämisen aikana
luodut väliaikaistiedostot (\koodi{log}, \koodi{aux}, \koodi{out} ym.),
ja jälkimmäinen rivin komento (\koodi{latexmk \=/C}) poistaa kaikki
luodut tiedostot eli väliaikaistiedostojen lisäksi myös valmiin
pdf\-/tiedoston.

\begin{koodilohkosis}
  latexmk -c teksti.tex
  latexmk -C teksti.tex
\end{koodilohkosis}

Edellisissä esimerkeissä käsitellään lähdetiedostoa nimeltä
\koodi{teksti.\-tex}, mutta jos lähdetiedostoa ei anna komennolle
lainkaan, käännetään kaikki nykyisessä hakemistossa olevat
\koodi{tex}\-/päätteiset tiedostot.

Latexmk\-/ohjelmalle voi tehdä asetustiedoston, johon voi kirjoittaa
omaan käyttöön sopivat asetukset. Asetustiedosto sijoitetaan
tiedostojärjestelmässä käyttäjän kotihakemistoon nimellä
\koodi{.latexmkrc}. Esimerkki \ref{esim:latexmkrc} näyttää, mitä se
voisi ehkä sisältää.

Esimerkin ensimmäisen rivin asetus määrittää, miten pdf\-/tiedostot
tuotetaan tai mitä kääntäjää käytetään oletuksena. Toisella ja
kolmannella rivillä määritellään, millä tavoin Lualatex ja Xelatex
suoritetaan. Tässä esimerkissä ole\-tus\-ase\-tuk\-siin on lisätty
\koodi{non\-stop\-mode}, joka estää kaiken vuorovaikutteisen toiminnan.
Asetus on tarpeen ainakin silloin, kun kääntäjä käynnistetään toisesta
ohjelmasta kuten tekstieditorista eikä vuorovaikutus kääntäjän kanssa
ole mahdollista.

\input{esim-latexmkrc}

Esimerkin \ref{esim:latexmkrc} neljännellä rivillä luetellaan
kääntämisen aikana syntyvien väliaikaistiedostojen päätteitä.
Latexmk\-/ohjelma tuntee yleisimmät väliaikaistiedostot (\koodi{log},
\koodi{aux}, \koodi{out} ym.), mutta tällä asetuksella mukaan voi lisätä
harvinaisempia, joita se ei tunne. Viides rivi määrittää
pdf\-/katseluohjelman, joka käynnistetään, kun käytetään valitsimia
\koodi{\=/pv} tai \koodi{\=/pvc}.

\subsection{Texdoc}

Latexin kirjoittajan täytyy silloin tällöin lukea ohjekirjoja. Vaikka
Latexin perusosat joskus oppisikin ulkoa, ei voi koskaan muistaa
kaikkien hyödyllisten makropakettien kaikkia ominaisuuksia.

Tex Live \=/jakelun (luku \ref{luku:asentaminen}) mukana tulee mainio
komentotulkissa toimiva komento \koodi{texdoc}, jolla voi hakea ja avata
omaan järjestelmään asennettuja Latex\-/aiheisia ohjeita. Jos vaikka
haluaa tutustua esimerkissä \ref{esim:ensimmainen} mainittavaan
\paketti{fontspec}\-/pakettiin syvällisemmin, tarvitsee vain komentaa
\koodi{texdoc fontspec}, ja paketin pdf\-/muotoinen ohjekirja avautuu.

\section{Dokumentin runko}

Luodaan seuraavaksi yksinkertainen Latex\-/dokumentti, jota voi käyttää
Latexin harjoitteluun ja pohjana kokeiluille. Tallenna esimerkin
\ref{esim:ensimmainen} sisältö tekstieditorin avulla tiedostoon vaikkapa
nimellä \koodi{teksti.tex}. Käännä eli lado se pdf\-/tiedostoksi
komennolla \koodi{lualatex teksti.tex} tai komennolla \koodi{xelatex
  teksti.tex} (tai \koodi{latexmk}\-/komennolla, luku
\ref{luku:latexmk}). Tuloksena pitäisi olla tiedosto \koodi{teksti.pdf},
jota voi ihailla jollakin pdf\-/tiedostojen katseluun tarkoitetulla
ohjelmalla.

Esimerkin \ref{esim:ensimmainen} ensimmäisellä rivillä määritellään
dokumenttiluokka \koodi{article}, joka on tietynlainen sivupohja tai
asetusten kokoelma, jonka perustalle aletaan rakentaa omaa sivua. Luokka
\koodi{article} on tyypillinen valinta lyhyehköille teksteille.
Lisätietoa dokumenttiluokista on luvussa \ref{luku:dokumenttiluokat}.

Toisella ja kolmannella rivillä käytetään komentoa \koodi{\keno
  usepackage} ja niiden avulla otetaan käyttöön fontti\-asetuksia
hoitava \paketti{fontspec}\-/paketti ja kieli\-asetuksista vastaava
\paketti{polyglossia}\-/paketti. Kumpaakin tarvitaan melkein joka kerta
dokumenteissa, ja niihin palataan tarkemmin luvuissa
\ref{luku:kirjaintyypit} ja \ref{luku:kieliasetukset}. Sivun asetuksia
käsitellään luvussa \ref{luku:sivuasetukset}.

Seuraavilla riveillä asetetaan kieleksi suomi (\koodi{finnish}) ja
määritetään oletuksena käytettävä fontti tai oikeastaan kokonainen
kirjainperhe. Latin Modern Roman \=/kirjainperheen tilalle voi toki
kokeilla muitakin. Fontin oletuskoko on 10 pistettä, mutta tässä
esimerkissä se venytetään 1,3\-/kertaiseksi eli 13 pisteeseen.
Riviväliin liittyvä kerroin asetetaan rivillä 7.

\begin{esimerkki*}
\begin{koodilohko}
  \documentclass{article}
  \usepackage{fontspec}
  \usepackage{polyglossia}

  \setdefaultlanguage{finnish}
  \setmainfont{Latin Modern Roman}[Scale=1.3]
  \linespread{1.4}

  \begin{document}

  Minun Latex-dokumenttini!

  \end{document}
\end{koodilohko}
\caption{Ensimmäinen Latex-dokumentti}
\label{esim:ensimmainen}
\end{esimerkki*}

Dokumentin alku\-osaa riville 8 saakka kutsutaan esittelyosaksi (engl.
\englanti{preamble}). Tässä osassa ladataan tarvittavat makropaketit ja
määritetään dokumentin asetuksia ja taustatietoja. Riviltä 9 alkaa
varsinainen tekstiosa eli sivulle ladottava sisältö. Se osa kirjoitetaan
\koodi{document}\-/ympäristön sisään eli riveillä 9 ja 13 olevien
ympäristön aloi\-tus- ja lopetuskomentojen väliin.

Tällaisen merkintäkielen ja rakenteen avulla dokumentit kirjoitetaan.
Osa merkintäkielen komennoista tulee Latexin perusosasta ja osa tulee
erikseen ladattavista makropaketeista (\paketti{fontspec},
\paketti{polyglossia} ym.). Komentoja voi luoda itsekin.
