\chapter{Valmistautuminen}

\section{Käsitteet ja nimet}

Se, mitä sanalla Latex yleensä tarkoitetaan, on monimutkainen
kokonaisuus erilaisia pieniä palikoita kuten tietokone\-ohjelmia,
makropaketteja ja asetustiedostoja. Yritän tässä luvussa selventää
joitakin peruskäsitteitä.

Tex on tietokone\-ohjelma (\koodi{tex}), joka osaa lukea tietynmuotoisia
tekstitiedostoja ja latoa niiden perusteella tekstidokumentin, joka on
tarkoitettu ihmisten luettavaksi. Tex on myös tekstin ladontaan
tarkoitettu ohjelmointikieli. Se noudattaa sille annettuja ohjeita ja
latoo kirjaimia ja muuta tavaraa peräkkäin sivulle. Ihmisten
näkökulmasta Tex on hyvin tekninen ja matalatasoinen järjestelmä, eikä
sellaisten kanssa yleensä haluta olla missään tekemisissä. Siirtykäämme
siis eteenpäin.

Latex toimii korkeammalla abstraktiotasolla kuin Tex. Se on kokoelma
Tex\-/ohjelmointikielen makroja, jotka piilottavat monimutkaiset
tekniset yksityiskohdat ja toteuttavat varsin helppokäyttöisen
merkintäkielen, joilla tekstidokumenttien rakenne ja ulko\-asua
kuvataan. Ihmiset siis kirjoittavat yleensä Latex\-/muotoisia
dokumentteja, ja Latex eli makrot puolestaan huolehtivat Texin
käskyttämisestä. Latex on myös tietokone\-ohjelma (\koodi{latex}), jolla
lähdetiedoston voi kääntää julkaistavaksi dokumentiksi.

Ajan myötä mukaan on tullut sekalainen joukko muitakin ohjelmia, joista
kannattaa tässä yhteydessä mainita kaksi: Xelatex ja Lualatex. Ne ovat
erilaisia Latexin toteutuksia ja tietokone\-ohjelmia (\koodi{xelatex,
  lualatex}), joilla lähdedokumentti käännetään. Nyky\-aikana käytetään
näistä yleensä jompaakumpaa, ja esimerkiksi tämän oppaan
Latex\-/lähdetiedosto on käännetty PDF\-/tiedostoksi
\koodi{xelatex}\-/komennolla.

Jotta kaikki olisi mahdollisimman sekavaa, sana Latex toimii myös
yleisenä nimityksenä tälle kaikelle. Se esiintyy ilmaisuissa kuten
''Toteutin dokumentin Latexilla'' tai ''Tämä artikkeli on tehty
Latexilla''. Ilmaukset sitten tarkoittavat suunnilleen seuraavanlaista:
Henkilöllä on asennettuna tietokoneelle Latex\-/jakelu (kuten Tex Live).
Hän on kirjoittanut teksti\-editorilla (kuten GNU Emacsilla)
tekstitiedoston, jossa on dokumentin sisältö ja Latex\-/makroille
tarkoitettuja komentoja. Sitten hän on kääntänyt eli ladotuttanut
tekstitiedostonsa PDF\-/tiedostoksi Latex-la\-don\-ta\-oh\-jel\-man
jollakin toteutuksella (kuten Xelatexilla).

Meille \marginpar{\Large\LaTeX} taitaa riittää vain Latexista puhuminen,
mutta siitäkin on mainittava vielä yksi huomio. Latexin harrastajat
tykkäävät käyttää dokumenttiensa leipätekstissä logoja kuten \TeX{} ja
\LaTeX{}. Usein teksteissä näkyy myös logojen pohjalta mukailtuja
kirjoitus\-asuja TeX ja LaTeX. Mielestäni logojen eikä muodikkaiden
kIRjoiTus\-AsuJen paikka ei ole leipätekstissä, koska ne erottuvat
tekstipalstasta liiaksi ja tekevät siitä rauhattoman näköisen. Tässä
oppaassa viittaan kaikkiin nimiin kielenhuollon normien mukaisesti eli
käytän tavallisia erisnimiä kuten Tex ja Latex. Koodi ja komennot ovat
siinä muodossa kuin ne tietokoneelle annetaan, esimerkiksi
\koodi{xelatex}.

\section{Asentaminen}
\label{luku:asentaminen}

\section{Ensimmäinen dokumentti}

Ehkä olisi parasta päästä vain nopeasti kokeilemaan omia
Latex\-/dokumentteja eikä lukea pitkiä jaaritteluja muinaisten
kreikkalaisten Latex\-/filosofiasta. Tallenna esimerkin
\ref{esim:ensimmainen} sisältö teksti\-editorin avulla tiedostoon
vaikkapa nimellä teksti.tex. Käännä eli lado se PDF\-/tiedostoksi
komennolla \koodi{xelatex teksti.tex}.

Tutkitaan esimerkkiä tarkemmin. Ensimmäisellä rivillä määritellään
dokumenttiluokka \textenglish{\koodi{article}}, joka on tietynlainen
sivupohja tai asetusten kokoelma, jonka perustalle aletaan rakentaa omaa
sivua. Luokka \textenglish{\koodi{article}} on tyypillinen valinta
lyhyehköille teksteille. Lisätietoa dokumenttiluokista on luvussa
\ref{luku:dokumenttiluokat}.

Toisella ja kolmannella rivillä käytetään komentoa \koodi{\keno
  usepackage} ja sen avulla otetaan käyttöön fontti\-asetuksia hoitava
Fontspec\-/paketti ja kieli\-asetuksista vastaava Polyglossia\-/paketti.
Kumpaakin tarvitaan melkein joka kerta dokumenteissa, ja niihin palataan
tarkemmin luvuissa \ref{luku:kirjaintyypit} ja
\ref{luku:kieliasetukset}. Sivun asetuksia käsitellään luvussa
\ref{luku:sivuasetukset}.

Seuraavilla riveillä asetetaan kieleksi suomi ja määritetään
oletusfontti. Latin Modern Roman \=/fontin tilalle voi toki kokeilla
muitakin. Fontin oletuskoko on 10 pistettä, mutta tässä esimerkissä se
venytetään 1,3\-/kertaiseksi eli 13 pisteeseen. Riviväliin liittyvä
kerroin asetetaan rivillä 7.

\begin{esimerkki}
\begin{koodilohko}
  \documentclass{article}
  \usepackage{fontspec}
  \usepackage{polyglossia}

  \setdefaultlanguage{finnish}
  \setmainfont{Latin Modern Roman}[Scale=1.3]
  \linespread{1.4}

  \begin{document}

  Minun Latex-dokumenttini!

  \end{document}
\end{koodilohko}
\caption{Ensimmäinen Latex-dokumentti}
\label{esim:ensimmainen}
\end{esimerkki}

Dokumentin alku\-osaa esimerkin riville 8 saakka kutsutaan johdannoksi
tai esittelyksi (engl. \textenglish{preamble}). Tässä osassa ladataan
tarvittavat makropaketit ja määritetään dokumentin asetuksia ja
taustatietoja. Riviltä 9 alkaa varsinainen teksti\-osa eli sivulle
ladottava sisältö. Se osa kirjoitetaan
\textenglish{document}\-/ympäristön sisään eli riveillä 9 ja 13 olevien
ympäristön aloitus\-/{} ja lopetuskomentojen väliin.

Tällaisen merkintäkielen ja rakenteen avulla dokumentit kirjoitetaan.
Osa merkintäkielen komennoista tulee Latexin perus\-osasta ja osa tulee
erikseen ladattavista makropaketeista (Fontspec, Polyglossia jne.).
Komentoja voi luoda itsekin.

\section{Apuohjelmia}

\subsection{Tekstieditori}

\subsection{Texdoc}

Latexin kirjoittajan täytyy silloin tällöin lukea ohjekirjoja. Vaikka
Latexin perus\-osat joskus oppisikin ulkoa, ei voi koskaan muistaa
kaikkien hyödyllisten makropakettien kaikkia ominaisuuksia. Myös uusia
makropaketteja ja ihmisten suosituksia tulee vastaan esimerkiksi
verkkokeskusteluissa.

Tex Live \=/jakelun (ks. luku \ref{luku:asentaminen}) mukana tulee
mainio komentotulkissa toimiva komento \koodi{texdoc}, jolla voi hakea
ja avata omaan järjestelmään asennettuja Latex\-/aiheisia ohjeita. Jos
vaikka haluaa tutustua esimerkissä \ref{esim:ensimmainen} mainittuun
Fontspec\-/pakettiin syvällisemmin, tarvitsee vain komentaa
\koodi{texdoc fontspec}, ja paketin PDF\-/muotoinen ohjekirja avautuu.

\subsection{Latexmk}

Hyödyllinen ohjelma on myös Latexmk, joka helpottaa dokumenttien
kääntämistä. Nimittäin varsin usein Latex\-/dokumentit täytyy kääntää
useita kertoja ennen kuin PDF\-/tiedosto on valmis. Se johtuu siitä,
että dokumentit sisältävät usein ristiviitteitä eli viittauksia
dokumentin toisiin osiin. Latex ei saa viitteitä kohdalleen yhdellä
kääntämisellä, vaan ensin se kirjoittaa viittausten kohteet muistiin
väli\-aikais\-tiedostoon ja seuraavilla kääntökerroilla käyttää
väli\-aikais\-tiedostoa apunaan.

Kääntäjä huomauttaa tietokoneen käyttäjää, kun uusintakäännös on
tarpeen, mutta Latexmk\-/ohjelma käynnistää uusintakäännöksen ihan itse,
aina kun se on tarpeellista.

Alla on kääntämiseen esimerkkikomentoja. Ensimmäinen kääntää dokumentin
Xelatexilla ja jälkimmäinen Lualatexilla.

\begin{koodilohkosis}
  latexmk -xelatex  teksti.tex
  latexmk -lualatex teksti.tex
\end{koodilohkosis}

Seuraavista esimerkeistä ensimmäinen komento poistaa kääntämisen aikana
luodut väli\-aikaistiedostot (\koodi{log, aux, out} ym.), ja
jälkimmäinen rivin komento poistaa kaikki luodut tiedostot eli
väli\-aikais\-tiedostojen lisäksi myös valmiin PDF\-/tiedoston.

\begin{koodilohkosis}
  latexmk -c teksti.tex
  latexmk -C teksti.tex
\end{koodilohkosis}

Edellisissä esimerkeissä käsitellään lähdetiedostoa nimeltä
\koodi{teksti.tex}, mutta jos lähdetiedostoa ei anna komennolle
lainkaan, käännetään kaikki nykyisessä hakemistossa olevat
\koodi{tex}\-/päätteiset tiedostot.

Latexmk-ohjelmalle voi tehdä asetustiedoston, johon voi kirjoittaa omaan
käyttöön sopivat asetukset. Asetustiedosto sijoitetaan käyttäjän
kotihakemistoon nimellä \koodi{.latexmkrc}. Alla on esimerkki, mitä se
voisi ehkä sisältää.

\begin{koodilohkosis}
  $pdf_mode = 5; # 5=xelatex, 4=lualatex
  $xelatex = 'xelatex -interaction=nonstopmode %O %S';
  $lualatex = 'lualatex -interaction=nonstopmode %O %S';
  $clean_ext = 'snm nav xdv';
\end{koodilohkosis}

Ensimmäisen rivin asetus määrittää, mitä kääntäjää käytetään oletuksena.
Toisella ja kolmannella rivillä määritellään, millä tavoin Xelatex ja
Lualatex suoritetaan. Tässä esimerkissä oletus\-asetuksiin on lisätty
\koodi{non\-stop\-mode}, joka estää kaiken vuorovaikutteisen toiminnan.
Asetus on tarpeen ainakin silloin, kun kääntäjä käynnistetään toisesta
ohjelmasta kuten teks\-ti\-edi\-to\-ris\-ta eikä vuorovaikutus kääntäjän
kanssa ole mahdollista.

Neljännellä rivillä luetellaan kääntämisen aikana syntyvien
väli\-aikais\-tiedostojen päätteitä. Yleiset väli\-aikais\-tiedostot
(\koodi{log, aux, out} ym.) on \koodi{latexmk}\-/ohjelmalla jo tiedossa,
mutta tällä asetuksella mukaan voi lisätä muitakin.
