\chapter{Valmistautuminen}

\section{Käsitteet ja nimet}

Latex ja sen ympärille rakentuneet ohjelmistot ovat käsitteellisesti
aika monimutkainen kokonaisuus, johon kuuluu eri\-/ikäisiä ja
abstraktiotasoltaan erilaisia osia. Mukaan kuuluu tietenkin
konkreettisia tietokoneohjelmia, jotka tekevät konkreettisia asioita.
Mukaan kuuluu kuitenkin myös ihmisten luomia abstrakteja käsitteitä
kuten Latex\-/formaatti, Tex\-/ohjelmointikieli tai muu yleinen idea,
jonka tietokoneohjelmat pyrkivät konkreettisesti toteuttamaan.

Internetissä näkyy silloin tällöin käsitekeskusteluja, jossa
ihmetellään, mihin mikäkin palikka kuuluu käsitteellisesti. Missä
suhteessa jotkin uudemmat osat ovat vanhempiin? Oikeiden termien
osaamisesta voi olla hyötyä, kun pyytää verkossa suurelta yleisöltä
apua. Viestintä vaatii, että puhutaan suunnilleen samaa kieltä. Yritän
seuraavaksi selventää peruskäsitteitä.

\subsection{Tex ja Latex}

Tex on tietokoneohjelma (\koodi{tex}), joka osaa lukea tietynmuotoisia
tekstitiedostoja ja latoa niiden perusteella tekstidokumentin, joka on
tarkoitettu ihmisten luettavaksi. Tex on myös tekstin ladontaan
tarkoitettu ohjelmointikieli. Se noudattaa sille annettuja ohjeita ja
latoo kirjaimia ja muuta tavaraa peräkkäin sivulle. Ihmisten
näkökulmasta Tex on hyvin tekninen ja matalatasoinen järjestelmä, eikä
sellaisten kanssa yleensä haluta olla missään tekemisissä. Siirtykäämme
siis eteenpäin.

Latex toimii korkeammalla abstraktiotasolla kuin Tex. Se on kokoelma
Tex\-/ohjelmointikielen makroja, jotka piilottavat monimutkaiset
tekniset yksityiskohdat ja toteuttavat varsin helppokäyttöisen
merkintäkielen, jolla dokumenttien rakenne ja ulko\-asua kuvataan.
Ihmiset siis kirjoittavat yleensä Latex\-/muotoisia dokumentteja, ja
Latex puolestaan huolehtii matalamman tason Texin käskyttämisestä. Latex
on myös tietokoneohjelma (\koodi{latex}), jolla lähdetiedoston voi
kääntää julkaistavaksi dokumentiksi.

\subsection{Xelatex ja Lualatex}

Ajan myötä mukaan on tullut sekalainen joukko muitakin ohjelmia, joista
kannattaa tässä yhteydessä mainita kaksi: \index{Xelatex}Xelatex ja
\index{Lualatex}Lualatex. Ne ovat erilaisia Latexin toteutuksia ja
tietokoneohjelmia (\koodi{xelatex}, \koodi{lualatex}), joilla
lähdedokumentti käännetään.\footnote{Englannin kielellä näitä on tapana
  kutsua yleisnimellä \emph{\textenglish{engine}} 'kone, moottori'.} Ne
osaavat lukea Unicode\-/merkistöllä kirjoitettuja lähdedokumentteja ja
käyttää nyky\-aikaisia \index{True Type}True Type- ja \index{Open
  Type}Open Type \=/fontteja, mitä alkuperäinen Latex ja Tex eivät osaa.
Nyky\-aikana käytetään yleensä jompaakumpaa, Xelatexia tai Lualatexia,
ja esimerkiksi tämän oppaan lähdetiedosto on käännetty
pdf\-/tiedostoksi\footnote{PDF = Portable Document Format} Xelatexilla.

Xelatexilla ja Lualatexilla ei ole käyttäjän kannalta suurtakaan eroa.
Jälkimmäinen sisältää Lua\-/nimisen ohjelmointikielen, ja sillä on
merkitystä joillekuille makropakettien tekijöille. Jotkin makropaketit
eivät toimi Lualatexissa ja jotkin eivät toimi Xelatexissa. Xelatex
taitaa olla hieman paremmin tuettu, koska se on vanhempi eli ehtinyt
vakiinnuttaa asemansa paremmin.

Kääntäjäohjelmien toiminnassa on pieniä eroja. Vaikka Latex\-/dokumentit
yleensä kääntyvätkin molemmilla, saattaa joskus valmiissa pdf:ssä näkyä
pieniä eroja, kun kääntäjää vaihtaa. Toisaalta on ihan hyödyllistä
kokeilla kääntää omat dokumentit kummallakin ohjelmalla, koska se voi
paljastaa huonoja, epäyhteensopivia käytäntöjä omassa Latex\-/koodissa.
En kuitenkaan suosittele vaihtamaan kääntäjää viime hetkellä ennen
tärkeän tekstin julkaisua.

\subsection{Latex yläkäsitteenä}

Jotta kaikki olisi mahdollisimman sekavaa, sana Latex toimii myös
yleisenä nimityksenä tälle kaikelle. Se esiintyy ilmaisuissa kuten
''Toteutin dokumentin Latexilla'' tai ''Tämä artikkeli on tehty
Latexilla''. Ilmaukset sitten tarkoittavat suunnilleen seuraavanlaista:
Henkilöllä on asennettuna tietokoneelle Latex\-/jakelu (kuten Tex Live).
Hän on kirjoittanut tekstieditorilla (kuten GNU Emacsilla)
tekstitiedoston, jossa on dokumentin sisältö ja Latex\-/makroille
tarkoitettuja komentoja mutta myös joitakin Tex\-/komentoja. Sitten hän
on kääntänyt eli ladotuttanut tekstitiedostonsa pdf\-/tiedostoksi
Latex\-/ladontaohjelman jollakin toteutuksella (kuten Xelatexilla).

Meille taitaa riittää vain Latexista puhuminen, mutta siitäkin on
mainittava vielä yksi asia. Latexin harrastajat tykkäävät käyttää
dokumenttiensa leipätekstissä logoja kuten \TeX{} ja \LaTeX{}. Usein
teksteissä näkyy myös logojen pohjalta mukailtuja kir\-joi\-tus\-asu\-ja
TeX ja LaTeX. Mielestäni logojen eikä muodikkaiden
kIR\-joi\-Tus\-Asu\-Jen paikka ei ole leipätekstissä. Tässä oppaassa
viittaan kaikkiin nimiin kielenhuollon normien mukaisesti eli käytän
tavallisia erisnimiä kuten Tex ja Latex. Koodi ja komennot ovat siinä
muodossa kuin ne tietokoneelle annetaan, esimerkiksi \koodi{xelatex}.

\section{Asentaminen}
\label{luku:asentaminen}

Latex pitää tietysti asentaa tietokoneelle, jotta sitä voisi käyttää.
Miten edellisessä luvussa kuvattu sekava kokonaisuus saadaan ehjänä
omalle tietokoneelle? Onneksi muut ovat jo ratkaisseet sen ongelman aika
pitkälle.

Tavallisin tapa Latexin käyttöönottoon on jonkin Latexin jakelupaketin
asentaminen. Jakelupaketti sisältää perusosien lisäksi paljon
makropaketteja ja niiden ohjekirjoja. Kaikkea ei koskaan tarvitse, mutta
kun yllättävä tarve tulee tai lukee vinkkejä verkkokeskusteluista, on
mukavaa huomata, että makropaketti olikin itsellä jo valmiina. Siksi
suosittelen kokonaisen jakelupaketin asentamista.

GNU/Linuxissa ja muissa Unix\-/tyyppisissä käyttöjärjestelmissä
käytetään yleensä Tex Live \=/nimistä jakelua. Se on todennäköisesti
saatavilla käyttöjärjestelmäjakelun pakettivarastoista. Esimerkiksi
Debianiin ja sen kaltaisiin järjestelmiin on asennuspaketti
texlive-full, joka asentaa kaiken helposti ja kerralla.

Windows\-/käyttöjärjestelmälle on saatavilla Tex Liven lisäksi Miktex ja
Protext. Mac OS \=/käyttöjärjestelmän kanssa käytettäneen yleensä
Mactex\-/nimistä jakelua.

\section{Apuohjelmia}

\subsection{Tekstieditori}

Käytä kunnollista tekstieditoria. Sellaisia tehtiin ennen vanhaan
Unixille ja sittemmin GNU/Linuxille. Sellaisia, joilla moni ohjelmoi,
kirjoittaa sähköpostejaan ja muokkaa käyttöjärjestelmänsä
asetustiedostoja. Kunnollisia editoreja ovat ainakin GNU Emacs ja Vim,
ja ne ovat saatavilla suunnilleen kaikille käyttöjärjestelmille.
Latex\-/dokumentti kääntyy pdf:ksi parilla näppäinpainalluksella.

Jos et ihan vielä viitsi opetella käyttämään GNU Emacsia etkä Vimiä,
pyri ainakin löytämään sellainen editori, joka osaa värjätä tekstiä
Latexin tai Texin tekstipiirteiden mukaan. Väreillä ei sinänsä ole
merkitystä, mutta editorin tasosta se yleensä kertoo paljon, jos se
tuntee erilaisten ohjelmointi\-/{} ja merkintäkielten luonnetta ja osaa
merkitä kielen avainsanoja havainnollisilla väreillä. Ihan
yksinkertaisiin editoreihin ei tuollaisia ominaisuuksia yleensä tehdä.

Toisaalta todellisten ohjelmoijien (ja Latex\-/tyyppien) editoriksi
voivat soveltua myös \koodi{/bin/ed}, \koodi{/bin/cat}, magnetisoitu
neula tai perhoset, joten mikä tahansa lopulta käy.%
\footnote{''Real Programmers'': \url{https://xkcd.com/378/}}

\subsection{Pdf-katselin}

Latex\-/kääntäjät eli \=/latojat eli \=/moottorit kuten Xelatex ja
Lualatex tuottavat pdf\-/tiedoston, ja niiden katselemiseen tarvitaan
tietenkin oma ohjelmansa. Sellaisia on saatavilla paljon erilaisia, ja
melkein mikä tahansa kelpaa, mutta yksi tietty ominaisuus olisi
toivottavaa olla: muuttuneen pdf\-/tiedoston automaattinen lataaminen.

Nimittäin välillä työskentely on sitä, että tehdään Latex\-/dokumenttiin
pieni muutos, käännetään se ja katsotaan pdf:ää. Lopputulos ei ehkä ihan
miellytä. Muokataan tekstiä tai asetuksia vähän, käännetään ja
katsotaan, miltä ladottu pdf nyt näyttää.

On todella mukavaa, jos pdf\-/katselimessa ei tarvitse joka kerta
klikkailla valikoiden kautta auki samaa tiedostoa uudelleen, vaan
ohjelma itse huomaa, että jo avattu tiedosto muuttui
tiedostojärjestelmässä, ja lataa sen automaattisesti uudelleen. Jotkin
pdf\-/ohjelmat osaavat tämän. Jotkin ohjelmat eivät osaa mutta osaavat
sentään yhdellä näppäinpainalluksella avata pdf:n uudelleen
tiedostojärjestelmästä.

Hyvän tekstieditorin ja pdf\-/katselimen kanssa työskentely on sujuvaa.
Tietty näppäinkomento editorissa tallentaa ja kääntää dokumentin, ja
pian pdf\-/katselin lataa muuttuneen pdf:n automaattisesti näkyviin.
Sekä editorin että pdf\-/katselimen voi pitää sa\-man\-aikai\-ses\-ti
esillä, eikä muualle tarvitse yleensä siirtyä. Tähän kannattaa pyrkiä.

\subsection{Latexmk}

Erin\-omaisen hyödyllinen apu\-ohjelma on Latexmk, koska se helpottaa
dokumenttien kääntämistä ja vähän muutakin työskentelyä. Varsin usein
Latex\-/dokumentit täytyy kääntää useita kertoja ennen kuin
pdf\-/tiedosto on valmis. Tämä johtuu siitä, että dokumentit sisältävät
usein ristiviitteitä eli viittauksia dokumentin toisiin osiin. Latex ei
saa ristiviitteitä kohdalleen yhdellä kääntämisellä, vaan ensin se
kirjoittaa viittausten kohteet muistiin väliaikaistiedostoon ja
seuraavilla kääntökerroilla käyttää väliaikaistiedostoa apunaan.

Tavallinenkin kääntäjä kyllä huomauttaa tietokoneen käyttäjää, kun
uusintakäännös on tarpeen, mutta Latexmk\-/ohjelma käynnistää
uusintakäännöksen ihan itse, aina kun se on tarpeellista. Kätevää.

Alla on esimerkkikomennot Latex\-/dokumentin kääntämiseen Xelatexilla ja
Lualatexilla.

\begin{koodilohkosis}
  latexmk -xelatex  teksti.tex
  latexmk -lualatex teksti.tex
\end{koodilohkosis}

Työskentelyä erityisen paljon helpottava valitsin on \koodi{\=/pvc}. Kun
tuo valitsin on mukana komennossa, Latexmk jää tarkkailemaan annettua
Latex\-/tiedostoa, ja kun se huomaa tiedoston muuttuneen, se kääntää
tiedoston automaattisesti uudelleen. Käyttäjän ei siis tarvitse muuta
kuin tallentaa tiedosto tekstieditorista, ja tarkkailutilassa oleva
Latexmk kääntää sen aina itsestään.

Muitakin hyödyllisiä toimintoja on mukana. Seuraavista esimerkeistä
ensimmäinen komento poistaa kääntämisen aikana luodut
väliaikaistiedostot (log, aux, out ym.), ja jälkimmäinen rivin komento
poistaa kaikki luodut tiedostot eli väliaikaistiedostojen lisäksi myös
valmiin pdf\-/tiedoston.

\begin{koodilohkosis}
  latexmk -c teksti.tex
  latexmk -C teksti.tex
\end{koodilohkosis}

Edellisissä esimerkeissä käsitellään lähdetiedostoa nimeltä
\koodi{teksti.\-tex}, mutta jos lähdetiedostoa ei anna komennolle
lainkaan, käännetään kaikki nykyisessä hakemistossa olevat
\koodi{tex}\-/päätteiset tiedostot.

Latexmk\-/ohjelmalle voi tehdä asetustiedoston, johon voi kirjoittaa
omaan käyttöön sopivat asetukset. Asetustiedosto sijoitetaan käyttäjän
kotihakemistoon nimellä \koodi{.latexmkrc}. Esimerkki
\ref{esim:latexmkrc} näyttää, mitä se voisi ehkä sisältää.

Esimerkin ensimmäisen rivin asetus määrittää, miten pdf\-/tiedostot
tuotetaan tai mitä kääntäjää käytetään oletuksena. Toisella ja
kolmannella rivillä määritellään, millä tavoin Xelatex ja Lualatex
suoritetaan. Tässä esimerkissä ole\-tus\-ase\-tuk\-siin on lisätty
\koodi{nonstopmode}, joka estää kaiken vuorovaikutteisen toiminnan.
Asetus on tarpeen ainakin silloin, kun kääntäjä käynnistetään toisesta
ohjelmasta kuten tekstieditorista eikä vuorovaikutus kääntäjän kanssa
ole mahdollista.

\input{esim-latexmkrc}

Esimerkin \ref{esim:latexmkrc} neljännellä rivillä luetellaan
kääntämisen aikana syntyvien väliaikaistiedostojen päätteitä.
Latexmk\-/ohjelma tuntee yleisimmät väliaikaistiedostot (log, aux, out
ym.), mutta tällä asetuksella mukaan voi lisätä harvinaisempia. Viides
rivi määrittää pdf\-/katseluohjelman, joka käynnistetään, kun käytetään
valitsimia \koodi{\=/pv} tai \koodi{\=/pvc}.

\subsection{Texdoc}

Latexin kirjoittajan täytyy silloin tällöin lukea ohjekirjoja. Vaikka
Latexin perusosat joskus oppisikin ulkoa, ei voi koskaan muistaa
kaikkien hyödyllisten makropakettien kaikkia ominaisuuksia.

Tex Live \=/jakelun (luku \ref{luku:asentaminen}) mukana tulee mainio
komentotulkissa toimiva komento \koodi{texdoc}, jolla voi hakea ja avata
omaan järjestelmään asennettuja Latex\-/aiheisia ohjeita. Jos vaikka
haluaa tutustua esimerkissä \ref{esim:ensimmainen} mainittuun
\paketti{fontspec}\-/pakettiin syvällisemmin, tarvitsee vain komentaa
\koodi{texdoc fontspec}, ja paketin pdf\-/muotoinen ohjekirja avautuu.

\section{Ensimmäinen dokumentti}

Olemme varmasti jo puhuneet tarpeeksi, ja olisi hyvä päästä tekemään
jotain käytännöllistä. Tallenna esimerkin \ref{esim:ensimmainen} sisältö
tekstieditorin avulla tiedostoon vaikkapa nimellä \koodi{teksti.tex}.
Käännä eli lado se pdf\-/tiedostoksi komennolla \koodi{xelatex
  teksti.tex} tai komennolla \koodi{lualatex teksti.tex}. Tuloksena
pitäisi olla tiedosto \koodi{teksti.pdf}, jota voi ihailla jollakin
pdf\-/tiedostojen katseluun tarkoitetulla ohjelmalla. Näin tämä
Latex\-/homma toimii.

Tutkitaan esimerkkiä \ref{esim:ensimmainen} tarkemmin. Ensimmäisellä
rivillä määritellään dokumenttiluokka \textenglish{\koodi{article}},
joka on tietynlainen sivupohja tai asetusten kokoelma, jonka perustalle
aletaan rakentaa omaa sivua. Luokka \textenglish{\koodi{article}} on
tyypillinen valinta lyhyehköille teksteille. Lisätietoa
dokumenttiluokista on luvussa \ref{luku:dokumenttiluokat}.

Toisella ja kolmannella rivillä käytetään komentoa \koodi{\keno
  usepackage} ja niiden avulla otetaan käyttöön fontti\-asetuksia
hoitava \paketti{fontspec}\-/paketti ja kieli\-asetuksista vastaava
\paketti{polyglossia}\-/paketti. Kumpaakin tarvitaan melkein joka kerta
dokumenteissa, ja niihin palataan tarkemmin luvuissa
\ref{luku:kirjaintyypit} ja \ref{luku:kieliasetukset}. Sivun asetuksia
käsitellään luvussa \ref{luku:sivuasetukset}.

Seuraavilla riveillä asetetaan kieleksi suomi (\koodi{finnish}) ja
määritetään oletuksena käytettävä fontti (kirjainperhe). Latin Modern
Roman \=/fontin tilalle voi toki kokeilla muitakin. Fontin oletuskoko on
10 pistettä, mutta tässä esimerkissä se venytetään 1,3\-/kertaiseksi eli
13 pisteeseen. Riviväliin liittyvä kerroin asetetaan rivillä 7.

\begin{esimerkki}
\begin{koodilohko}
  \documentclass{article}
  \usepackage{fontspec}
  \usepackage{polyglossia}

  \setdefaultlanguage{finnish}
  \setmainfont{Latin Modern Roman}[Scale=1.3]
  \linespread{1.4}

  \begin{document}

  Minun Latex-dokumenttini!

  \end{document}
\end{koodilohko}
\caption{Ensimmäinen Latex-dokumentti}
\label{esim:ensimmainen}
\end{esimerkki}

Dokumentin alkuosaa esimerkin riville 8 saakka kutsutaan johdannoksi tai
esittelyksi (engl. \textenglish{preamble}). Tässä osassa ladataan
tarvittavat makropaketit ja määritetään dokumentin asetuksia ja
taustatietoja. Riviltä 9 alkaa varsinainen tekstiosa eli sivulle
ladottava sisältö. Se osa kirjoitetaan \koodi{document}\-/ympäristön
sisään eli riveillä 9 ja 13 olevien ympäristön aloi\-tus- ja
lopetuskomentojen väliin.

Tällaisen merkintäkielen ja rakenteen avulla dokumentit kirjoitetaan.
Osa merkintäkielen komennoista tulee Latexin perusosasta ja osa tulee
erikseen ladattavista makropaketeista (\paketti{fontspec},
\paketti{polyglossia} jne.). Komentoja voi luoda itsekin.
